<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="theme-color" content="#02040c" media="(prefers-color-scheme: dark)">
<meta name="theme-color" content="#02040c">
<meta name="color-scheme" content="dark">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
<title>SKY RAIDERS</title>
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Sky Raiders">
<style>

:root{
  --bg-deep:#02040c;
  --bg-surface:#060a12;
  --bg-panel:rgba(3,8,20,.95);
  --border-dim:#0d1628;
  --border-glow:#00f5ff;
  --text-primary:#c8dff0;
  --text-dim:#4a6880;
  --text-accent:#00f5ff;
  --text-gold:#ffc944;
  --safe-top:env(safe-area-inset-top,0px);
  --safe-bottom:env(safe-area-inset-bottom,0px);
  --safe-left:env(safe-area-inset-left,0px);
  --safe-right:env(safe-area-inset-right,0px);
}
@media(prefers-color-scheme:light){
  /* game stays dark ‚Äî override only chrome UI */
  html,body{background:#000;}
}
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=M+PLUS+Rounded+1c:wght@400;700;900&display=swap');
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;user-select:none;}
html,body{width:100%;height:100%;overflow:hidden;background:#000;font-family:'M PLUS Rounded 1c',sans-serif;}
#app{width:100%;height:100%;display:flex;align-items:center;justify-content:center;}
#G{width:100%;height:100%;max-width:500px;position:relative;overflow:hidden;background:#04060f;flex-shrink:0;}
/* center on very wide screens */
#app{align-items:stretch;flex-direction:column;}
/* On large screens, center and constrain */
@media(min-width:500px){
  #app{align-items:center;justify-content:center;}
  #G{height:100%;}
}
.scr{position:absolute;inset:0;display:none;flex-direction:column;}
.scr.on{display:flex;}

/* ‚ïê‚ïê‚ïê MENU ‚ïê‚ïê‚ïê */
#sMenu{background:radial-gradient(ellipse at 50% 35%,#0a1540,#02040c);align-items:center;justify-content:center;}
#menuCvs{position:absolute;inset:0;}
.logo-wrap{position:relative;z-index:5;text-align:center;margin-bottom:36px;}
.logo-en{font-family:'Orbitron',sans-serif;font-size:12px;letter-spacing:8px;color:#00f5ff;opacity:.65;margin-bottom:10px;}
.logo-main{font-family:'Orbitron',sans-serif;font-size:44px;font-weight:900;line-height:.88;letter-spacing:-2px;
  background:linear-gradient(180deg,#fff 0%,#00f5ff 55%,#0055ff 100%);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;
  filter:drop-shadow(0 0 30px #00f5ff99);}
.logo-jp{font-family:'Orbitron',sans-serif;font-size:12px;letter-spacing:5px;color:#1a2840;margin-top:10px;}
.menu-btns{position:relative;z-index:5;display:flex;flex-direction:column;gap:12px;width:270px;}
.mbtn{padding:19px;cursor:pointer;border:none;font-family:'Orbitron',sans-serif;font-size:17px;
  letter-spacing:3px;clip-path:polygon(14px 0%,100% 0%,calc(100% - 14px) 100%,0% 100%);
  width:100%;text-align:center;transition:filter .15s,transform .1s;}
.mbtn:active{transform:scale(.94);}
.mbtn-b{background:linear-gradient(135deg,#0a3870,#1070d0);color:#fff;box-shadow:0 0 28px #1070d055;}
.mbtn-g{background:linear-gradient(135deg,#502400,#b05000);color:#fff;border:2px solid #ffc944;box-shadow:0 0 22px #ffc94455;}
.menu-coin{position:relative;z-index:5;margin-top:22px;
  background:#060e1a;border:1px solid #1a3050;border-radius:8px;
  padding:10px 24px;font-family:'Orbitron',sans-serif;font-size:18px;color:#ffc944;
  display:flex;align-items:center;gap:10px;box-shadow:0 0 20px #ffc94422;}

/* ‚ïê‚ïê‚ïê STAGE ‚ïê‚ïê‚ïê */
#sStage{background:#03050e;}
#stageCvs{position:absolute;inset:0;pointer-events:none;}
.top-bar{display:flex;align-items:center;padding:10px 14px;flex-shrink:0;
  background:rgba(3,5,14,.9);border-bottom:1px solid #0d1628;z-index:2;position:relative;}
.tb-title{font-family:'Orbitron',sans-serif;font-size:16px;color:#00f5ff;letter-spacing:2px;}
.back-btn{background:none;border:1px solid #1a2a3a;color:#4a6080;
  font-family:'Orbitron',sans-serif;font-size:14px;padding:5px 12px;
  cursor:pointer;border-radius:4px;margin-right:10px;letter-spacing:1px;}
.back-btn:active{background:#0a1428;}
.stage-scr{flex:1;overflow-y:auto;padding:12px 10px;position:relative;z-index:2;}
.stage-scr::-webkit-scrollbar{width:3px;}
.stage-scr::-webkit-scrollbar-thumb{background:#1a2840;}
.world-label{text-align:center;margin:8px 0 14px;font-family:'Orbitron',sans-serif;
  font-size:12px;letter-spacing:4px;color:#263850;}
.world-label::before,.world-label::after{content:'‚îÄ‚îÄ';margin:0 6px;color:#141e2c;}
.stage-row{display:flex;justify-content:center;margin-bottom:12px;}
.snode{width:78px;height:78px;border-radius:50%;cursor:pointer;position:relative;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  border:2px solid;transition:transform .1s;}
.snode:active{transform:scale(.88);}
.snode.locked{background:#04090f;border-color:#141e2c;opacity:.35;cursor:default;}
.snode.done{background:radial-gradient(#041510,#020a08);border-color:#165030;}
.snode.open{background:radial-gradient(#060e22,#030814);border-color:#00f5ff;
  animation:ng 2s ease-in-out infinite alternate;}
@keyframes ng{from{box-shadow:0 0 8px #00f5ff22;}to{box-shadow:0 0 24px #00f5ffcc;}}
.snode.bopen{border-color:#ff3344;background:radial-gradient(#1a0408,#0c0208);
  animation:bg2 1s ease-in-out infinite alternate;}
@keyframes bg2{from{box-shadow:0 0 8px #ff334422;}to{box-shadow:0 0 26px #ff3344cc;}}
.sn-num{font-family:'Orbitron',sans-serif;font-size:10px;color:#2a4060;}
.sn-ico{font-size:22px;line-height:1.15;}
.sn-nm{font-size:10px;color:#2a4060;text-align:center;max-width:78px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.sn-star{position:absolute;top:2px;right:4px;font-size:13px;}
.sn-badge{position:absolute;top:-5px;left:50%;transform:translateX(-50%);
  background:#ff3ea5;color:#fff;font-size:10px;font-family:'Orbitron',sans-serif;
  padding:2px 6px;border-radius:10px;white-space:nowrap;}

/* ‚ïê‚ïê‚ïê CHAR SELECT ‚ïê‚ïê‚ïê */
#sChar{background:#03050e;height:100%;}
.char-info{flex-shrink:0;padding:8px 14px;background:rgba(3,5,14,.9);
  border-bottom:1px solid #0d1628;z-index:2;position:relative;}
.ci-stage{font-family:'Orbitron',sans-serif;font-size:14px;color:#ffc944;letter-spacing:2px;}
.ci-boss{font-size:14px;color:#3a5070;margin-top:2px;}
.char-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;padding:10px;overflow-y:scroll;flex:1;-webkit-overflow-scrolling:touch;}
.char-grid::-webkit-scrollbar{width:3px;}
.char-grid::-webkit-scrollbar-thumb{background:#1a2840;}
.ccard{background:#06090f;border:1.5px solid #0d1628;border-radius:12px;
  padding:12px 8px;text-align:center;cursor:pointer;position:relative;transition:all .1s;}
.ccard:active{transform:scale(.9);}
.ccard.sel{border-color:#ffc944;box-shadow:0 0 18px #ffc94466;}
.cc-r{position:absolute;top:4px;right:4px;font-size:10px;
  font-family:'Orbitron',sans-serif;font-weight:700;padding:2px 5px;border-radius:3px;}
.r1{background:#141820;color:#6a7484;}.r2{background:#0a1a10;color:#3ebf6a;}
.r3{background:#08101e;color:#3a8fff;}.r4{background:#140820;color:#b43fff;}
.r5{background:#180c00;color:#ff8f00;}
.cc-ico{font-size:26px;margin:6px 0 5px;}
.cc-name{font-family:'Orbitron',sans-serif;font-size:11px;color:#6a8098;letter-spacing:.5px;}
.cc-sp{font-size:11px;color:#2a4058;margin-top:2px;}
.cc-stats{display:flex;justify-content:center;gap:3px;margin-top:6px;}
.stbar{display:flex;flex-direction:column;align-items:center;gap:1px;}
.stbar-l{font-size:9px;color:#223040;}
.stbar-t{width:18px;height:3px;background:#080e18;border-radius:2px;overflow:hidden;}
.stbar-f{height:100%;border-radius:2px;}
.go-row{display:flex;gap:10px;padding:12px;flex-shrink:0;}
.go-btn{flex:1;padding:17px;background:linear-gradient(135deg,#093670,#0e6ec8);
  border:1px solid #00f5ff;color:#fff;font-family:'Orbitron',sans-serif;
  font-size:15px;letter-spacing:3px;cursor:pointer;
  clip-path:polygon(10px 0,100% 0,calc(100% - 10px) 100%,0 100%);}
.go-btn:active{filter:brightness(1.3);}

/* ‚ïê‚ïê‚ïê BATTLE ‚ïê‚ïê‚ïê */
#sBattle{background:#000;}
#batCvs{position:absolute;inset:0;touch-action:none;}
/* HUD */
#hudTop{position:absolute;top:0;left:0;right:0;padding:calc(8px + var(--safe-top)) 10px 8px;z-index:10;
  background:linear-gradient(180deg,rgba(0,2,10,.9),transparent);pointer-events:none;}
.hud-row{display:flex;align-items:flex-start;gap:10px;}
.bgrp{display:flex;flex-direction:column;gap:3px;}
.blbl{font-family:'Orbitron',sans-serif;font-size:11px;color:#2a4060;letter-spacing:.5px;}
.btrack{height:6px;border-radius:3px;overflow:hidden;background:#080e18;}
.thp{width:112px;}.tsp{width:74px;}
.bfill{height:100%;border-radius:3px;transition:width .1s;}
.fhp{background:linear-gradient(90deg,#00ffcc,#0077ff);}
.fsp{background:linear-gradient(90deg,#ffcc00,#ff5500);}
#hudScore{margin-left:auto;font-family:'Orbitron',sans-serif;font-size:14px;color:#ffcc00;}
#hudBoss{position:absolute;top:60px;left:10px;right:10px;z-index:10;display:none;pointer-events:none;}
#bossLbl{font-family:'Orbitron',sans-serif;font-size:12px;letter-spacing:2px;color:#ff7788;margin-bottom:3px;}
.btrack2{height:8px;background:#18040a;border-radius:4px;overflow:hidden;border:1px solid #380010;}
.bfill2{height:100%;background:linear-gradient(90deg,#ff1133,#ff5500,#ffcc00);transition:width .1s;}
#hudWave{position:absolute;top:8px;right:10px;font-family:'Orbitron',sans-serif;
  font-size:12px;color:#2a4060;letter-spacing:1px;z-index:10;pointer-events:none;}
/* SP overlay */
#spOv{position:absolute;inset:0;z-index:30;display:none;pointer-events:none;}
#spOvCvs{position:absolute;inset:0;}
.spTxt{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;}
.sp-who{font-family:'Orbitron',sans-serif;font-size:12px;letter-spacing:6px;
  color:rgba(255,255,255,.55);margin-bottom:10px;opacity:0;transition:opacity .22s;}
.sp-nm{font-family:'Orbitron',sans-serif;font-size:27px;font-weight:900;letter-spacing:2px;
  opacity:0;transform:scale(.15);filter:blur(12px);
  transition:all .38s .05s cubic-bezier(.16,1,.3,1);}
.sp-rb{font-size:14px;letter-spacing:5px;color:rgba(255,255,255,.55);
  margin-top:6px;opacity:0;transition:opacity .28s .2s;}
.spTxt.show .sp-who,.spTxt.show .sp-rb{opacity:1;}
.spTxt.show .sp-nm{opacity:1;transform:scale(1);filter:blur(0);}
#spFlash{position:absolute;inset:0;z-index:29;display:none;pointer-events:none;}
/* Controls ‚Äî dpad left + action right */
#ctrl{position:absolute;bottom:0;left:0;right:0;z-index:10;
  height:calc(120px + var(--safe-bottom));padding-bottom:var(--safe-bottom);background:rgba(2,4,12,.92);border-top:1px solid #0d1628;
  display:flex;}
/* DPAD area */
#dpad{width:200px;height:120px;position:relative;flex-shrink:0;}
.dp{position:absolute;border:none;background:rgba(0,80,160,.2);
  border:1px solid #0a1e34;cursor:pointer;border-radius:4px;
  display:flex;align-items:center;justify-content:center;
  font-size:20px;color:#2a4060;transition:background .06s;}
.dp:active,.dp.pressed{background:rgba(0,100,200,.4);color:#00f5ff;}
#dpU{left:64px;top:2px;width:68px;height:48px;}
#dpD{left:64px;top:98px;width:68px;height:48px;}
#dpL{left:2px;top:48px;width:60px;height:48px;}
#dpR{left:132px;top:48px;width:60px;height:48px;}
#dpCtr{left:64px;top:50px;width:68px;height:48px;background:rgba(0,40,80,.3);border-radius:50%;font-size:10px;color:#1a3050;font-family:Orbitron,sans-serif;letter-spacing:.5px;}
/* Action buttons */
#actions{flex:1;height:148px;display:flex;flex-direction:column;border-left:1px solid #0d1628;}
.act-row{display:flex;flex:1;}
.abtn{flex:1;border:none;background:transparent;border-right:1px solid #0d1628;
  border-bottom:1px solid #0d1628;cursor:pointer;
  display:flex;flex-direction:column;align-items:center;justify-content:center;gap:2px;
  transition:background .06s;}
.abtn:last-child{border-right:none;}
.abtn:active,.abtn.pressed{background:#0a1830;}
.abtn-ico{font-size:26px;line-height:1;}
.abtn-lbl{font-family:'Orbitron',sans-serif;font-size:11px;color:#1a3050;letter-spacing:.5px;}
#aMap{font-size:14px;color:#2a4060;font-family:Orbitron,sans-serif;padding:4px;}
#aSp.rdy{background:#0e0800;}
#aSp.rdy .abtn-lbl{color:#ffc944;}
#aSp.rdy .abtn-ico{filter:drop-shadow(0 0 8px #ffc944);}
/* Results */
.res-ov{position:absolute;inset:0;z-index:50;display:none;
  flex-direction:column;align-items:center;justify-content:center;background:rgba(0,0,0,.92);}
.res-big{font-family:'Orbitron',sans-serif;font-size:44px;font-weight:900;letter-spacing:4px;
  animation:rp .4s ease-out;}
@keyframes rp{from{transform:scale(.08);opacity:0;}65%{transform:scale(1.12);}to{transform:scale(1);opacity:1;}}
.res-sub{font-family:'Orbitron',sans-serif;font-size:14px;letter-spacing:4px;color:#2a4060;margin:6px 0 18px;}
.res-card{background:#060a12;border:1px solid #162030;border-radius:10px;
  padding:14px 32px;text-align:center;margin-bottom:18px;}
.rc-ico{font-size:36px;}.rc-lbl{font-size:14px;color:#2a4060;margin-top:4px;}
.rc-val{font-family:'Orbitron',sans-serif;font-size:24px;color:#ffc944;margin-top:2px;}
.rbtn{background:linear-gradient(135deg,#093670,#0e6ec8);border:1px solid #00f5ff;
  color:#fff;font-family:'Orbitron',sans-serif;font-size:12px;letter-spacing:2px;
  padding:12px 32px;cursor:pointer;margin:4px;
  clip-path:polygon(8px 0,100% 0,calc(100% - 8px) 100%,0 100%);}
.rbtn.g{background:transparent;border-color:#162030;color:#2a4060;}

/* ‚ïê‚ïê‚ïê GACHA ‚ïê‚ïê‚ïê */
#sGacha{background:#03050e;}
.gacha-body{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:14px;padding:16px;}
.gm-wrap{position:relative;width:180px;height:180px;}
#gmCvs{position:absolute;inset:0;}
.gm-ctr{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:58px;pointer-events:none;}
.gi-ttl{font-family:'Orbitron',sans-serif;font-size:14px;color:#2a4060;letter-spacing:3px;}
.gi-cost{display:flex;align-items:center;justify-content:center;gap:6px;font-size:13px;color:#4a6080;}
.gi-cost b{font-family:'Orbitron',sans-serif;font-size:20px;color:#ffc944;}
.gpbtn{width:260px;padding:17px;cursor:pointer;border:2px solid #ffc944;
  background:linear-gradient(135deg,#502400,#b05000);color:#fff;
  font-family:'Orbitron',sans-serif;font-size:16px;letter-spacing:3px;
  clip-path:polygon(12px 0,100% 0,calc(100% - 12px) 100%,0 100%);
  box-shadow:0 0 22px #ffc94455;transition:filter .15s,transform .1s;}
.gpbtn:active{transform:scale(.95);}
.gpbtn:disabled{opacity:.28;cursor:not-allowed;transform:none;}
.rtbl{width:100%;max-width:280px;border:1px solid #0d1628;border-radius:8px;overflow:hidden;}
.rtbl-r{display:flex;justify-content:space-between;padding:6px 12px;
  border-bottom:1px solid #090f1a;font-size:14px;}
.rtbl-r:last-child{border-bottom:none;}
/* Gacha result */
#gRes{position:absolute;inset:0;z-index:80;display:none;
  flex-direction:column;align-items:center;justify-content:center;background:rgba(0,0,0,.96);overflow:hidden;}
#grBg{position:absolute;inset:0;}
.gr-in{position:relative;z-index:2;display:flex;flex-direction:column;align-items:center;gap:5px;}
.gr-ico{font-size:74px;animation:grp .5s ease-out;}
@keyframes grp{from{transform:scale(0) rotate(-180deg);opacity:0;}70%{transform:scale(1.2);}to{transform:scale(1);opacity:1;}}
.gr-rar{font-family:'Orbitron',sans-serif;font-size:14px;letter-spacing:5px;}
.gr-tp{font-family:'Orbitron',sans-serif;font-size:13px;letter-spacing:3px;margin-top:2px;}
.gr-nm{font-family:'Orbitron',sans-serif;font-size:24px;font-weight:900;letter-spacing:2px;margin-top:4px;}
.gr-desc{font-size:14px;color:#2a4060;line-height:1.75;text-align:center;max-width:260px;margin-top:6px;}
.gr-new{background:#ff3ea5;color:#fff;font-family:'Orbitron',sans-serif;font-size:12px;letter-spacing:2px;padding:3px 10px;border-radius:10px;margin-top:4px;}
.gr-cls{margin-top:18px;padding:11px 40px;background:transparent;border:1px solid #162030;
  color:#2a4060;font-family:'Orbitron',sans-serif;font-size:14px;letter-spacing:2px;cursor:pointer;border-radius:4px;}

/* ‚ïê‚ïê‚ïê TUTORIAL / ‰øÆË°å„É¢„Éº„Éâ ‚ïê‚ïê‚ïê */
#sTutorial{background:#02040c;}
#tutCvs{position:absolute;inset:0;touch-action:none;}
/* „Çπ„ÉÜ„ÉÉ„Éó„Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº */
#tutSteps{position:absolute;top:0;left:0;right:0;z-index:20;
  padding:8px 12px;background:rgba(0,2,10,.92);border-bottom:1px solid #0d1628;
  display:flex;align-items:center;gap:8px;pointer-events:none;}
.tst{width:22px;height:4px;border-radius:2px;background:#0d1628;transition:background .3s;}
.tst.done{background:#00f5ff;}.tst.cur{background:#ffc944;animation:tpulse 1s infinite alternate;}
@keyframes tpulse{from{opacity:.5;}to{opacity:1;}}
@keyframes lockedShake{0%,100%{transform:translateX(0);}25%{transform:translateX(-4px);}75%{transform:translateX(4px);}}
#tutTitle{font-family:'Orbitron',sans-serif;font-size:12px;letter-spacing:3px;color:#2a4060;margin-left:auto;}
/* „É°„Ç§„É≥„É°„ÉÉ„Çª„Éº„Ç∏ */
#tutMsg{position:absolute;z-index:20;pointer-events:none;
  left:12px;right:12px;}
.tmsg-box{background:rgba(3,8,20,.92);border:1px solid #0d2040;border-radius:10px;
  padding:12px 14px;text-align:center;}
.tmsg-head{font-family:'Orbitron',sans-serif;font-size:14px;letter-spacing:3px;
  color:#ffc944;margin-bottom:6px;}
.tmsg-body{font-size:14px;color:#8ab0cc;line-height:1.75;}
.tmsg-body b{color:#00f5ff;}
.tmsg-body em{color:#ff88aa;font-style:normal;}
/* „Ç¢„ÇØ„Ç∑„Éß„É≥Âº∑Ë™ø */
#tutHighlight{position:absolute;z-index:15;border-radius:8px;pointer-events:none;
  border:2px solid #ffc944;box-shadow:0 0 18px #ffc94466;
  transition:all .35s cubic-bezier(.34,1.56,.64,1);display:none;}
/* „Çπ„Ç≠„ÉÉ„Éó„ÉªÊ¨°„Å∏„Éú„Çø„É≥ */
#tutCtrl{position:absolute;bottom:0;left:0;right:0;z-index:25;
  padding:8px 10px calc(8px + var(--safe-bottom));background:rgba(2,4,12,.9);border-top:1px solid #0d1628;
  display:flex;gap:8px;}
.tbtn{flex:1;padding:10px;border:1px solid #162030;background:transparent;
  color:#2a4060;font-family:'Orbitron',sans-serif;font-size:14px;letter-spacing:1px;
  cursor:pointer;border-radius:6px;transition:all .12s;}
.tbtn:active{background:#0a1828;}
.tbtn-next{border-color:#00f5ff;color:#00f5ff;background:rgba(0,100,180,.12);}
.tbtn-next:active{background:rgba(0,140,220,.25);}
/* Áü¢Âç∞„Ç¢„Éã„É° */
.t-arrow{position:absolute;z-index:22;font-size:22px;pointer-events:none;
  animation:tarrow .7s ease-in-out infinite alternate;}
@keyframes tarrow{from{transform:translateY(0);}to{transform:translateY(6px);}}
/* ÂÆå‰∫ÜÁîªÈù¢ */
#tutComplete{position:absolute;inset:0;z-index:40;display:none;
  flex-direction:column;align-items:center;justify-content:center;background:rgba(0,0,0,.95);}
.tc-big{font-family:'Orbitron',sans-serif;font-size:32px;font-weight:900;color:#ffc944;
  text-shadow:0 0 28px #ffc944;animation:rp .5s ease-out;}
.tc-sub{font-family:'Orbitron',sans-serif;font-size:12px;letter-spacing:4px;color:#2a4060;margin:8px 0 22px;}
.tc-list{background:#060a12;border:1px solid #162030;border-radius:10px;padding:14px 18px;width:88%;margin-bottom:20px;}
.tc-item{display:flex;align-items:center;gap:10px;padding:5px 0;border-bottom:1px solid #090f1a;font-size:14px;color:#4a6880;}
.tc-item:last-child{border-bottom:none;}
.tc-ico{font-size:18px;width:24px;text-align:center;}

/* ‚ïê‚ïê‚ïê BOTTOM NAV ‚ïê‚ïê‚ïê */
.bnav-btn{flex:1;border:none;background:transparent;cursor:pointer;
  display:flex;flex-direction:column;align-items:center;justify-content:center;gap:3px;
  padding:8px 0;transition:background .12s;-webkit-tap-highlight-color:transparent;}
.bnav-btn:active{background:rgba(0,80,160,.2);}
.bnav-ico{font-size:20px;line-height:1;}
.bnav-lbl{font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:1px;color:#2a4060;transition:color .15s;}
.bnav-btn.active .bnav-lbl{color:#00f5ff;}
.bnav-btn.active .bnav-ico{filter:drop-shadow(0 0 6px #00f5ff);}
/* Screens that show bottom nav get bottom padding so content isn't hidden */
#sMenu.has-bnav{padding-bottom:calc(58px + var(--safe-bottom));}
#sGacha.has-bnav .gacha-body{padding-bottom:calc(58px + var(--safe-bottom));}

/* „Ç≥„É≥„ÉúË°®Á§∫ */
#comboDisplay{position:absolute;right:12px;z-index:12;pointer-events:none;text-align:right;
  font-family:'Orbitron',sans-serif;transition:opacity .3s;}
#comboNum{font-size:28px;font-weight:900;line-height:1;text-shadow:0 0 16px currentColor;}
#comboLbl{font-size:10px;letter-spacing:2px;color:#2a4060;margin-top:1px;}
/* „Éù„Éº„Ç∫„Ç™„Éº„Éê„Éº„É¨„Ç§ */
#pauseOv{position:absolute;inset:0;z-index:60;display:none;
  flex-direction:column;align-items:center;justify-content:center;
  background:rgba(0,2,12,.88);backdrop-filter:blur(4px);}
.pause-title{font-family:'Orbitron',sans-serif;font-size:32px;font-weight:900;
  color:#00f5ff;text-shadow:0 0 28px #00f5ff;letter-spacing:4px;margin-bottom:32px;}
.pause-btn{padding:14px 40px;margin:6px;font-family:'Orbitron',sans-serif;font-size:14px;
  letter-spacing:2px;cursor:pointer;border-radius:6px;border:1px solid;transition:all .12s;}
.pause-btn:active{filter:brightness(1.3);}
.pause-btn-resume{background:linear-gradient(135deg,#093670,#0e6ec8);color:#fff;border-color:#00f5ff;}
.pause-btn-menu{background:transparent;color:#2a4060;border-color:#162030;}
/* „Ç≥„Ç§„É≥„Ç¢„Éã„É° */
@keyframes coinPop{0%{transform:scale(1);}50%{transform:scale(1.4);}100%{transform:scale(1);}}
.coin-pop{animation:coinPop .3s ease-out;}
/* ÊïµÊÆã„Çä„Ç´„Ç¶„É≥„Çø„Éº */
#enemyCount{position:absolute;top:8px;left:50%;transform:translateX(-50%);
  font-family:'Orbitron',sans-serif;font-size:11px;color:#2a4060;letter-spacing:1px;
  z-index:10;pointer-events:none;white-space:nowrap;}
/* „Éè„Ç§„Çπ„Ç≥„Ç¢ */
#hiScoreLbl{position:absolute;right:12px;top:28px;font-family:'Orbitron',sans-serif;
  font-size:9px;color:#1a2a3a;letter-spacing:1px;z-index:10;pointer-events:none;}
/* „Çπ„ÉÜ„Éº„Çø„Çπ„Éê„Éº„Ç¢„Éã„É° */
.bfill{transition:width .15s linear;}
/* „ÉÄ„É°„Éº„Ç∏„Éï„É©„ÉÉ„Ç∑„É• */
@keyframes dmgFlash{0%{opacity:.8;}100%{opacity:0;}} @-webkit-keyframes dmgFlash{0%{opacity:.8;}100%{opacity:0;}}
#dmgOv{position:absolute;inset:0;z-index:28;pointer-events:none;display:none;
  background:radial-gradient(ellipse at 50% 50%,transparent 30%,rgba(255,0,50,.35) 100%);}
/* Êé•Á∂öÁ∑öÔºà„Çπ„ÉÜ„Éº„Ç∏ÈÅ∏ÊäûÔºâ */
.stage-connector{display:flex;align-items:center;justify-content:center;
  width:100%;height:16px;margin:-4px 0;}
.stage-connector-line{flex:1;max-width:60px;height:1px;background:#0d1628;}
/* „Ç≠„É£„É©„Ç´„Éº„Éâ„ÅÆË©≥Á¥∞ÊÉÖÂ†± */
.ccard-sel-info{font-size:11px;color:#00f5ff;text-align:center;padding:8px;
  background:rgba(0,100,180,.08);border:1px solid #00f5ff22;border-radius:8px;
  margin:0 10px;flex-shrink:0;line-height:1.6;}
/* „É™„Éà„É©„Ç§„Éú„Çø„É≥Âº∑Ë™ø */
#resLose .rbtn:first-of-type{margin-top:20px;background:linear-gradient(135deg,#501010,#c02020);
  border-color:#ff2233;box-shadow:0 0 20px #ff223344;}
/* ÂøÖÊÆ∫ÊäÄÂêç„ÅÆÊó•Êú¨Ë™û„É´„Éì */
.sp-rb{font-size:12px;letter-spacing:4px;color:rgba(255,255,255,.6);
  margin-top:4px;opacity:0;transition:opacity .28s .2s;}

/* ‚ïê‚ïê‚ïê STAGE EDITOR ‚ïê‚ïê‚ïê */
#sEditor{background:#02040c;overflow-y:auto;}
.ed-header{flex-shrink:0;padding:10px 14px;background:rgba(2,4,12,.96);
  border-bottom:1px solid #0d1628;display:flex;align-items:center;gap:10px;position:sticky;top:0;z-index:10;}
.ed-title{font-family:'Orbitron',sans-serif;font-size:15px;color:#ffc944;letter-spacing:2px;flex:1;}
.ed-body{padding:12px;display:flex;flex-direction:column;gap:14px;padding-bottom:80px;}

/* Section cards */
.ed-card{background:#06090f;border:1px solid #0d1628;border-radius:12px;overflow:hidden;}
.ed-card-hd{font-family:'Orbitron',sans-serif;font-size:11px;letter-spacing:2px;
  color:#2a4060;padding:8px 12px;background:#040710;border-bottom:1px solid #0d1628;}
.ed-card-body{padding:12px;}

/* Stage name/desc input */
.ed-input{width:100%;background:#040810;border:1px solid #0d1628;border-radius:6px;
  color:#c8dff0;font-family:'M PLUS Rounded 1c',sans-serif;font-size:14px;
  padding:10px 12px;outline:none;resize:none;}
.ed-input:focus{border-color:#00f5ff44;}
.ed-textarea{height:64px;}

/* Enemy palette */
.enemy-palette{display:flex;gap:8px;flex-wrap:wrap;}
.ep-item{display:flex;flex-direction:column;align-items:center;gap:4px;
  padding:10px 8px;border-radius:8px;cursor:pointer;border:1.5px solid #0d1628;
  background:#040810;transition:all .12s;min-width:64px;}
.ep-item:active{transform:scale(.9);}
.ep-item.ep-sel{border-color:#ffc944;background:#0a0c04;box-shadow:0 0 12px #ffc94433;}
.ep-ico{font-size:22px;line-height:1;}
.ep-nm{font-family:'Orbitron',sans-serif;font-size:9px;color:#2a4060;letter-spacing:.5px;}
.ep-cnt{font-family:'Orbitron',sans-serif;font-size:11px;color:#ffc944;min-width:20px;text-align:center;}

/* Enemy count controls */
.enemy-row{display:flex;align-items:center;gap:8px;padding:6px 0;
  border-bottom:1px solid #04070e;}
.enemy-row:last-child{border-bottom:none;}
.er-ico{font-size:20px;width:28px;text-align:center;}
.er-name{font-family:'Orbitron',sans-serif;font-size:11px;color:#4a6880;flex:1;}
.er-ctrl{display:flex;align-items:center;gap:6px;}
.er-btn{width:28px;height:28px;border-radius:6px;border:1px solid #0d1628;
  background:#040810;color:#c8dff0;font-size:16px;cursor:pointer;
  display:flex;align-items:center;justify-content:center;transition:background .1s;}
.er-btn:active{background:#0a1428;}
.er-val{font-family:'Orbitron',sans-serif;font-size:14px;color:#00f5ff;
  width:32px;text-align:center;}

/* Boss selector */
.boss-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;}
.boss-card{padding:10px;border-radius:8px;border:1.5px solid #0d1628;
  background:#040810;cursor:pointer;text-align:center;transition:all .12s;}
.boss-card:active{transform:scale(.95);}
.boss-card.boss-sel{border-color:#ff3344;box-shadow:0 0 14px #ff334433;background:#110208;}
.boss-ico{font-size:24px;margin-bottom:4px;}
.boss-nm{font-family:'Orbitron',sans-serif;font-size:9px;color:#4a6880;letter-spacing:.5px;}
.boss-hp{font-size:10px;color:#2a4060;margin-top:2px;}

/* Difficulty slider */
.diff-track{width:100%;height:6px;background:#040810;border-radius:3px;
  -webkit-appearance:none;appearance:none;outline:none;cursor:pointer;}
.diff-track::-webkit-slider-thumb{-webkit-appearance:none;width:20px;height:20px;
  border-radius:50%;background:#00f5ff;box-shadow:0 0 8px #00f5ff88;cursor:pointer;}
.diff-labels{display:flex;justify-content:space-between;margin-top:4px;}
.diff-lbl{font-family:'Orbitron',sans-serif;font-size:9px;color:#1a3050;}

/* BG color picker */
.bg-swatches{display:flex;gap:8px;flex-wrap:wrap;}
.bg-sw{width:36px;height:36px;border-radius:6px;cursor:pointer;
  border:2px solid transparent;transition:all .12s;}
.bg-sw.bg-sw-sel{border-color:#fff;box-shadow:0 0 10px currentColor;}
.bg-sw:active{transform:scale(.85);}

/* Obstacle toggle */
.obs-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;}
.obs-item{padding:10px 6px;border-radius:8px;border:1.5px solid #0d1628;
  background:#040810;cursor:pointer;text-align:center;transition:all .12s;}
.obs-item.obs-sel{border-color:#00f5ff;background:#020a12;box-shadow:0 0 10px #00f5ff22;}
.obs-ico{font-size:20px;}
.obs-nm{font-family:'Orbitron',sans-serif;font-size:9px;color:#2a4060;margin-top:3px;}

/* Publish button */
.pub-btn{width:100%;padding:16px;border-radius:10px;
  background:linear-gradient(135deg,#6b1200,#cc2800);
  border:1px solid #ff4400;color:#fff;
  font-family:'Orbitron',sans-serif;font-size:15px;letter-spacing:3px;
  cursor:pointer;transition:filter .12s;}
.pub-btn:active{filter:brightness(1.3);}
.pub-btn:disabled{opacity:.4;cursor:default;}

/* Test button */
.test-btn{width:100%;padding:14px;border-radius:10px;
  background:linear-gradient(135deg,#063a10,#0e7020);
  border:1px solid #00ff66;color:#fff;
  font-family:'Orbitron',sans-serif;font-size:14px;letter-spacing:2px;
  cursor:pointer;margin-bottom:8px;}

/* ‚ïê‚ïê‚ïê COMMUNITY ‚ïê‚ïê‚ïê */
#sCommunity{background:#02040c;overflow-y:auto;}
.cm-header{flex-shrink:0;padding:10px 14px;background:rgba(2,4,12,.96);
  border-bottom:1px solid #0d1628;display:flex;align-items:center;gap:10px;position:sticky;top:0;z-index:10;}
.cm-title{font-family:'Orbitron',sans-serif;font-size:15px;color:#44ffaa;letter-spacing:2px;flex:1;}
.cm-body{padding:12px;display:flex;flex-direction:column;gap:10px;padding-bottom:80px;}
.cm-tabs{display:flex;gap:8px;margin-bottom:4px;}
.cm-tab{flex:1;padding:8px;border-radius:6px;border:1px solid #0d1628;
  background:#040810;color:#2a4060;font-family:'Orbitron',sans-serif;font-size:10px;
  letter-spacing:1px;cursor:pointer;text-align:center;transition:all .12s;}
.cm-tab.cm-tab-act{background:#040e20;border-color:#44ffaa;color:#44ffaa;}

/* Stage card in community */
.cm-card{background:#06090f;border:1px solid #0d1628;border-radius:12px;
  padding:14px;display:flex;flex-direction:column;gap:8px;cursor:pointer;transition:all .12s;}
.cm-card:active{transform:scale(.97);}
.cm-card:hover{border-color:#1a2840;}
.cm-card-top{display:flex;align-items:flex-start;gap:10px;}
.cm-card-ico{font-size:28px;flex-shrink:0;}
.cm-card-info{flex:1;min-width:0;}
.cm-card-name{font-family:'Orbitron',sans-serif;font-size:13px;color:#c8dff0;
  letter-spacing:1px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.cm-card-author{font-size:11px;color:#2a4060;margin-top:2px;}
.cm-card-desc{font-size:12px;color:#4a6880;line-height:1.5;
  display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;}
.cm-card-stats{display:flex;gap:12px;align-items:center;}
.cm-stat{font-family:'Orbitron',sans-serif;font-size:10px;color:#1a3050;}
.cm-stat-val{color:#ffc944;}
.cm-diff-badge{padding:3px 8px;border-radius:10px;font-family:'Orbitron',sans-serif;
  font-size:9px;letter-spacing:1px;}
.diff-e{background:#041408;color:#44ff88;border:1px solid #44ff8844;}
.diff-n{background:#080e02;color:#aaff00;border:1px solid #aaff0044;}
.diff-h{background:#0e0800;color:#ffc944;border:1px solid #ffc94444;}
.diff-x{background:#0e0008;color:#ff44aa;border:1px solid #ff44aa44;}
.cm-play-btn{padding:8px 16px;border-radius:6px;border:1px solid #00f5ff44;
  background:#020810;color:#00f5ff;font-family:'Orbitron',sans-serif;font-size:10px;
  letter-spacing:1px;cursor:pointer;flex-shrink:0;align-self:flex-start;}
.cm-play-btn:active{background:#040e20;}
.cm-empty{text-align:center;padding:40px 20px;color:#1a3050;
  font-family:'Orbitron',sans-serif;font-size:12px;letter-spacing:2px;line-height:2;}
.cm-loading{text-align:center;padding:30px;color:#2a4060;font-size:13px;}
.cm-likes{color:#ff44aa !important;}

/* Published badge on editor */
.pub-success{display:none;text-align:center;padding:12px;border-radius:8px;
  background:#041408;border:1px solid #44ff88;color:#44ff88;
  font-family:'Orbitron',sans-serif;font-size:12px;letter-spacing:1px;}

/* My stages tab */
.my-del-btn{padding:5px 10px;border-radius:5px;border:1px solid #ff334422;
  background:transparent;color:#ff4455;font-size:11px;cursor:pointer;}

/* ‚îÄ‚îÄ‚îÄ „Çπ„ÉÜ„Éº„Ç∏Ë©≥Á¥∞„Éª„Ç≥„É°„É≥„Éà ‚îÄ‚îÄ‚îÄ */
#sStageDetail{background:#02040c;overflow-y:auto;}
.sd-header{flex-shrink:0;padding:10px 14px;background:rgba(2,4,12,.96);border-bottom:1px solid #0d1628;display:flex;align-items:center;gap:10px;position:sticky;top:0;z-index:10;}
.sd-body{padding:12px;display:flex;flex-direction:column;gap:12px;padding-bottom:24px;}
.sd-hero{background:#06090f;border:1px solid #0d1628;border-radius:12px;padding:16px;}
.sd-name{font-family:'Orbitron',sans-serif;font-size:16px;color:#c8dff0;letter-spacing:1px;}
.sd-sub{font-size:12px;color:#2a4060;margin-top:4px;}
.sd-desc{font-size:13px;color:#6a8898;line-height:1.6;margin-top:8px;}
.sd-meta{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px;}
.sd-tag{padding:3px 10px;border-radius:10px;font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:1px;background:#040810;border:1px solid #0d1628;color:#2a4060;}
.sd-actions{display:flex;gap:8px;}
.sd-play-btn{flex:1;padding:14px;border-radius:8px;background:linear-gradient(135deg,#093670,#0e6ec8);border:1px solid #00f5ff;color:#fff;font-family:'Orbitron',sans-serif;font-size:14px;letter-spacing:2px;cursor:pointer;}
.sd-play-btn:active{filter:brightness(1.3);}
.sd-del-btn{padding:14px 16px;border-radius:8px;border:1px solid #ff334422;background:#0e0204;color:#ff4455;font-size:18px;cursor:pointer;}
.sd-del-btn:active{background:#1e0408;}
.sec-title{font-family:'Orbitron',sans-serif;font-size:11px;letter-spacing:2px;color:#2a4060;margin-bottom:8px;}
.comment-row{display:flex;gap:8px;margin-bottom:12px;}
.comment-inp{flex:1;background:#040810;border:1px solid #0d1628;border-radius:8px;color:#c8dff0;font-family:'M PLUS Rounded 1c',sans-serif;font-size:13px;padding:10px 12px;outline:none;}
.comment-inp:focus{border-color:#00f5ff44;}
.comment-send-btn{padding:0 14px;border-radius:8px;border:1px solid #00f5ff44;background:#020810;color:#00f5ff;font-family:'Orbitron',sans-serif;font-size:12px;cursor:pointer;}
.comment-send-btn:active{background:#040e20;}
.cmt-list{display:flex;flex-direction:column;gap:8px;}
.cmt-item{background:#06090f;border:1px solid #0d1628;border-radius:8px;padding:10px 12px;}
.cmt-head{display:flex;align-items:center;gap:8px;margin-bottom:4px;}
.cmt-author{font-family:'Orbitron',sans-serif;font-size:10px;color:#4a6880;flex:1;}
.cmt-time{font-size:10px;color:#1a3050;}
.cmt-del{font-size:11px;color:#ff334488;cursor:pointer;background:none;border:none;padding:2px 6px;}
.cmt-del:active{color:#ff3344;}
.cmt-body{font-size:13px;color:#8ab0cc;line-height:1.5;}
.cmt-empty{text-align:center;padding:20px;color:#1a3050;font-family:'Orbitron',sans-serif;font-size:11px;letter-spacing:1px;}
/* cm„Ç´„Éº„Éâ„ÅÆ„Ç¢„ÇØ„Ç∑„Éß„É≥Ë°å */
.cm-card-foot{display:flex;align-items:center;justify-content:space-between;gap:8px;}
.cm-del-btn{padding:5px 10px;border-radius:5px;border:1px solid #ff334422;background:transparent;color:#ff4455;font-size:10px;cursor:pointer;font-family:'Orbitron',sans-serif;}
.cm-del-btn:active{background:#0e0204;}

/* ‚îÄ‚îÄ‚îÄ YouTubeÈ¢®„Ç≥„Éü„É•„Éã„ÉÜ„Ç£ ‚îÄ‚îÄ‚îÄ */
.yt-grid{display:flex;flex-direction:column;gap:0;}
.yt-card{display:flex;flex-direction:column;background:#06090f;
  border-bottom:1px solid #0a0e18;cursor:pointer;transition:background .12s;overflow:hidden;}
.yt-card:active{background:#040710;}
.yt-thumb{width:100%;aspect-ratio:16/9;background:#02040c;position:relative;
  display:flex;align-items:center;justify-content:center;overflow:hidden;flex-shrink:0;}
.yt-thumb-bg{position:absolute;inset:0;opacity:.18;}
.yt-thumb-boss{font-size:52px;position:relative;z-index:1;text-shadow:0 0 30px currentColor;}
.yt-thumb-diff{position:absolute;top:6px;right:6px;z-index:2;}
.yt-thumb-dur{position:absolute;bottom:6px;right:6px;z-index:2;
  background:rgba(0,0,0,.8);padding:2px 6px;border-radius:3px;
  font-family:'Orbitron',sans-serif;font-size:9px;color:#ffc944;}
.yt-thumb-play{position:absolute;bottom:6px;left:6px;z-index:2;
  width:28px;height:28px;border-radius:50%;background:rgba(0,245,255,.15);
  border:1.5px solid #00f5ff;display:flex;align-items:center;justify-content:center;
  font-size:10px;color:#00f5ff;}
.yt-info{padding:10px 12px;display:flex;gap:8px;}
.yt-author-ico{width:32px;height:32px;border-radius:50%;background:#040810;
  border:1px solid #0d1628;flex-shrink:0;display:flex;align-items:center;justify-content:center;
  font-size:16px;}
.yt-meta{flex:1;min-width:0;}
.yt-title{font-family:'Orbitron',sans-serif;font-size:12px;color:#c8dff0;
  letter-spacing:.5px;line-height:1.4;
  display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;}
.yt-sub{font-size:11px;color:#2a4060;margin-top:4px;line-height:1.6;}
.yt-sub span{color:#3a5070;}
.yt-actions{display:flex;gap:6px;padding:0 12px 10px;align-items:center;}
.yt-desc{font-size:11px;color:#3a5870;flex:1;line-height:1.5;
  display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;overflow:hidden;}
.yt-play-btn{padding:6px 14px;border-radius:16px;border:none;
  background:linear-gradient(135deg,#00f5ff22,#0088ff33);
  border:1px solid #00f5ff44;color:#00f5ff;
  font-family:'Orbitron',sans-serif;font-size:10px;letter-spacing:1px;
  cursor:pointer;flex-shrink:0;white-space:nowrap;}
.yt-play-btn:active{background:#040e20;}
.yt-del-btn{padding:6px 10px;border-radius:16px;border:1px solid #ff334422;
  background:transparent;color:#ff4455;font-size:11px;cursor:pointer;flex-shrink:0;}
/* „Éï„Ç£„Éº„ÉÅ„É£„Éº„Ç´„Éº„ÉâÔºà‰∏ä‰ΩçË°®Á§∫Ôºâ */
.yt-featured{border-bottom:2px solid #0d1628;margin-bottom:4px;}
.yt-featured .yt-thumb{aspect-ratio:3/2;}
.yt-featured .yt-thumb-boss{font-size:72px;}
/* „Ç´„ÉÜ„Ç¥„É™„Éò„ÉÉ„ÉÄ„Éº */
.yt-section-header{padding:10px 12px 6px;font-family:'Orbitron',sans-serif;
  font-size:11px;letter-spacing:2px;color:#2a4060;border-bottom:1px solid #040810;}
/* Á©∫Áä∂ÊÖã */
.yt-empty{text-align:center;padding:60px 20px;color:#1a3050;
  font-family:'Orbitron',sans-serif;font-size:11px;letter-spacing:2px;line-height:2.4;}
.yt-empty-ico{font-size:48px;margin-bottom:16px;}

/* ‚îÄ‚îÄ‚îÄ „Éâ„É≠„ÉÉ„Éó„Ç¢„Ç§„ÉÜ„É†„Éª„Ç¨„Éº„Éâ ‚îÄ‚îÄ‚îÄ */
.guard-flash{animation:guardFlash .3s ease;}
@keyframes guardFlash{0%{opacity:1}50%{opacity:.2}100%{opacity:1}}
</style>
</head>
<body>
<div id="app"><div id="G">

<!-- ‚ïê‚ïê‚ïê MENU ‚ïê‚ïê‚ïê -->
<div id="sMenu" class="scr on">
  <canvas id="menuCvs" width="360" height="620"></canvas>
  <div class="logo-wrap">
    <div class="logo-en">THE ULTIMATE SKY BATTLE</div>
    <div class="logo-main">SKY<br>RAIDERS</div>
    <div class="logo-jp">Á©∫„ÇíÂà∂„Åô„ÇãËÄÖ„Åå‰∏ñÁïå„ÇíÂà∂„Åô</div>
  </div>
  <div class="menu-btns">
    <button class="mbtn mbtn-b" onclick="UI.goStage()">‚öî Êà¶„ÄÄÈóò</button>
    <button class="mbtn mbtn-g" onclick="UI.goGacha()">üé∞ „Ç¨„ÄÄ„ÉÅ„É£</button>
    <button class="mbtn" style="background:linear-gradient(135deg,#0a2a18,#1a6040);color:#44ff88;border:1px solid #44ff88;box-shadow:0 0 18px #44ff8833;" onclick="TUT.start()">ü•ã ‰øÆ„ÄÄË°å</button>
    <div style="display:flex;gap:12px;">
      <button class="mbtn" style="flex:1;background:linear-gradient(135deg,#1a1000,#3a2800);color:#ffc944;border:1px solid #ffc94466;box-shadow:0 0 16px #ffc94422;font-size:14px;" onclick="UI.goEditor()">üõ† ‰Ωú„ÄÄ„Çã</button>
      <button class="mbtn" style="flex:1;background:linear-gradient(135deg,#001a10,#003828);color:#44ffaa;border:1px solid #44ffaa66;box-shadow:0 0 16px #44ffaa22;font-size:14px;" onclick="UI.goCommunity()">üåç „Åø„Çì„Å™</button>
    </div>
  </div>
  <div class="menu-coin" style="flex-direction:column;gap:6px;">
    <div style="display:flex;align-items:center;gap:10px;">‚öôÔ∏è ÈâÑ„ÅÆÊ¨†ÁâáÔºö<span id="coinM">0</span></div>
    <div style="display:flex;align-items:center;gap:10px;font-size:15px;color:#bb88ff;">üåà Ëôπ„ÅÆÊ¨†ÁâáÔºö<span id="rainbowM">0</span></div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê STAGE SELECT ‚ïê‚ïê‚ïê -->
<div id="sStage" class="scr">
  <canvas id="stageCvs" width="360" height="620" style="position:absolute;inset:0;pointer-events:none;"></canvas>
  <div class="top-bar">
    <button class="back-btn" onclick="UI.goMenu()">‚óÄ Êàª„Çã</button>
    <span class="tb-title">‚öî „Çπ„ÉÜ„Éº„Ç∏ÈÅ∏Êäû</span>
  </div>
  <div class="stage-scr" id="stageList"></div>
</div>

<!-- ‚ïê‚ïê‚ïê CHAR SELECT ‚ïê‚ïê‚ïê -->
<div id="sChar" class="scr">
  <div class="top-bar">
    <button class="back-btn" onclick="UI.goStage()">‚óÄ Êàª„Çã</button>
    <span class="tb-title">‚úà „Éë„Ç§„É≠„ÉÉ„ÉàÈÅ∏Êäû</span>
  </div>
  <div class="char-info">
    <div class="ci-stage" id="ciStage">STAGE 1</div>
    <div class="ci-boss" id="ciBoss">vs WRAITH MK.I</div>
  </div>
  <div class="char-grid" id="charGrid"></div>
  <div id="selCharInfo" class="ccard-sel-info" style="display:none;margin:0 10px 4px;"></div>
  <div id="scroll-hint" style="text-align:center;font-size:12px;color:#1a3050;font-family:Orbitron,sans-serif;padding:4px;letter-spacing:1px;flex-shrink:0;">‚Üë SCROLL TO SELECT ‚Üë</div>
  <div class="go-row">
    <button class="back-btn" onclick="UI.goStage()" style="padding:14px 16px;font-size:12px;">‚óÄ Êàª„Çã</button>
    <button class="go-btn" onclick="BAT.start()">‚ñ∂ Âá∫ÊíÉÔºÅ</button>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê BATTLE ‚ïê‚ïê‚ïê -->
<div id="sBattle" class="scr">
  <canvas id="batCvs" width="360" height="620"></canvas>
  <div id="hudTop">
    <div class="hud-row">
      <div class="bgrp">
        <div class="blbl">HP</div>
        <div class="btrack thp"><div class="bfill fhp" id="hpBar" style="width:100%"></div></div>
        <div class="blbl" style="margin-top:2px">SP</div>
        <div class="btrack tsp"><div class="bfill fsp" id="spBar" style="width:0%"></div></div>
        <div class="blbl" id="guardLbl" style="margin-top:2px;color:#44aaff;display:none;">üõ°</div>
        <div class="btrack" style="display:none;" id="guardTrack"><div class="bfill" id="guardBar" style="width:100%;background:#44aaff;box-shadow:0 0 8px #44aaff;"></div></div>
      </div>
      <div id="hudScore">0</div>
    </div>
  </div>
  <div id="hudWave"></div>
  <div id="enemyCount"></div>
  <div id="comboDisplay" style="top:36px;opacity:0;">
    <div id="comboNum" style="color:#ffc944">0</div>
    <div id="comboLbl">COMBO</div>
  </div>
  <div id="hiScoreLbl"></div>
  <div id="hudBoss">
    <div id="bossLbl">BOSS</div>
    <div class="btrack2"><div class="bfill2" id="bossBar" style="width:100%"></div></div>
  </div>
  <div id="spOv">
    <canvas id="spOvCvs" width="360" height="620"></canvas>
    <div class="spTxt" id="spTxt">
      <div class="sp-who" id="spWho"></div>
      <div class="sp-nm" id="spNm"></div>
      <div class="sp-rb" id="spRb"></div>
    </div>
  </div>
  <div id="spFlash"></div>
  <div id="dmgOv"></div>
  <!-- Pause overlay -->
  <div id="pauseOv">
    <div class="pause-title">‚Äî PAUSE ‚Äî</div>
    <button class="pause-btn pause-btn-resume" onclick="BAT.resumeGame()">‚ñ∂ RESUME</button>
    <button class="pause-btn" style="padding:14px 40px;margin:6px;font-family:Orbitron,sans-serif;font-size:14px;letter-spacing:2px;cursor:pointer;border-radius:6px;background:transparent;color:#ffc944;border:1px solid #ffc94444;" onclick="BAT.retryFromPause()">‚Ü∫ RETRY</button>
    <button class="pause-btn pause-btn-menu" onclick="BAT.quitToMenu()">‚úï MENU</button>
  </div>
  <!-- Controls -->
  <div id="ctrl">
    <div id="dpad">
      <button class="dp" id="dpU">‚Üë</button>
      <button class="dp" id="dpL">‚Üê</button>
      <div class="dp" id="dpCtr">MOVE</div>
      <button class="dp" id="dpR">‚Üí</button>
      <button class="dp" id="dpD">‚Üì</button>
    </div>
    <div id="actions">
      <div class="act-row">
        <button class="abtn" id="aFire"><span class="abtn-ico">üí•</span><span class="abtn-lbl">FIRE</span></button>
        <button class="abtn" id="aSp"><span class="abtn-ico">‚ö°</span><span class="abtn-lbl">SPECIAL</span></button>
      </div>
      <div class="act-row">
        <button class="abtn" id="aMap" style="font-size:13px;color:#2a4060;font-family:Orbitron,sans-serif;letter-spacing:.5px;"><span class="abtn-ico">‚è∏</span><span class="abtn-lbl">PAUSE</span></button>
        <button class="abtn" id="aBlank" style="pointer-events:none;opacity:0;"></button>
      </div>
    </div>
  </div>
  <!-- Results -->
  <div class="res-ov" id="resWin">
    <div class="res-big" style="color:#ffc944;text-shadow:0 0 30px #ffc944">VICTORY!</div>
    <div class="res-sub">STAGE CLEAR</div>
    <div class="res-card">
      <div style="display:flex;gap:20px;align-items:flex-start;justify-content:center;">
        <div><div class="rc-ico">‚öôÔ∏è</div><div class="rc-lbl">ÈâÑ„ÅÆÊ¨†Áâá</div><div class="rc-val" id="winCoin">+1</div></div>
        <div><div class="rc-ico">üèÜ</div><div class="rc-lbl">„Çπ„Ç≥„Ç¢</div><div class="rc-val" id="winScore" style="font-size:18px;color:#00f5ff">0</div></div>
        <div><div class="rc-ico">‚ö°</div><div class="rc-lbl">MAX COMBO</div><div class="rc-val" id="winCombo" style="font-size:18px;color:#ff88aa">0√ó</div></div>
        <div><div class="rc-ico">üíÄ</div><div class="rc-lbl">ÊíÉÂ¢ú</div><div class="rc-val" id="winKills" style="font-size:18px;color:#44ff88">0Ê©ü</div></div>
      </div>
    </div>
    <button class="rbtn" onclick="UI.goMenu()">CONTINUE ‚Üí</button>
  </div>
  <div class="res-ov" id="resLose">
    <div class="res-big" style="color:#ff2233;text-shadow:0 0 30px #ff2233">DEFEAT</div>
    <div class="res-sub">ÊíÉÂ¢ú„Åï„Çå„Åæ„Åó„Åü</div>
    <div class="res-card" style="margin-bottom:12px">
      <div style="display:flex;gap:16px;justify-content:center;">
        <div><div class="rc-ico">üèÜ</div><div class="rc-lbl">„Çπ„Ç≥„Ç¢</div><div class="rc-val" id="loseScore" style="font-size:18px;color:#ff6644">0</div></div>
        <div><div class="rc-ico">üíÄ</div><div class="rc-lbl">ÊíÉÂ¢ú</div><div class="rc-val" id="loseKills" style="font-size:18px;color:#ff8844">0Ê©ü</div></div>
      </div>
    </div>
    <button class="rbtn" style="margin-top:4px" onclick="BAT.start()">‚Ü∫ RETRY</button>
    <button class="rbtn g" onclick="UI.goMenu()">‚óÄ „É°„Éã„É•„Éº„Å∏</button>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê GACHA ‚ïê‚ïê‚ïê -->
<div id="sGacha" class="scr">
  <div class="top-bar">
    <button class="back-btn" onclick="UI.goMenu()">‚óÄ Êàª„Çã</button>
    <span class="tb-title" style="color:#ffc944">üé∞ „Ç¨„ÉÅ„É£</span>
    <span style="margin-left:auto;font-size:13px;color:#2a4060;font-family:Orbitron,sans-serif;">‚öôÔ∏è <span id="coinG">0</span></span>
  </div>
  <div class="gacha-body">
    <div class="gm-wrap">
      <canvas id="gmCvs" width="180" height="180"></canvas>
      <div class="gm-ctr">üé∞</div>
    </div>
    <div style="text-align:center;">
      <div class="gi-ttl">‚Äî IRON GACHA ‚Äî</div>
      <div class="gi-cost" style="margin-top:4px;">ÈâÑ„ÅÆÊ¨†Áâá <b>1</b> ÂÄã„Åß 1Âõû</div>
    </div>
    <button class="gpbtn" id="gBtn" onclick="GACHA.pull()">üé∞ GACHA √ó1</button>
    <div class="rtbl">
      <div class="rtbl-r" style="background:#110700;"><span style="color:#ff8f00">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ LEGENDARY</span><span style="color:#1a2a40">2%</span></div>
      <div class="rtbl-r" style="background:#0c0518;"><span style="color:#b43fff">‚òÖ‚òÖ‚òÖ‚òÖ EPIC</span><span style="color:#1a2a40">8%</span></div>
      <div class="rtbl-r" style="background:#050c1c;"><span style="color:#3a8fff">‚òÖ‚òÖ‚òÖ RARE</span><span style="color:#1a2a40">20%</span></div>
      <div class="rtbl-r"><span style="color:#3ebf6a">‚òÖ‚òÖ UNCOMMON</span><span style="color:#1a2a40">30%</span></div>
      <div class="rtbl-r"><span style="color:#6a7484">‚òÖ COMMON</span><span style="color:#1a2a40">40%</span></div>
    </div>
  </div>
</div>


<!-- ‚ïê‚ïê‚ïê ‰øÆË°å„É¢„Éº„Éâ TUTORIAL ‚ïê‚ïê‚ïê -->
<div id="sTutorial" class="scr">
  <canvas id="tutCvs" width="360" height="620"></canvas>
  <!-- „Çπ„ÉÜ„ÉÉ„ÉóË°®Á§∫ -->
  <div id="tutSteps">
    <div class="tst" id="ts0"></div>
    <div class="tst" id="ts1"></div>
    <div class="tst" id="ts2"></div>
    <div class="tst" id="ts3"></div>
    <div class="tst" id="ts4"></div>
    <div class="tst" id="ts5"></div>
    <div class="tst" id="ts6"></div>
    <div class="tst" id="ts7"></div>
    <span id="tutTitle">‰øÆË°å„É¢„Éº„Éâ</span>
  </div>
  <!-- „É°„ÉÉ„Çª„Éº„Ç∏ -->
  <div id="tutMsg" style="top:56px;"></div>
  <!-- „Éè„Ç§„É©„Ç§„ÉàÊû† -->
  <div id="tutHighlight"></div>
  <!-- Áü¢Âç∞„Éí„É≥„Éà -->
  <div class="t-arrow" id="tutArrow" style="display:none;">üëá</div>
  <!-- „Ç≥„É≥„Éà„É≠„Éº„É´ -->
  <div id="ctrl2" style="position:absolute;bottom:52px;left:0;right:0;height:120px;background:rgba(2,4,12,.92);border-top:1px solid #0d1628;display:flex;">
    <div id="dpad2" style="width:200px;height:120px;position:relative;flex-shrink:0;">
      <button class="dp" id="dpU2" style="left:66px;top:4px;width:64px;height:36px;">‚Üë</button>
      <button class="dp" id="dpL2" style="left:4px;top:42px;width:58px;height:36px;">‚Üê</button>
      <div class="dp" style="left:66px;top:42px;width:64px;height:36px;background:rgba(0,40,80,.3);border-radius:50%;font-size:8px;color:#1a3050;font-family:Orbitron,sans-serif;">MOVE</div>
      <button class="dp" id="dpR2" style="left:132px;top:42px;width:58px;height:36px;">‚Üí</button>
      <button class="dp" id="dpD2" style="left:66px;top:80px;width:64px;height:36px;">‚Üì</button>
    </div>
    <div style="flex:1;height:120px;display:flex;flex-direction:column;border-left:1px solid #0d1628;">
      <div style="display:flex;flex:1;">
        <button class="abtn" id="tFire"><span class="abtn-ico">üí•</span><span class="abtn-lbl">FIRE</span></button>
        <button class="abtn" id="tSp2" style="border-right:none;"><span class="abtn-ico">‚ö°</span><span class="abtn-lbl">SPECIAL</span></button>
      </div>
      <div style="display:flex;flex:1;border-top:1px solid #0d1628;">
        <div style="flex:1;display:flex;align-items:center;justify-content:center;font-size:12px;color:#1a3050;font-family:Orbitron,sans-serif;border-right:1px solid #0d1628;">HP / SP „Éê„Éº</div>
        <div style="flex:1;display:flex;align-items:center;justify-content:center;font-size:12px;color:#1a3050;font-family:Orbitron,sans-serif;">„Çπ„Ç≥„Ç¢</div>
      </div>
    </div>
  </div>
  <!-- Ê¨°„Å∏/„Çπ„Ç≠„ÉÉ„Éó -->
  <div id="tutCtrl">
    <button class="tbtn" onclick="TUT.skip()">‚úï „Çπ„Ç≠„ÉÉ„Éó</button>
    <button class="tbtn tbtn-next" id="tutNext" onclick="TUT.next()">Ê¨°„Å∏ ‚Üí</button>
  </div>
  <!-- ÂÆå‰∫Ü„Ç™„Éº„Éê„Éº„É¨„Ç§ -->
  <div id="tutComplete">
    <div class="tc-big">‰øÆË°åÂÆå‰∫ÜÔºÅ</div>
    <div class="tc-sub">TRAINING COMPLETE</div>
    <div class="tc-list">
      <div class="tc-item"><span class="tc-ico">üïπÔ∏è</span>ÊñπÂêë„Éú„Çø„É≥ or „Ç≠„É£„É≥„Éê„Çπ„Éâ„É©„ÉÉ„Ç∞„ÅßÁßªÂãï</div>
      <div class="tc-item"><span class="tc-ico">üí•</span>FIRE„ÇíÈï∑Êäº„Åó„ÅßÈÄ£Á∂öÂ∞ÑÊíÉ</div>
      <div class="tc-item"><span class="tc-ico">‚ö°</span>SP„ÅåÊ∫ú„Åæ„Å£„Åü„ÇâSPECIAL„ÅßÂøÖÊÆ∫ÊäÄ</div>
      <div class="tc-item"><span class="tc-ico">üëæ</span>Êïµ„Çí40%ÂÄí„Åô„Å®„Éú„ÇπÂá∫Áèæ</div>
      <div class="tc-item"><span class="tc-ico">üé∞</span>„Ç¨„ÉÅ„É£„ÅßÊñ∞„Ç≠„É£„É©„Éª„Ç¢„Ç§„ÉÜ„É†Ëß£Êîæ</div>
      <div class="tc-item"><span class="tc-ico">‚≠ê</span>ÂÖ®8„Çπ„ÉÜ„Éº„Ç∏„Çí„ÇØ„É™„Ç¢„Åó„Çà„ÅÜ</div>
    </div>
    <button class="tbtn tbtn-next" style="width:80%;padding:14px;" onclick="TUT.finish()">Âá∫ÊíÉÔºÅ ‚ñ∂</button>
  </div>
</div>

<!-- Gacha result overlay (outside screens, global z-index) -->
<div id="gRes" style="position:absolute;inset:0;z-index:200;display:none;flex-direction:column;align-items:center;justify-content:center;background:rgba(0,0,0,.96);">
  <canvas id="grBg" width="360" height="620" style="position:absolute;inset:0;"></canvas>
  <div class="gr-in">
    <div class="gr-ico" id="grIco">üéÅ</div>
    <div class="gr-rar" id="grRar">‚òÖ COMMON</div>
    <div class="gr-tp" id="grTp">‚úà NEW PLANE</div>
    <div class="gr-nm" id="grNm">STRIKER</div>
    <div class="gr-desc" id="grDesc">Âü∫Êú¨Êà¶ÈóòÊ©ü„ÄÇ</div>
    <div class="gr-new" id="grNew" style="display:none">‚òÖ NEW!</div>
    <button class="gr-cls" onclick="GACHA.closeResult()">‚Äî CLOSE ‚Äî</button>
  </div>
</div>


<!-- ‚ïê‚ïê‚ïê BOTTOM NAV BAR ‚ïê‚ïê‚ïê -->
<nav id="bottomNav" style="position:absolute;bottom:0;left:0;right:0;z-index:100;
  height:calc(58px + var(--safe-bottom));padding-bottom:var(--safe-bottom);
  background:rgba(2,4,12,.97);border-top:1px solid #0d1628;
  display:none;flex-direction:row;backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);">
  <button class="bnav-btn" id="bnBattle" onclick="UI.goMenu();UI._bnSelect('bnBattle')">
    <span class="bnav-ico">‚öîÔ∏è</span>
    <span class="bnav-lbl">„Éê„Éà„É´</span>
  </button>
  <button class="bnav-btn" id="bnGacha" onclick="UI.goGacha();UI._bnSelect('bnGacha')">
    <span class="bnav-ico">üé∞</span>
    <span class="bnav-lbl">„Ç¨„ÉÅ„É£</span>
  </button>
  <button class="bnav-btn" id="bnTrain" onclick="TUT.start();UI._bnSelect('bnTrain')">
    <span class="bnav-ico">ü•ã</span>
    <span class="bnav-lbl">‰øÆË°å</span>
  </button>
</nav>

<!-- ‚ïê‚ïê‚ïê STAGE EDITOR ‚ïê‚ïê‚ïê -->
<div id="sEditor" class="scr">
  <div class="ed-header">
    <button class="back-btn" onclick="UI.goMenu()">‚óÄ</button>
    <div class="ed-title">üõ† „Çπ„ÉÜ„Éº„Ç∏‰ΩúÊàê</div>
    <div style="font-family:Orbitron,sans-serif;font-size:10px;color:#2a4060;" id="edDraftLbl">‰∏ãÊõ∏„Åç</div>
  </div>
  <div class="ed-body">
    <div class="ed-card">
      <div class="ed-card-hd">üìù „Çπ„ÉÜ„Éº„Ç∏ÊÉÖÂ†±</div>
      <div class="ed-card-body" style="display:flex;flex-direction:column;gap:8px;">
        <input class="ed-input" id="edName" placeholder="„Çπ„ÉÜ„Éº„Ç∏ÂêçÔºà‰æãÔºöÂú∞ÁçÑ„ÅÆÂõûÂªäÔºâ" maxlength="24">
        <textarea class="ed-input ed-textarea" id="edDesc" placeholder="Ë™¨Êòé„Éª„Ç≥„É°„É≥„ÉàÔºà‰æãÔºöÊïµ„ÅåÂ§ö„ÅÑÔºÅÊÖéÈáç„Å´ÔºÅÔºâ" maxlength="80"></textarea>
        <div style="display:flex;gap:8px;align-items:center;">
          <span style="font-size:11px;color:#2a4060;font-family:Orbitron,sans-serif;">‰ΩúËÄÖÂêç</span>
          <input class="ed-input" id="edAuthor" placeholder="„Éã„ÉÉ„ÇØ„Éç„Éº„É†" maxlength="16" style="flex:1;">
        </div>
      </div>
    </div>
    <div class="ed-card">
      <div class="ed-card-hd">üëæ Êïµ„ÅÆÁ∑®Êàê</div>
      <div class="ed-card-body">
        <div class="enemy-row">
          <div class="er-ico">üî¥</div>
          <div class="er-name">BASIC<br><span style="font-size:9px;color:#1a3050;">Ê®ôÊ∫ñÁöÑ„Å™Êïµ</span></div>
          <div class="er-ctrl">
            <button class="er-btn" onclick="ED.adjustEnemy('basic',-5)">‚àí</button>
            <div class="er-val" id="evBasic">20</div>
            <button class="er-btn" onclick="ED.adjustEnemy('basic',5)">Ôºã</button>
          </div>
        </div>
        <div class="enemy-row">
          <div class="er-ico">üü°</div>
          <div class="er-name">ZIGZAG<br><span style="font-size:9px;color:#1a3050;">Â∑¶Âè≥„Å´Êè∫„Çå„Çã</span></div>
          <div class="er-ctrl">
            <button class="er-btn" onclick="ED.adjustEnemy('zigzag',-5)">‚àí</button>
            <div class="er-val" id="evZigzag">10</div>
            <button class="er-btn" onclick="ED.adjustEnemy('zigzag',5)">Ôºã</button>
          </div>
        </div>
        <div class="enemy-row">
          <div class="er-ico">üîµ</div>
          <div class="er-name">HEAVY<br><span style="font-size:9px;color:#1a3050;">È´òËÄê‰πÖ„Éª‰ΩéÈÄü</span></div>
          <div class="er-ctrl">
            <button class="er-btn" onclick="ED.adjustEnemy('heavy',-5)">‚àí</button>
            <div class="er-val" id="evHeavy">5</div>
            <button class="er-btn" onclick="ED.adjustEnemy('heavy',5)">Ôºã</button>
          </div>
        </div>
        <div class="enemy-row">
          <div class="er-ico">üü£</div>
          <div class="er-name">SNIPER<br><span style="font-size:9px;color:#1a3050;">Á≤æÂØÜÂ∞ÑÊíÉÂûã</span></div>
          <div class="er-ctrl">
            <button class="er-btn" onclick="ED.adjustEnemy('sniper',-5)">‚àí</button>
            <div class="er-val" id="evSniper">5</div>
            <button class="er-btn" onclick="ED.adjustEnemy('sniper',5)">Ôºã</button>
          </div>
        </div>
        <div style="margin-top:10px;padding:8px;background:#020508;border-radius:6px;
          font-family:Orbitron,sans-serif;font-size:10px;color:#2a4060;text-align:center;">
          ÂêàË®à: <span id="edTotalEnemies" style="color:#00f5ff;">40</span> ‰Ωì
        </div>
      </div>
    </div>
    <div class="ed-card">
      <div class="ed-card-hd">üíÄ „Éú„ÇπÈÅ∏Êäû</div>
      <div class="ed-card-body">
        <div class="boss-grid" id="bossGrid"></div>
      </div>
    </div>
    <div class="ed-card">
      <div class="ed-card-hd">‚ö° Èõ£ÊòìÂ∫¶</div>
      <div class="ed-card-body">
        <input type="range" class="diff-track" id="edDiff" min="0" max="3" value="1"
          oninput="ED.updateDiff(this.value)">
        <div class="diff-labels">
          <span class="diff-lbl">EASY</span><span class="diff-lbl">NORMAL</span>
          <span class="diff-lbl">HARD</span><span class="diff-lbl">HELL</span>
        </div>
        <div style="text-align:center;margin-top:8px;" id="edDiffLbl">
          <span class="cm-diff-badge diff-n">NORMAL</span>
        </div>
      </div>
    </div>
    <div class="ed-card">
      <div class="ed-card-hd">üåå ËÉåÊôØ„ÉÜ„Éº„Éû</div>
      <div class="ed-card-body">
        <div class="bg-swatches" id="bgSwatches"></div>
      </div>
    </div>
    <div class="ed-card">
      <div class="ed-card-hd">ü™® ÈöúÂÆ≥Áâ© <span style="font-size:9px;color:#1a3050;">ÔºàË§áÊï∞ÈÅ∏ÊäûÂèØÔºâ</span></div>
      <div class="ed-card-body">
        <div class="obs-grid" id="obsGrid"></div>
      </div>
    </div>
    <button class="test-btn" onclick="ED.testPlay()">‚ñ∂ „ÉÜ„Çπ„Éà„Éó„É¨„Ç§</button>
    <div id="pubSuccess" class="pub-success">‚úì ÂÖ¨Èñã„Åó„Åæ„Åó„ÅüÔºÅ„Åø„Çì„Å™„ÅÆ„Ç≤„Éº„É†„ÅßÈÅä„Åπ„Åæ„Åô</div>
    <button class="pub-btn" id="pubBtn" onclick="ED.publish()">üåç ÂÖ¨Èñã„Åô„Çã</button>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê STAGE DETAIL ‚ïê‚ïê‚ïê -->
<div id="sStageDetail" class="scr">
  <div class="sd-header">
    <button class="back-btn" onclick="UI.goCommunity()">‚óÄ</button>
    <div style="font-family:'Orbitron',sans-serif;font-size:13px;color:#c8dff0;flex:1;letter-spacing:1px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;" id="sdTitle">Ë©≥Á¥∞</div>
    <button class="sd-del-btn" id="sdDelBtn" style="display:none" onclick="CM.delCurrent()">üóë</button>
  </div>
  <div class="sd-body">
    <div class="sd-hero">
      <div style="display:flex;gap:12px;align-items:flex-start;">
        <div style="font-size:40px;" id="sdIco">üëæ</div>
        <div style="flex:1;">
          <div class="sd-name" id="sdName">-</div>
          <div class="sd-sub" id="sdSub">-</div>
          <div class="sd-desc" id="sdDesc">-</div>
        </div>
      </div>
      <div class="sd-meta" id="sdMeta"></div>
    </div>
    <div class="sd-actions">
      <button class="sd-play-btn" id="sdPlayBtn">‚öî „Éó„É¨„Ç§„Åô„Çã</button>
    </div>
    <div>
      <div class="sec-title">üí¨ „Ç≥„É°„É≥„Éà <span id="sdCmtCnt" style="color:#ffc944;"></span></div>
      <div class="comment-row">
        <input class="comment-inp" id="sdCmtInp" placeholder="„Ç≥„É°„É≥„Éà„ÇíÊõ∏„Åè..." maxlength="100">
        <button class="comment-send-btn" onclick="CM.sendComment()">ÈÄÅ‰ø°</button>
      </div>
      <div class="cmt-list" id="sdCmtList"><div class="cmt-empty">Ë™≠„ÅøËæº„Åø‰∏≠...</div></div>
    </div>
  </div>
</div>
<!-- ‚ïê‚ïê‚ïê COMMUNITY ‚ïê‚ïê‚ïê -->
<div id="sCommunity" class="scr">
  <div class="cm-header">
    <button class="back-btn" onclick="UI.goMenu()">‚óÄ</button>
    <div class="cm-title">üåç „Åø„Çì„Å™„ÅÆ„Ç≤„Éº„É†</div>
    <div style="display:flex;align-items:center;gap:8px;">
      <div style="font-family:Orbitron,sans-serif;font-size:10px;color:#2a4060;" id="cmCount"></div>
      <button onclick="CM.load()" style="padding:4px 10px;border-radius:5px;border:1px solid #0d1628;background:#040810;color:#44ffaa;font-family:Orbitron,sans-serif;font-size:10px;cursor:pointer;">‚Üª</button>
    </div>
  </div>
  <div class="cm-body">
    <div class="cm-tabs">
      <button class="cm-tab cm-tab-act" id="cmTabAll" onclick="CM.switchTab('all')">üåê „Åô„Åπ„Å¶</button>
      <button class="cm-tab" id="cmTabNew" onclick="CM.switchTab('new')">üÜï Êñ∞ÁùÄ</button>
      <button class="cm-tab" id="cmTabMine" onclick="CM.switchTab('mine')">üë§ Ëá™ÂàÜ</button>
    </div>
    <div id="cmList"><div class="cm-loading">Ë™≠„ÅøËæº„Åø‰∏≠...</div></div>
  </div>
</div>
</nav>
</div></div>

<script>
'use strict';
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  SKY RAIDERS  ‚Äî nyanko-style complete
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let W=360, H=620;
function resizeGame(){
  const prevW=W,prevH=H;
  const g=document.getElementById('G');
  if(!g)return;
  W=g.clientWidth||360;
  H=g.clientHeight||620;
  // Resize all game canvases
  ['batCvs','menuCvs','stageCvs','spOvCvs','tutCvs','gmCvs','grBg'].forEach(id=>{
    const c=document.getElementById(id);
    if(!c)return;
    if(id==='gmCvs'){c.width=180;c.height=180;return;}
    c.width=W;c.height=H;
  });
}
window.addEventListener('beforeunload',()=>{doSave();});
window.addEventListener('visibilitychange',()=>{if(document.visibilityState==='hidden')doSave();});
window.addEventListener('resize',()=>{
  resizeGame();
  // ËÉåÊôØ„Ç¢„Éã„É°„ÇíÂÜçËµ∑Âãï
  if(UI.cur==='sMenu') UI.menuBg();
  else if(UI.cur==='sStage') UI.stageBg();
});
// Also fire on orientation change
window.addEventListener('orientationchange',()=>{setTimeout(resizeGame,200);});

// ‚îÄ‚îÄ‚îÄ SAVE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const DEF_SAVE={coins:15,rainbow:0,cleared:[],hangar:['p0'],upgrades:{},spUps:{},hiscore:0};
let SAV=JSON.parse(JSON.stringify(DEF_SAVE));
const SAVE_KEY='skyRd5';
const SAVE_KEY_BAK='skyRd5_bak'; // „Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„Ç≠„Éº

// ‚îÄ‚îÄ Â†ÖÁâ¢„Å™„Çª„Éº„ÉñÔºà„É°„Ç§„É≥Ôºã„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„ÅÆ2Èáç‰øùÂ≠òÔºâ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function doSave(){
  try{
    // hangar „ÅåÂøÖ„ÅöÈÖçÂàó„Åß„ÅÇ„Çã„Åì„Å®„Çí‰øùË®º
    if(!Array.isArray(SAV.hangar)) SAV.hangar=DEF_SAVE.hangar.slice();
    // p0„ÅØÁµ∂ÂØæ„Å´ÂÖ•„Çå„Å¶„Åä„Åè
    if(!SAV.hangar.includes('p0')) SAV.hangar.unshift('p0');
    const json=JSON.stringify(SAV);
    localStorage.setItem(SAVE_KEY, json);
    localStorage.setItem(SAVE_KEY_BAK, json); // „Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„Å´„ÇÇÂêåÊôÇ‰øùÂ≠ò
  }catch(e){}
}

// ‚îÄ‚îÄ Â†ÖÁâ¢„Å™„É≠„Éº„ÉâÔºà„É°„Ç§„É≥Â§±ÊïóÊôÇ„ÅØ„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„Åã„ÇâÂæ©ÂÖÉÔºâ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function doLoad(){
  const tryParse=(str)=>{
    try{ const d=JSON.parse(str); return (d&&typeof d==='object')?d:null; }catch(e){ return null; }
  };
  let data=null;
  // „É°„Ç§„É≥„Åã„ÇâË™≠„ÇÄ
  try{ data=tryParse(localStorage.getItem(SAVE_KEY)); }catch(e){}
  // Â§±Êïó„Åó„Åü„Çâ„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„Åã„Çâ
  if(!data){
    try{ data=tryParse(localStorage.getItem(SAVE_KEY_BAK)); }catch(e){}
  }
  if(data){
    Object.assign(SAV, data);
    // hangar „ÅåÈÖçÂàó„Åß„Å™„ÅÑÂ†¥Âêà„ÅØ‰øÆÂæ©
    if(!Array.isArray(SAV.hangar)) SAV.hangar=DEF_SAVE.hangar.slice();
    // p0„ÅØÁµ∂ÂØæ‰øùÊåÅ
    if(!SAV.hangar.includes('p0')) SAV.hangar.unshift('p0');
    // „É≠„Éº„ÉâÁõ¥Âæå„Å´„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„ÇÇÁ¢∫ÂÆü„Å´ÂêåÊúü
    try{
      const json=JSON.stringify(SAV);
      localStorage.setItem(SAVE_KEY, json);
      localStorage.setItem(SAVE_KEY_BAK, json);
    }catch(e){}
  }
}
doLoad();

// ‚îÄ‚îÄ‚îÄ PLANES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const PLANES={
  p0:{id:'p0',name:'STRIKER',r:1,ico:'‚úàÔ∏è',col:'#00f5ff',spd:1.8,hp:85,cd:22,hitR:5,bStyle:'tri3',sp:{name:'NOVA BURST',rb:'„Éé„É¥„Ç°„Éª„Éê„Éº„Çπ„Éà',cost:100},desc:'Ê±éÁî®Âûã„ÄÇ',atk:2,def:2,spd_s:2},
  p1:{id:'p1',name:'FALCON',r:1,ico:'ü¶Ö',col:'#88bbff',spd:1.9,hp:85,cd:22,hitR:5,bStyle:'fan5',sp:{name:'DIVE SHOT',rb:'„ÉÄ„Ç§„Éñ„Éª„Ç∑„Éß„ÉÉ„Éà',cost:80},desc:'È´òÊ©üÂãïÂûã„ÄÇ',atk:3,def:3,spd_s:2},
  p2:{id:'p2',name:'IRON TANK',r:1,ico:'üõ°Ô∏è',col:'#88aa55',spd:1.8,hp:84,cd:22,hitR:5,bStyle:'big3',sp:{name:'SHIELD BLAST',rb:'„Ç∑„Éº„É´„Éâ„Éª„Éñ„É©„Çπ„Éà',cost:72},desc:'ÈáçË£ÖÁî≤Âûã„ÄÇ',atk:4,def:2,spd_s:2},
  p3:{id:'p3',name:'PHANTOM',r:1,ico:'üëª',col:'#cc88ff',spd:1.9,hp:79,cd:22,hitR:5,bStyle:'fast3',sp:{name:'GHOST SHOT',rb:'„Ç¥„Éº„Çπ„Éà„Éª„Ç∑„Éß„ÉÉ„Éà',cost:78},desc:'„Çπ„ÉÜ„É´„ÇπÂûã„ÄÇ',atk:2,def:3,spd_s:2},
  p4:{id:'p4',name:'THUNDER',r:1,ico:'‚ö°',col:'#ffee33',spd:1.9,hp:74,cd:22,hitR:5,bStyle:'wide5',sp:{name:'LIGHTNING',rb:'„É©„Ç§„Éà„Éã„É≥„Ç∞',cost:88},desc:'ÈõªÊíÉÂûã„ÄÇ',atk:3,def:2,spd_s:2},
  p5:{id:'p5',name:'VIPER',r:1,ico:'üêç',col:'#44ff88',spd:1.7,hp:76,cd:22,hitR:5,bStyle:'rapid2',sp:{name:'VENOM RUSH',rb:'„É¥„Çß„Éé„É†„Éª„É©„ÉÉ„Ç∑„É•',cost:66},desc:'ÊúÄÈÄüÂûã„ÄÇ',atk:4,def:3,spd_s:2},
  p6:{id:'p6',name:'STORM EAGLE',r:1,ico:'ü¶Ö',col:'#4488ff',spd:1.9,hp:73,cd:22,hitR:5,bStyle:'v5',sp:{name:'STORM CALL',rb:'„Çπ„Éà„Éº„É†„Éª„Ç≥„Éº„É´',cost:100},desc:'Âµê„ÅÆÂäõ„ÄÇ',atk:2,def:2,spd_s:2},
  p7:{id:'p7',name:'BLAZE WOLF',r:1,ico:'üê∫',col:'#ff6644',spd:1.7,hp:77,cd:22,hitR:5,bStyle:'bomb5',sp:{name:'HOWLING FIRE',rb:'„Éè„Ç¶„É™„É≥„Ç∞„Éª„Éï„Ç°„Ç§„Ç¢',cost:108},desc:'ÁàÜÊíÉÂûã„ÄÇ',atk:3,def:3,spd_s:2},
  p8:{id:'p8',name:'VOID STRIKER',r:1,ico:'üåë',col:'#aa44ff',spd:1.9,hp:86,cd:22,hitR:5,bStyle:'ring8',sp:{name:'DARK NOVA',rb:'„ÉÄ„Éº„ÇØ„Éª„Éé„É¥„Ç°',cost:118},desc:'Ê¨°ÂÖÉÂûã„ÄÇ',atk:4,def:2,spd_s:2},
  p9:{id:'p9',name:'SOLAR PHOENIX',r:1,ico:'üî•',col:'#ff8800',spd:1.9,hp:72,cd:22,hitR:5,bStyle:'solar',sp:{name:'SOLAR FLARE',rb:'„ÇΩ„Éº„É©„Éº„Éª„Éï„É¨„Ç¢',cost:128},desc:'Â§™ÈôΩÂûã„ÄÇ',atk:2,def:3,spd_s:2},
  p10:{id:'p10',name:'GOD EMPEROR',r:1,ico:'üëë',col:'#ffd700',spd:1.8,hp:79,cd:22,hitR:5,bStyle:'divine',sp:{name:'DIVINE WRATH',rb:'„Éá„Ç£„É¥„Ç°„Ç§„É≥„Éª„É©„Éº„Çπ',cost:140},desc:'Á•ûË£ÅÂûã„ÄÇ',atk:3,def:2,spd_s:2},
  p11:{id:'p11',name:'OMEGA VOID',r:1,ico:'üåå',col:'#ffffff',spd:1.7,hp:85,cd:22,hitR:5,bStyle:'apoc',sp:{name:'VOID APOCALYPSE',rb:'„É¥„Ç©„Ç§„Éâ„Éª„Ç¢„Éù„Ç´„É™„Éó„Çπ',cost:150},desc:'ÂÆáÂÆôÂûã„ÄÇ',atk:4,def:3,spd_s:2},
  p12:{id:'p12',name:'METEOR',r:1,ico:'üöÄ',col:'#ff2244',spd:1.8,hp:73,cd:22,hitR:5,bStyle:'tri3',sp:{name:'METEOR SHOWER',rb:'„É°„ÉÜ„Ç™„Éª„Ç∑„É£„ÉØ„Éº',cost:90},desc:'ÈöïÁü≥Âûã„ÄÇ',atk:2,def:2,spd_s:2},
  p13:{id:'p13',name:'ICE HAWK',r:1,ico:'üí´',col:'#00ff88',spd:1.7,hp:76,cd:22,hitR:5,bStyle:'fan5',sp:{name:'ICE LANCE',rb:'„Ç¢„Ç§„Çπ„Éª„É©„É≥„Çπ',cost:75},desc:'Ê∞∑ÁµêÂûã„ÄÇ',atk:3,def:3,spd_s:2},
  p14:{id:'p14',name:'PLASMA FOX',r:1,ico:'üå†',col:'#ff44aa',spd:1.8,hp:74,cd:22,hitR:5,bStyle:'big3',sp:{name:'PLASMA CANNON',rb:'„Éó„É©„Ç∫„Éû„Éª„Ç≠„É£„Éé„É≥',cost:85},desc:'„Éó„É©„Ç∫„ÉûÂûã„ÄÇ',atk:4,def:2,spd_s:2},
  p15:{id:'p15',name:'SHADOW WOLF',r:1,ico:'üåä',col:'#44ffee',spd:1.9,hp:85,cd:22,hitR:5,bStyle:'fast3',sp:{name:'SHADOW BLADE',rb:'„Ç∑„É£„Éâ„Ç¶„Éª„Éñ„É¨„Éº„Éâ',cost:70},desc:'ÂΩ±Âûã„ÄÇ',atk:2,def:3,spd_s:2},
  p16:{id:'p16',name:'AURORA',r:1,ico:'üå™Ô∏è',col:'#ff8844',spd:1.8,hp:82,cd:22,hitR:5,bStyle:'wide5',sp:{name:'AURORA RING',rb:'„Ç™„Éº„É≠„É©„Éª„É™„É≥„Ç∞',cost:95},desc:'„Ç™„Éº„É≠„É©Âûã„ÄÇ',atk:3,def:2,spd_s:2},
  p17:{id:'p17',name:'THUNDER CROSS',r:1,ico:'‚ùÑÔ∏è',col:'#88ff44',spd:1.9,hp:84,cd:22,hitR:5,bStyle:'rapid2',sp:{name:'THUNDER CROSS',rb:'„Çµ„É≥„ÉÄ„Éº„Éª„ÇØ„É≠„Çπ',cost:82},desc:'Èõ∑ÈõªÂûã„ÄÇ',atk:4,def:3,spd_s:2},
  p18:{id:'p18',name:'CRYSTAL',r:1,ico:'üî±',col:'#4444ff',spd:1.8,hp:72,cd:22,hitR:5,bStyle:'v5',sp:{name:'CRYSTAL BURST',rb:'„ÇØ„É™„Çπ„Çø„É´„Éª„Éê„Éº„Çπ„Éà',cost:92},desc:'Ê∞¥Êô∂Âûã„ÄÇ',atk:2,def:2,spd_s:2},
  p19:{id:'p19',name:'VOID RIFT',r:1,ico:'‚öîÔ∏è',col:'#ffaa00',spd:1.7,hp:85,cd:22,hitR:5,bStyle:'bomb5',sp:{name:'VOID RIFT',rb:'„É¥„Ç©„Ç§„Éâ„Éª„É™„Éï„Éà',cost:110},desc:'Ê¨°ÂÖÉË£Ç„ÅçÂûã„ÄÇ',atk:3,def:3,spd_s:2},
  p20:{id:'p20',name:'FLAME',r:1,ico:'üó°Ô∏è',col:'#ff4444',spd:1.8,hp:78,cd:22,hitR:5,bStyle:'ring8',sp:{name:'FLAME SPIRAL',rb:'„Éï„É¨„Ç§„É†„Éª„Çπ„Éë„Ç§„É©„É´',cost:98},desc:'ÁÇéÊóãÂõûÂûã„ÄÇ',atk:4,def:2,spd_s:2},
  p21:{id:'p21',name:'AQUA',r:1,ico:'üõ∏',col:'#44aaff',spd:1.7,hp:86,cd:22,hitR:5,bStyle:'solar',sp:{name:'AQUA TORRENT',rb:'„Ç¢„ÇØ„Ç¢„Éª„Éà„É¨„É≥„Éà',cost:88},desc:'Ê∞¥ÊµÅÂûã„ÄÇ',atk:2,def:3,spd_s:2},
  p22:{id:'p22',name:'WIND',r:1,ico:'üåã',col:'#aa88ff',spd:1.7,hp:73,cd:22,hitR:5,bStyle:'divine',sp:{name:'WIND SLASH',rb:'„Ç¶„Ç£„É≥„Éâ„Éª„Çπ„É©„ÉÉ„Ç∑„É•',cost:76},desc:'È¢®ÂàÉÂûã„ÄÇ',atk:3,def:2,spd_s:2},
  p23:{id:'p23',name:'EARTH',r:1,ico:'üîÆ',col:'#ff88aa',spd:1.9,hp:79,cd:22,hitR:5,bStyle:'apoc',sp:{name:'EARTH QUAKE',rb:'„Ç¢„Éº„Çπ„Éª„ÇØ„Ç®„Ç§„ÇØ',cost:84},desc:'Â§ßÂú∞Âûã„ÄÇ',atk:4,def:3,spd_s:2},
  p24:{id:'p24',name:'STAR',r:1,ico:'üí•',col:'#88ffaa',spd:1.8,hp:74,cd:22,hitR:5,bStyle:'tri3',sp:{name:'STAR RAIN',rb:'„Çπ„Çø„Éº„Éª„É¨„Ç§„É≥',cost:96},desc:'ÊòüÂ±ëÂûã„ÄÇ',atk:2,def:2,spd_s:2},
  p25:{id:'p25',name:'DARK',r:1,ico:'üåü',col:'#aaff88',spd:1.7,hp:86,cd:22,hitR:5,bStyle:'fan5',sp:{name:'DARK SPIRAL',rb:'„ÉÄ„Éº„ÇØ„Éª„Çπ„Éë„Ç§„É©„É´',cost:104},desc:'ÊöóÈªíÂûã„ÄÇ',atk:3,def:3,spd_s:2},
  p26:{id:'p26',name:'HOLY',r:1,ico:'ü¶ã',col:'#ffff44',spd:1.9,hp:75,cd:22,hitR:5,bStyle:'big3',sp:{name:'HOLY CROSS',rb:'„Éõ„Éº„É™„Éº„Éª„ÇØ„É≠„Çπ',cost:112},desc:'ËÅñÂÖâÂûã„ÄÇ',atk:4,def:2,spd_s:2},
  p27:{id:'p27',name:'CHAOS',r:1,ico:'üêâ',col:'#44ffff',spd:1.7,hp:84,cd:22,hitR:5,bStyle:'fast3',sp:{name:'CHAOS BURST',rb:'„Ç´„Ç™„Çπ„Éª„Éê„Éº„Çπ„Éà',cost:120},desc:'Ê∑∑Ê≤åÂûã„ÄÇ',atk:2,def:3,spd_s:2},
  p28:{id:'p28',name:'OMEGA',r:1,ico:'ü¶Å',col:'#ff44ff',spd:1.9,hp:76,cd:22,hitR:5,bStyle:'wide5',sp:{name:'OMEGA BEAM',rb:'„Ç™„É°„Ç¨„Éª„Éì„Éº„É†',cost:130},desc:'Á©∂Ê•µÂûã„ÄÇ',atk:3,def:2,spd_s:2},
  p29:{id:'p29',name:'LASER',r:1,ico:'üêØ',col:'#88aaff',spd:1.8,hp:83,cd:22,hitR:5,bStyle:'rapid2',sp:{name:'LASER RAIN',rb:'„É¨„Éº„Ç∂„Éº„Éª„É¨„Ç§„É≥',cost:86},desc:'„É¨„Éº„Ç∂„ÉºÂûã„ÄÇ',atk:4,def:3,spd_s:2},
  p30:{id:'p30',name:'POISON',r:1,ico:'ü¶ä',col:'#ffaa88',spd:1.9,hp:86,cd:22,hitR:5,bStyle:'v5',sp:{name:'POISON CLOUD',rb:'„Éù„Ç§„Ç∫„É≥„Éª„ÇØ„É©„Ç¶„Éâ',cost:78},desc:'ÊØíÊ∂≤Âûã„ÄÇ',atk:2,def:2,spd_s:2},
  p31:{id:'p31',name:'MAGNET',r:1,ico:'ü¶ù',col:'#88ffff',spd:1.8,hp:83,cd:22,hitR:5,bStyle:'bomb5',sp:{name:'MAGNET PULL',rb:'„Éû„Ç∞„Éç„ÉÉ„Éà„Éª„Éó„É´',cost:82},desc:'Á£ÅÊ∞óÂûã„ÄÇ',atk:3,def:3,spd_s:2},
  p32:{id:'p32',name:'GRAVITY',r:1,ico:'üêª',col:'#ff8888',spd:1.7,hp:86,cd:22,hitR:5,bStyle:'ring8',sp:{name:'GRAVITY WELL',rb:'„Ç∞„É©„É¥„Ç£„ÉÜ„Ç£„Éª„Ç¶„Çß„É´',cost:114},desc:'ÈáçÂäõÂûã„ÄÇ',atk:4,def:2,spd_s:2},
  p33:{id:'p33',name:'TIME',r:1,ico:'ü¶à',col:'#aaffaa',spd:1.9,hp:85,cd:22,hitR:5,bStyle:'solar',sp:{name:'TIME STOP',rb:'„Çø„Ç§„É†„Éª„Çπ„Éà„ÉÉ„Éó',cost:135},desc:'ÊôÇÈñìÂûã„ÄÇ',atk:2,def:3,spd_s:2},
  p34:{id:'p34',name:'DIMENSION',r:1,ico:'ü¶Ö',col:'#aaaaff',spd:1.9,hp:76,cd:22,hitR:5,bStyle:'divine',sp:{name:'DIMENSION CUT',rb:'„Éá„Ç£„É°„É≥„Ç∑„Éß„É≥„Éª„Ç´„ÉÉ„Éà',cost:118},desc:'Ê¨°ÂÖÉÂàáÊñ≠Âûã„ÄÇ',atk:3,def:2,spd_s:2},
  p35:{id:'p35',name:'REBIRTH',r:1,ico:'ü¶ú',col:'#ffaaaa',spd:1.9,hp:77,cd:22,hitR:5,bStyle:'apoc',sp:{name:'REBIRTH NOVA',rb:'„É™„Éê„Éº„Çπ„Éª„Éé„É¥„Ç°',cost:102},desc:'ÂÜçÁîüÂûã„ÄÇ',atk:4,def:3,spd_s:2},
  p36:{id:'p36',name:'CRIMSON',r:1,ico:'ü¶ö',col:'#aaffff',spd:1.8,hp:82,cd:22,hitR:5,bStyle:'tri3',sp:{name:'CRIMSON TIDE',rb:'„ÇØ„É™„É†„Çæ„É≥„Éª„Çø„Ç§„Éâ',cost:94},desc:'Ê∑±Á¥ÖÂûã„ÄÇ',atk:2,def:2,spd_s:2},
  p37:{id:'p37',name:'FROZEN',r:1,ico:'ü¶©',col:'#ff88ff',spd:1.9,hp:77,cd:22,hitR:5,bStyle:'fan5',sp:{name:'FROZEN WORLD',rb:'„Éï„É≠„Éº„Ç∫„É≥„Éª„ÉØ„Éº„É´„Éâ',cost:122},desc:'Ê∞∑Áµê‰∏ñÁïåÂûã„ÄÇ',atk:3,def:3,spd_s:2},
  p38:{id:'p38',name:'NEON',r:1,ico:'üßä',col:'#88ff88',spd:1.7,hp:77,cd:22,hitR:5,bStyle:'big3',sp:{name:'NEON BURST',rb:'„Éç„Ç™„É≥„Éª„Éê„Éº„Çπ„Éà',cost:88},desc:'„Éç„Ç™„É≥Âûã„ÄÇ',atk:4,def:2,spd_s:2},
  p39:{id:'p39',name:'PHOTON',r:1,ico:'üîÆ',col:'#ff88dd',spd:1.8,hp:87,cd:22,hitR:5,bStyle:'fast3',sp:{name:'PHOTON SWORD',rb:'„Éï„Ç©„Éà„É≥„Éª„ÇΩ„Éº„Éâ',cost:76},desc:'ÂÖâÂ≠êÂûã„ÄÇ',atk:2,def:3,spd_s:2},
  p40:{id:'p40',name:'GALAXY',r:2,ico:'üå∏',col:'#88ddff',spd:2.1,hp:102,cd:18,hitR:6,bStyle:'wide5',sp:{name:'GALAXY STORM',rb:'„ÇÆ„É£„É©„ÇØ„Ç∑„Éº„Éª„Çπ„Éà„Éº„É†',cost:132},desc:'ÈäÄÊ≤≥Âûã„ÄÇ',atk:4,def:3,spd_s:3},
  p41:{id:'p41',name:'ATOM',r:2,ico:'üå∫',col:'#ddff88',spd:2.3,hp:92,cd:18,hitR:6,bStyle:'rapid2',sp:{name:'ATOM SPLIT',rb:'„Ç¢„Éà„É†„Éª„Çπ„Éó„É™„ÉÉ„Éà',cost:126},desc:'Ê†∏ÂàÜË£ÇÂûã„ÄÇ',atk:5,def:4,spd_s:3},
  p42:{id:'p42',name:'PULSE',r:2,ico:'üåª',col:'#dd88ff',spd:2.3,hp:96,cd:18,hitR:6,bStyle:'v5',sp:{name:'PULSE WAVE',rb:'„Éë„É´„Çπ„Éª„Ç¶„Çß„Ç§„Éñ',cost:80},desc:'Ê≥¢ÂãïÂûã„ÄÇ',atk:3,def:3,spd_s:3},
  p43:{id:'p43',name:'VOID DRAIN',r:2,ico:'üåπ',col:'#ffdd88',spd:2.3,hp:106,cd:18,hitR:6,bStyle:'bomb5',sp:{name:'VOID DRAIN',rb:'„É¥„Ç©„Ç§„Éâ„Éª„Éâ„É¨„Ç§„É≥',cost:108},desc:'Âê∏ÂèéÂûã„ÄÇ',atk:4,def:4,spd_s:3},
  p44:{id:'p44',name:'PHOENIX',r:2,ico:'üíê',col:'#88ffdd',spd:2.1,hp:99,cd:18,hitR:6,bStyle:'ring8',sp:{name:'PHOENIX RISE',rb:'„Éï„Çß„Éã„ÉÉ„ÇØ„Çπ„Éª„É©„Ç§„Ç∫',cost:116},desc:'‰∏çÊ≠ªÈ≥•Âûã„ÄÇ',atk:5,def:3,spd_s:3},
  p45:{id:'p45',name:'SHOCK',r:2,ico:'üçÄ',col:'#ddffaa',spd:2.1,hp:92,cd:18,hitR:6,bStyle:'solar',sp:{name:'SHOCKWAVE',rb:'„Ç∑„Éß„ÉÉ„ÇØ„Ç¶„Çß„Ç§„Éñ',cost:90},desc:'Ë°ùÊíÉÊ≥¢Âûã„ÄÇ',atk:3,def:4,spd_s:3},
  p46:{id:'p46',name:'MIRROR',r:2,ico:'üåø',col:'#aaddff',spd:2.2,hp:106,cd:18,hitR:6,bStyle:'divine',sp:{name:'MIRROR SHOT',rb:'„Éü„É©„Éº„Éª„Ç∑„Éß„ÉÉ„Éà',cost:84},desc:'Èè°ÂèçÂ∞ÑÂûã„ÄÇ',atk:4,def:3,spd_s:3},
  p47:{id:'p47',name:'TSUNAMI',r:2,ico:'üå±',col:'#ffaadd',spd:2.2,hp:104,cd:18,hitR:6,bStyle:'apoc',sp:{name:'TSUNAMI',rb:'„ÉÑ„Éä„Éü',cost:98},desc:'Ê≥¢Êµ™Âûã„ÄÇ',atk:5,def:4,spd_s:3},
  p48:{id:'p48',name:'VOLCANO',r:2,ico:'üå≤',col:'#ddaaff',spd:2.3,hp:92,cd:18,hitR:6,bStyle:'tri3',sp:{name:'VOLCANO BURST',rb:'„É¥„Ç©„É´„Ç´„Éé„Éª„Éê„Éº„Çπ„Éà',cost:106},desc:'Ê∫∂Â≤©Âûã„ÄÇ',atk:3,def:3,spd_s:3},
  p49:{id:'p49',name:'BLIZZARD',r:2,ico:'üå≥',col:'#ff6666',spd:2.3,hp:103,cd:18,hitR:6,bStyle:'fan5',sp:{name:'BLIZZARD',rb:'„Éñ„É™„Ç∂„Éº„Éâ',cost:112},desc:'ÂêπÈõ™Âûã„ÄÇ',atk:4,def:4,spd_s:3},
  p50:{id:'p50',name:'TORNADO',r:2,ico:'üçÑ',col:'#00f5ff',spd:2.3,hp:95,cd:18,hitR:6,bStyle:'big3',sp:{name:'TORNADO',rb:'„Éà„É´„Éç„Éº„Éâ',cost:96},desc:'Á´úÂ∑ªÂûã„ÄÇ',atk:5,def:3,spd_s:3},
  p51:{id:'p51',name:'NIGHTMARE',r:2,ico:'üåµ',col:'#88bbff',spd:2.3,hp:97,cd:18,hitR:6,bStyle:'fast3',sp:{name:'NIGHTMARE',rb:'„Éä„Ç§„Éà„É°„Ç¢',cost:120},desc:'ÊÇ™Â§¢Âûã„ÄÇ',atk:3,def:4,spd_s:3},
  p52:{id:'p52',name:'REQUIEM',r:2,ico:'üå¥',col:'#88aa55',spd:2.1,hp:102,cd:18,hitR:6,bStyle:'wide5',sp:{name:'REQUIEM',rb:'„É¨„ÇØ„Ç§„Ç®„É†',cost:138},desc:'ÈéÆÈ≠ÇÂûã„ÄÇ',atk:4,def:3,spd_s:3},
  p53:{id:'p53',name:'CRIMSON NOVA',r:2,ico:'üåæ',col:'#cc88ff',spd:2.3,hp:105,cd:18,hitR:6,bStyle:'rapid2',sp:{name:'CRIMSON NOVA',rb:'„ÇØ„É™„É†„Çæ„É≥„Éª„Éé„É¥„Ç°',cost:124},desc:'Ê∑±Á¥ÖÊñ∞ÊòüÂûã„ÄÇ',atk:5,def:4,spd_s:3},
  p54:{id:'p54',name:'GLACIAL',r:2,ico:'üíé',col:'#ffee33',spd:2.2,hp:105,cd:18,hitR:6,bStyle:'v5',sp:{name:'GLACIAL LANCE',rb:'„Ç∞„É¨„Ç§„Ç∑„É£„É´„Éª„É©„É≥„Çπ',cost:88},desc:'Ê∞∑ÊßçÂûã„ÄÇ',atk:3,def:3,spd_s:3},
  p55:{id:'p55',name:'THUNDER GOD',r:2,ico:'üí†',col:'#44ff88',spd:2.3,hp:92,cd:18,hitR:6,bStyle:'bomb5',sp:{name:'THUNDER GOD',rb:'„Çµ„É≥„ÉÄ„Éº„Éª„Ç¥„ÉÉ„Éâ',cost:142},desc:'Èõ∑Á•ûÂûã„ÄÇ',atk:4,def:4,spd_s:3},
  p56:{id:'p56',name:'SAKURA',r:2,ico:'üî∑',col:'#4488ff',spd:2.2,hp:95,cd:18,hitR:6,bStyle:'ring8',sp:{name:'SAKURA STORM',rb:'„Çµ„ÇØ„É©„Éª„Çπ„Éà„Éº„É†',cost:94},desc:'Ê°úÂêπÈõ™Âûã„ÄÇ',atk:5,def:3,spd_s:3},
  p57:{id:'p57',name:'DRAGON',r:2,ico:'üî∂',col:'#ff6644',spd:2.1,hp:98,cd:18,hitR:6,bStyle:'solar',sp:{name:'DRAGON FANG',rb:'„Éâ„É©„Ç¥„É≥„Éª„Éï„Ç°„É≥„Ç∞',cost:110},desc:'Á´úÁâôÂûã„ÄÇ',atk:3,def:4,spd_s:3},
  p58:{id:'p58',name:'NEBULA',r:2,ico:'üî∏',col:'#aa44ff',spd:2.2,hp:96,cd:18,hitR:6,bStyle:'divine',sp:{name:'NEBULA BURST',rb:'„Éç„Éì„É•„É©„Éª„Éê„Éº„Çπ„Éà',cost:128},desc:'ÊòüÈõ≤Âûã„ÄÇ',atk:4,def:3,spd_s:3},
  p59:{id:'p59',name:'STARFALL',r:2,ico:'üîπ',col:'#ff8800',spd:2.2,hp:106,cd:18,hitR:6,bStyle:'apoc',sp:{name:'STARFALL',rb:'„Çπ„Çø„Éº„Éï„Ç©„Éº„É´',cost:102},desc:'ÊòüËêΩÂûã„ÄÇ',atk:5,def:4,spd_s:3},
  p60:{id:'p60',name:'ECLIPSE',r:2,ico:'üü£',col:'#ffd700',spd:2.3,hp:95,cd:18,hitR:6,bStyle:'tri3',sp:{name:'ECLIPSE BEAM',rb:'„Ç®„ÇØ„É™„Éó„Çπ„Éª„Éì„Éº„É†',cost:136},desc:'Êó•È£üÂûã„ÄÇ',atk:3,def:3,spd_s:3},
  p61:{id:'p61',name:'SHATTER',r:2,ico:'üî¥',col:'#ffffff',spd:2.3,hp:102,cd:18,hitR:6,bStyle:'fan5',sp:{name:'SHATTER RING',rb:'„Ç∑„É£„Çø„Éº„Éª„É™„É≥„Ç∞',cost:92},desc:'Á≤âÁ†ïÂûã„ÄÇ',atk:4,def:4,spd_s:3},
  p62:{id:'p62',name:'SOUL',r:2,ico:'üü†',col:'#ff2244',spd:2.3,hp:106,cd:18,hitR:6,bStyle:'big3',sp:{name:'SOUL DRAIN',rb:'„ÇΩ„Ç¶„É´„Éª„Éâ„É¨„Ç§„É≥',cost:116},desc:'È≠ÇÂê∏ÂèéÂûã„ÄÇ',atk:5,def:3,spd_s:3},
  p63:{id:'p63',name:'COSMIC',r:2,ico:'üü°',col:'#00ff88',spd:2.3,hp:106,cd:18,hitR:6,bStyle:'fast3',sp:{name:'COSMIC RAY',rb:'„Ç≥„Ç∫„Éü„ÉÉ„ÇØ„Éª„É¨„Ç§',cost:130},desc:'ÂÆáÂÆôÁ∑öÂûã„ÄÇ',atk:3,def:4,spd_s:3},
  p64:{id:'p64',name:'LAVA',r:2,ico:'üü¢',col:'#ff44aa',spd:2.3,hp:95,cd:18,hitR:6,bStyle:'wide5',sp:{name:'LAVA SURGE',rb:'„É©„É¥„Ç°„Éª„Çµ„Éº„Ç∏',cost:104},desc:'Ê∫∂Â≤©Ê≥¢Âûã„ÄÇ',atk:4,def:3,spd_s:3},
  p65:{id:'p65',name:'GALE',r:2,ico:'üîµ',col:'#44ffee',spd:2.3,hp:97,cd:18,hitR:6,bStyle:'rapid2',sp:{name:'GALE FORCE',rb:'„Ç≤„Ç§„É´„Éª„Éï„Ç©„Éº„Çπ',cost:86},desc:'ÁñæÈ¢®Âûã„ÄÇ',atk:5,def:4,spd_s:3},
  p66:{id:'p66',name:'TIDAL',r:2,ico:'‚ö™',col:'#ff8844',spd:2.1,hp:92,cd:18,hitR:6,bStyle:'v5',sp:{name:'TIDAL WAVE',rb:'„Çø„Ç§„ÉÄ„É´„Éª„Ç¶„Çß„Ç§„Éñ',cost:108},desc:'Ê≥¢ÊΩÆÂûã„ÄÇ',atk:3,def:3,spd_s:3},
  p67:{id:'p67',name:'ACID',r:2,ico:'‚ö´',col:'#88ff44',spd:2.3,hp:99,cd:18,hitR:6,bStyle:'bomb5',sp:{name:'ACID RAIN',rb:'„Ç¢„Ç∑„ÉÉ„Éâ„Éª„É¨„Ç§„É≥',cost:82},desc:'ÈÖ∏Èõ®Âûã„ÄÇ',atk:4,def:4,spd_s:3},
  p68:{id:'p68',name:'WARP',r:2,ico:'‚òÄÔ∏è',col:'#4444ff',spd:2.2,hp:99,cd:18,hitR:6,bStyle:'ring8',sp:{name:'WARP STRIKE',rb:'„ÉØ„Éº„Éó„Éª„Çπ„Éà„É©„Ç§„ÇØ',cost:118},desc:'Ê≠™Êõ≤Âûã„ÄÇ',atk:5,def:3,spd_s:3},
  p69:{id:'p69',name:'QUASAR',r:2,ico:'üåô',col:'#ffaa00',spd:2.3,hp:96,cd:18,hitR:6,bStyle:'solar',sp:{name:'QUASAR BLAST',rb:'„ÇØ„Ç®„Éº„Çµ„Éº„Éª„Éñ„É©„Çπ„Éà',cost:144},desc:'„ÇØ„Ç®„Éº„Çµ„ÉºÂûã„ÄÇ',atk:3,def:4,spd_s:3},
  p70:{id:'p70',name:'RUNE',r:3,ico:'‚≠ê',col:'#ff4444',spd:2.7,hp:134,cd:15,hitR:6,bStyle:'divine',sp:{name:'RUNE BURST',rb:'„É´„Éº„É≥„Éª„Éê„Éº„Çπ„Éà',cost:98},desc:'„É´„Éº„É≥Âûã„ÄÇ',atk:6,def:4,spd_s:4},
  p71:{id:'p71',name:'ANGEL',r:3,ico:'üåà',col:'#44aaff',spd:2.5,hp:133,cd:15,hitR:6,bStyle:'apoc',sp:{name:'ANGEL WING',rb:'„Ç®„É≥„Ç∏„Çß„É´„Éª„Ç¶„Ç£„É≥„Ç∞',cost:112},desc:'Â§©‰ΩøÂûã„ÄÇ',atk:7,def:5,spd_s:4},
  p72:{id:'p72',name:'DEMON',r:3,ico:'‚õÖ',col:'#aa88ff',spd:2.5,hp:123,cd:15,hitR:6,bStyle:'tri3',sp:{name:'DEMON CLAW',rb:'„Éá„Éº„É¢„É≥„Éª„ÇØ„É≠„Ç¶',cost:120},desc:'ÊÇ™È≠îÂûã„ÄÇ',atk:5,def:4,spd_s:4},
  p73:{id:'p73',name:'ABYSS',r:3,ico:'üå§Ô∏è',col:'#ff88aa',spd:2.7,hp:137,cd:15,hitR:6,bStyle:'fan5',sp:{name:'ABYSS CALL',rb:'„Ç¢„Éì„Çπ„Éª„Ç≥„Éº„É´',cost:126},desc:'Ê∑±Ê∑µÂûã„ÄÇ',atk:6,def:5,spd_s:4},
  p74:{id:'p74',name:'SUPERNOVA',r:3,ico:'üå¶Ô∏è',col:'#88ffaa',spd:2.6,hp:137,cd:15,hitR:6,bStyle:'big3',sp:{name:'SUPERNOVA',rb:'„Çπ„Éº„Éë„Éº„Éé„É¥„Ç°',cost:148},desc:'Ë∂ÖÊñ∞ÊòüÂûã„ÄÇ',atk:7,def:4,spd_s:4},
  p75:{id:'p75',name:'ION',r:3,ico:'üåßÔ∏è',col:'#aaff88',spd:2.7,hp:124,cd:15,hitR:6,bStyle:'fast3',sp:{name:'ION CANNON',rb:'„Ç§„Ç™„É≥„Éª„Ç≠„É£„Éé„É≥',cost:100},desc:'„Ç§„Ç™„É≥Âûã„ÄÇ',atk:5,def:5,spd_s:4},
  p76:{id:'p76',name:'MACH',r:3,ico:'‚õàÔ∏è',col:'#ffff44',spd:2.6,hp:133,cd:15,hitR:6,bStyle:'wide5',sp:{name:'MACH STRIKE',rb:'„Éû„ÉÉ„Éè„Éª„Çπ„Éà„É©„Ç§„ÇØ',cost:76},desc:'„Éû„ÉÉ„ÉèÂûã„ÄÇ',atk:6,def:4,spd_s:4},
  p77:{id:'p77',name:'ZERO G',r:3,ico:'üå©Ô∏è',col:'#44ffff',spd:2.5,hp:125,cd:15,hitR:6,bStyle:'rapid2',sp:{name:'ZERO GRAVITY',rb:'„Çº„É≠„Éª„Ç∞„É©„É¥„Ç£„ÉÜ„Ç£',cost:132},desc:'ÁÑ°ÈáçÂäõÂûã„ÄÇ',atk:7,def:5,spd_s:4},
  p78:{id:'p78',name:'PRISM',r:3,ico:'üå®Ô∏è',col:'#ff44ff',spd:2.7,hp:134,cd:15,hitR:6,bStyle:'v5',sp:{name:'PRISM SHOT',rb:'„Éó„É™„Ç∫„É†„Éª„Ç∑„Éß„ÉÉ„Éà',cost:88},desc:'„Éó„É™„Ç∫„É†Âûã„ÄÇ',atk:5,def:4,spd_s:4},
  p79:{id:'p79',name:'CRIMSON BLADE',r:3,ico:'üíß',col:'#88aaff',spd:2.5,hp:136,cd:15,hitR:6,bStyle:'bomb5',sp:{name:'CRIMSON BLADE',rb:'„ÇØ„É™„É†„Çæ„É≥„Éª„Éñ„É¨„Éº„Éâ',cost:106},desc:'Ê∑±Á¥ÖÂàÉÂûã„ÄÇ',atk:6,def:5,spd_s:4},
  p80:{id:'p80',name:'MOONFALL',r:3,ico:'üí®',col:'#ffaa88',spd:2.7,hp:129,cd:15,hitR:6,bStyle:'ring8',sp:{name:'MOONFALL',rb:'„É†„Éº„É≥„Éï„Ç©„Éº„É´',cost:114},desc:'ÊúàËêΩÂûã„ÄÇ',atk:7,def:4,spd_s:4},
  p81:{id:'p81',name:'SUNBURST',r:3,ico:'üå¨Ô∏è',col:'#88ffff',spd:2.7,hp:123,cd:15,hitR:6,bStyle:'solar',sp:{name:'SUNBURST',rb:'„Çµ„É≥„Éê„Éº„Çπ„Éà',cost:122},desc:'Â§™ÈôΩÂûã„ÄÇ',atk:5,def:5,spd_s:4},
  p82:{id:'p82',name:'VOID STORM',r:3,ico:'üî•',col:'#ff8888',spd:2.7,hp:127,cd:15,hitR:6,bStyle:'divine',sp:{name:'VOID STORM',rb:'„É¥„Ç©„Ç§„Éâ„Éª„Çπ„Éà„Éº„É†',cost:140},desc:'ËôöÁ©∫ÂµêÂûã„ÄÇ',atk:6,def:4,spd_s:4},
  p83:{id:'p83',name:'CRYSTAL CAGE',r:3,ico:'üåä',col:'#aaffaa',spd:2.7,hp:129,cd:15,hitR:6,bStyle:'apoc',sp:{name:'CRYSTAL CAGE',rb:'„ÇØ„É™„Çπ„Çø„É´„Éª„Ç±„Ç§„Ç∏',cost:96},desc:'Ê∞¥Êô∂Ê™ªÂûã„ÄÇ',atk:7,def:5,spd_s:4},
  p84:{id:'p84',name:'PLASMA STORM',r:3,ico:'üå™Ô∏è',col:'#aaaaff',spd:2.5,hp:127,cd:15,hitR:6,bStyle:'tri3',sp:{name:'PLASMA STORM',rb:'„Éó„É©„Ç∫„Éû„Éª„Çπ„Éà„Éº„É†',cost:134},desc:'„Éó„É©„Ç∫„ÉûÂµêÂûã„ÄÇ',atk:5,def:4,spd_s:4},
  p85:{id:'p85',name:'GRAVITY BOMB',r:3,ico:'‚ö°',col:'#ffaaaa',spd:2.6,hp:133,cd:15,hitR:6,bStyle:'fan5',sp:{name:'GRAVITY BOMB',rb:'„Ç∞„É©„É¥„Ç£„ÉÜ„Ç£„Éª„Éú„É†',cost:118},desc:'ÈáçÂäõÁàÜÂºæÂûã„ÄÇ',atk:6,def:5,spd_s:4},
  p86:{id:'p86',name:'THUNDER RAIN',r:3,ico:'üåà',col:'#aaffff',spd:2.6,hp:129,cd:15,hitR:6,bStyle:'big3',sp:{name:'THUNDER RAIN',rb:'„Çµ„É≥„ÉÄ„Éº„Éª„É¨„Ç§„É≥',cost:92},desc:'Èõ∑Èõ®Âûã„ÄÇ',atk:7,def:4,spd_s:4},
  p87:{id:'p87',name:'FROZEN STAR',r:3,ico:'üåü',col:'#ff88ff',spd:2.6,hp:135,cd:15,hitR:6,bStyle:'fast3',sp:{name:'FROZEN STAR',rb:'„Éï„É≠„Éº„Ç∫„É≥„Éª„Çπ„Çø„Éº',cost:108},desc:'ÂáçÁµêÊòüÂûã„ÄÇ',atk:5,def:5,spd_s:4},
  p88:{id:'p88',name:'INFERNO',r:3,ico:'üí´',col:'#88ff88',spd:2.6,hp:126,cd:15,hitR:6,bStyle:'wide5',sp:{name:'INFERNO',rb:'„Ç§„É≥„Éï„Çß„É´„Éé',cost:136},desc:'Âú∞ÁçÑÂûã„ÄÇ',atk:6,def:4,spd_s:4},
  p89:{id:'p89',name:'SHADOW STORM',r:3,ico:'‚ú®',col:'#ff88dd',spd:2.7,hp:137,cd:15,hitR:6,bStyle:'rapid2',sp:{name:'SHADOW STORM',rb:'„Ç∑„É£„Éâ„Ç¶„Éª„Çπ„Éà„Éº„É†',cost:124},desc:'ÂΩ±ÂµêÂûã„ÄÇ',atk:7,def:5,spd_s:4},
  p90:{id:'p90',name:'CELESTIAL',r:4,ico:'üå†',col:'#88ddff',spd:3.1,hp:165,cd:12,hitR:7,bStyle:'v5',sp:{name:'CELESTIAL BEAM',rb:'„Çª„É¨„Çπ„ÉÜ„Ç£„Ç¢„É´„Éª„Éì„Éº„É†',cost:146},desc:'Â§©‰ΩìÂûã„ÄÇ',atk:7,def:6,spd_s:6},
  p91:{id:'p91',name:'NANO',r:4,ico:'üéÜ',col:'#ddff88',spd:2.9,hp:158,cd:12,hitR:7,bStyle:'bomb5',sp:{name:'NANO BURST',rb:'„Éä„Éé„Éª„Éê„Éº„Çπ„Éà',cost:84},desc:'„Éä„ÉéÂûã„ÄÇ',atk:8,def:7,spd_s:6},
  p92:{id:'p92',name:'KINETIC',r:4,ico:'üéá',col:'#dd88ff',spd:3,hp:159,cd:12,hitR:7,bStyle:'ring8',sp:{name:'KINETIC BLAST',rb:'„Ç≠„Éç„ÉÜ„Ç£„ÉÉ„ÇØ„Éª„Éñ„É©„Çπ„Éà',cost:102},desc:'ÈÅãÂãïÂäõÂûã„ÄÇ',atk:9,def:6,spd_s:6},
  p93:{id:'p93',name:'SPECTRAL',r:4,ico:'‚öôÔ∏è',col:'#ffdd88',spd:2.9,hp:172,cd:12,hitR:7,bStyle:'solar',sp:{name:'SPECTRAL WAVE',rb:'„Çπ„Éö„ÇØ„Éà„É´„Éª„Ç¶„Çß„Ç§„Éñ',cost:116},desc:'„Çπ„Éö„ÇØ„Éà„É´Âûã„ÄÇ',atk:7,def:7,spd_s:6},
  p94:{id:'p94',name:'RESONANCE',r:4,ico:'üî©',col:'#88ffdd',spd:2.9,hp:168,cd:12,hitR:7,bStyle:'divine',sp:{name:'RESONANCE',rb:'„É¨„Çæ„Éä„É≥„Çπ',cost:128},desc:'ÂÖ±È≥¥Âûã„ÄÇ',atk:8,def:6,spd_s:6},
  p95:{id:'p95',name:'QUANTUM',r:4,ico:'üîß',col:'#ddffaa',spd:3,hp:165,cd:12,hitR:7,bStyle:'apoc',sp:{name:'QUANTUM BURST',rb:'„ÇØ„Ç°„É≥„Çø„É†„Éª„Éê„Éº„Çπ„Éà',cost:142},desc:'ÈáèÂ≠êÂûã„ÄÇ',atk:9,def:7,spd_s:6},
  p96:{id:'p96',name:'ULTIMA',r:4,ico:'üî®',col:'#aaddff',spd:3.1,hp:159,cd:12,hitR:7,bStyle:'tri3',sp:{name:'ULTIMA BEAM',rb:'„Ç¶„É´„ÉÜ„Ç£„Éû„Éª„Éì„Éº„É†',cost:150},desc:'Á©∂Ê•µÂÖâÁ∑öÂûã„ÄÇ',atk:7,def:6,spd_s:6},
  p97:{id:'p97',name:'GENESIS',r:4,ico:'‚öíÔ∏è',col:'#ffaadd',spd:3,hp:159,cd:12,hitR:7,bStyle:'fan5',sp:{name:'GENESIS NOVA',rb:'„Ç∏„Çß„Éç„Ç∑„Çπ„Éª„Éé„É¥„Ç°',cost:145},desc:'Ââµ‰∏ñÂûã„ÄÇ',atk:8,def:7,spd_s:6},
  p98:{id:'p98',name:'OMEGA STORM',r:5,ico:'üõ†Ô∏è',col:'#ddaaff',spd:3.5,hp:195,cd:9,hitR:7,bStyle:'big3',sp:{name:'OMEGA STORM',rb:'„Ç™„É°„Ç¨„Éª„Çπ„Éà„Éº„É†',cost:148},desc:'ÁµÇÁÑâÂµêÂûã„ÄÇ',atk:11,def:8,spd_s:8},
  p100:{id:'p100',name:'NOVA HAWK',r:1,ico:'üå∏',col:'#ff6688',spd:1.9,hp:87,cd:22,hitR:5,bStyle:'tri3',sp:{name:'HYPER CANNON',rb:'„Éè„Ç§„Éë„Éº„Ç≠„É£„Éé„É≥'}},
  p101:{id:'p101',name:'TWIN BLADE',r:1,ico:'ü¶ã',col:'#88ff66',spd:1.8,hp:86,cd:22,hitR:5,bStyle:'fan5',sp:{name:'TWIN LANCER',rb:'„ÉÑ„Ç§„É≥„É©„É≥„Çµ„Éº'}},
  p102:{id:'p102',name:'LASER BIRD',r:1,ico:'üê¶',col:'#6688ff',spd:1.9,hp:77,cd:22,hitR:5,bStyle:'big3',sp:{name:'LASER CROSS',rb:'„É¨„Éº„Ç∂„Éº„ÇØ„É≠„Çπ'}},
  p103:{id:'p103',name:'BLADE WING',r:1,ico:'ü¶Ñ',col:'#ff8866',spd:1.8,hp:78,cd:22,hitR:5,bStyle:'fast3',sp:{name:'BLADE RAIN',rb:'„Éñ„É¨„Éº„Éâ„É¨„Ç§„É≥'}},
  p104:{id:'p104',name:'DEATH ANGEL',r:1,ico:'üê≤',col:'#66ff88',spd:1.9,hp:84,cd:22,hitR:5,bStyle:'wide5',sp:{name:'DEATH SPIRAL',rb:'„Éá„Çπ„Çπ„Éë„Ç§„É©„É´'}},
  p105:{id:'p105',name:'PLASMA HAWK',r:1,ico:'üå∫',col:'#8866ff',spd:1.9,hp:70,cd:22,hitR:5,bStyle:'rapid2',sp:{name:'PLASMA NET',rb:'„Éó„É©„Ç∫„Éû„Éç„ÉÉ„Éà'}},
  p106:{id:'p106',name:'VOID DART',r:1,ico:'üçÅ',col:'#ffcc44',spd:2,hp:77,cd:22,hitR:5,bStyle:'v5',sp:{name:'VOID ARROW',rb:'„É¥„Ç©„Ç§„Éâ„Ç¢„É≠„Éº'}},
  p107:{id:'p107',name:'AQUA HAWK',r:1,ico:'üåô',col:'#44ccff',spd:1.9,hp:85,cd:22,hitR:5,bStyle:'bomb5',sp:{name:'AQUA BLAST',rb:'„Ç¢„ÇØ„Ç¢„Éñ„É©„Çπ„Éà'}},
  p108:{id:'p108',name:'TERRA WING',r:1,ico:'üí´',col:'#ff44cc',spd:1.7,hp:82,cd:22,hitR:5,bStyle:'ring8',sp:{name:'TERRA BREAK',rb:'„ÉÜ„É©„Éñ„É¨„Ç§„ÇØ'}},
  p109:{id:'p109',name:'AERO HAWK',r:1,ico:'‚ö°',col:'#cc44ff',spd:1.7,hp:75,cd:22,hitR:5,bStyle:'solar',sp:{name:'AERO SLASH',rb:'„Ç®„Ç¢„É≠„Çπ„É©„ÉÉ„Ç∑„É•'}},
  p110:{id:'p110',name:'PHOTON HAWK',r:1,ico:'üî•',col:'#44ffcc',spd:1.7,hp:72,cd:22,hitR:5,bStyle:'divine',sp:{name:'PHOTON STORM',rb:'„Éï„Ç©„Éà„É≥„Çπ„Éà„Éº„É†'}},
  p111:{id:'p111',name:'DARK ANGEL',r:1,ico:'‚ùÑÔ∏è',col:'#ffaa44',spd:2,hp:70,cd:22,hitR:5,bStyle:'apoc',sp:{name:'DARK RAIN',rb:'„ÉÄ„Éº„ÇØ„É¨„Ç§„É≥'}},
  p112:{id:'p112',name:'HOLY HAWK',r:1,ico:'üåä',col:'#44aaff',spd:1.9,hp:88,cd:22,hitR:5,bStyle:'cross4',sp:{name:'HOLY FIRE',rb:'„Éõ„Éº„É™„Éº„Éï„Ç°„Ç§„Ç¢'}},
  p113:{id:'p113',name:'CHAOS WING',r:1,ico:'üåø',col:'#ff44aa',spd:1.7,hp:77,cd:22,hitR:5,bStyle:'helix',sp:{name:'CHAOS WHIRL',rb:'„Ç´„Ç™„Çπ„ÉØ„Éº„É´'}},
  p114:{id:'p114',name:'OMEGA HAWK',r:1,ico:'üåà',col:'#aaff44',spd:1.9,hp:87,cd:22,hitR:5,bStyle:'spiral',sp:{name:'OMEGA PULSE',rb:'„Ç™„É°„Ç¨„Éë„É´„Çπ'}},
  p115:{id:'p115',name:'NEON WING',r:1,ico:'üéØ',col:'#44ffaa',spd:1.8,hp:84,cd:22,hitR:5,bStyle:'scatter',sp:{name:'NEON RAIN',rb:'„Éç„Ç™„É≥„É¨„Ç§„É≥'}},
  p116:{id:'p116',name:'CRYSTAL HAWK',r:1,ico:'üé™',col:'#ff9944',spd:1.9,hp:85,cd:22,hitR:5,bStyle:'needle',sp:{name:'CRYSTAL LANCE',rb:'„ÇØ„É™„Çπ„Çø„É´„É©„É≥„Çπ'}},
  p117:{id:'p117',name:'VOLT WING',r:1,ico:'üé≠',col:'#9944ff',spd:1.8,hp:82,cd:22,hitR:5,bStyle:'wave',sp:{name:'VOLT SURGE',rb:'„É¥„Ç©„É´„Éà„Çµ„Éº„Ç∏'}},
  p118:{id:'p118',name:'FROST HAWK',r:1,ico:'üé®',col:'#44ff99',spd:1.8,hp:81,cd:22,hitR:5,bStyle:'burst12',sp:{name:'FROST NOVA',rb:'„Éï„É≠„Çπ„Éà„Éé„É¥„Ç°'}},
  p119:{id:'p119',name:'SHADOW WING',r:1,ico:'üé¨',col:'#ff4499',spd:1.8,hp:87,cd:22,hitR:5,bStyle:'omega16',sp:{name:'SHADOW NET',rb:'„Ç∑„É£„Éâ„Ç¶„Éç„ÉÉ„Éà'}},
  p120:{id:'p120',name:'SOLAR HAWK',r:2,ico:'üîÆ',col:'#9999ff',spd:2.2,hp:101,cd:18,hitR:5,bStyle:'tri3',sp:{name:'SOLAR RAY',rb:'„ÇΩ„Éº„É©„Éº„É¨„Ç§'}},
  p121:{id:'p121',name:'LUNAR WING',r:2,ico:'üßø',col:'#ff9999',spd:2.1,hp:104,cd:18,hitR:5,bStyle:'fan5',sp:{name:'LUNAR STRIKE',rb:'„É´„Éä„Éº„Çπ„Éà„É©„Ç§„ÇØ'}},
  p122:{id:'p122',name:'STAR HAWK',r:2,ico:'üåÄ',col:'#99ff99',spd:2.1,hp:99,cd:18,hitR:5,bStyle:'big3',sp:{name:'STAR LANCE',rb:'„Çπ„Çø„Éº„É©„É≥„Çπ'}},
  p123:{id:'p123',name:'COSMIC WING',r:2,ico:'‚ôæÔ∏è',col:'#ff6699',spd:2.2,hp:91,cd:18,hitR:5,bStyle:'fast3',sp:{name:'COSMIC DRILL',rb:'„Ç≥„Ç∫„Éü„ÉÉ„ÇØ„Éâ„É™„É´'}},
  p124:{id:'p124',name:'GALAXY HAWK',r:2,ico:'üî±',col:'#6699ff',spd:2.4,hp:102,cd:18,hitR:5,bStyle:'wide5',sp:{name:'GALAXY WAVE',rb:'„ÇÆ„É£„É©„ÇØ„Ç∑„Éº„Ç¶„Çß„Éº„Éñ'}},
  p125:{id:'p125',name:'PLASMA WING',r:2,ico:'‚öúÔ∏è',col:'#99ff66',spd:2.2,hp:103,cd:18,hitR:5,bStyle:'rapid2',sp:{name:'PLASMA BURST',rb:'„Éó„É©„Ç∫„Éû„Éê„Éº„Çπ„Éà'}},
  p126:{id:'p126',name:'VOID HAWK',r:2,ico:'üèÜ',col:'#66ff99',spd:2.3,hp:92,cd:18,hitR:5,bStyle:'v5',sp:{name:'VOID RING',rb:'„É¥„Ç©„Ç§„Éâ„É™„É≥„Ç∞'}},
  p127:{id:'p127',name:'ICE WING',r:2,ico:'üéñÔ∏è',col:'#9966ff',spd:2.3,hp:105,cd:18,hitR:5,bStyle:'bomb5',sp:{name:'ICE STORM',rb:'„Ç¢„Ç§„Çπ„Çπ„Éà„Éº„É†'}},
  p128:{id:'p128',name:'FLAME HAWK',r:2,ico:'üëÅÔ∏è',col:'#ff99cc',spd:2.1,hp:107,cd:18,hitR:5,bStyle:'ring8',sp:{name:'FLAME CROSS',rb:'„Éï„É¨„Éº„É†„ÇØ„É≠„Çπ'}},
  p129:{id:'p129',name:'THUNDER WING',r:2,ico:'üåü',col:'#cc99ff',spd:2.3,hp:108,cd:18,hitR:5,bStyle:'solar',sp:{name:'THUNDER BLADE',rb:'„Çµ„É≥„ÉÄ„Éº„Éñ„É¨„Éº„Éâ'}},
  p130:{id:'p130',name:'SPIRIT HAWK',r:2,ico:'üíé',col:'#ff88cc',spd:2.4,hp:101,cd:18,hitR:5,bStyle:'divine',sp:{name:'SPIRIT WAVE',rb:'„Çπ„Éî„É™„ÉÉ„Éà„Ç¶„Çß„Éº„Éñ'}},
  p131:{id:'p131',name:'DRAGON WING',r:2,ico:'üí†',col:'#ccff88',spd:2.1,hp:95,cd:18,hitR:5,bStyle:'apoc',sp:{name:'DRAGON STORM',rb:'„Éâ„É©„Ç¥„É≥„Çπ„Éà„Éº„É†'}},
  p132:{id:'p132',name:'ANGEL HAWK',r:2,ico:'üî∑',col:'#88ccff',spd:2.2,hp:90,cd:18,hitR:5,bStyle:'cross4',sp:{name:'ANGEL BEAM',rb:'„Ç®„É≥„Ç∏„Çß„É´„Éì„Éº„É†'}},
  p133:{id:'p133',name:'DEMON WING',r:2,ico:'üî∂',col:'#ff8844',spd:2.3,hp:101,cd:18,hitR:5,bStyle:'helix',sp:{name:'DEMON RUSH',rb:'„Éá„É¢„É≥„É©„ÉÉ„Ç∑„É•'}},
  p134:{id:'p134',name:'ABYSS HAWK',r:2,ico:'üü£',col:'#44ff88',spd:2.3,hp:97,cd:18,hitR:5,bStyle:'spiral',sp:{name:'ABYSS LANCE',rb:'„Ç¢„Éì„Çπ„É©„É≥„Çπ'}},
  p135:{id:'p135',name:'NOVA WING',r:2,ico:'üü§',col:'#8844ff',spd:2.1,hp:93,cd:18,hitR:5,bStyle:'scatter',sp:{name:'NOVA CROSS',rb:'„Éé„É¥„Ç°„ÇØ„É≠„Çπ'}},
  p136:{id:'p136',name:'ION HAWK',r:2,ico:'‚¨õ',col:'#ffbb22',spd:2.3,hp:101,cd:18,hitR:5,bStyle:'needle',sp:{name:'ION BURST',rb:'„Ç§„Ç™„É≥„Éê„Éº„Çπ„Éà'}},
  p137:{id:'p137',name:'ZERO WING',r:2,ico:'‚¨ú',col:'#22bbff',spd:2.4,hp:99,cd:18,hitR:5,bStyle:'wave',sp:{name:'ZERO LANCE',rb:'„Çº„É≠„É©„É≥„Çπ'}},
  p138:{id:'p138',name:'PRISM HAWK',r:2,ico:'üî≤',col:'#ff22bb',spd:2.4,hp:95,cd:18,hitR:5,bStyle:'burst12',sp:{name:'PRISM RAIN',rb:'„Éó„É™„Ç∫„É†„É¨„Ç§„É≥'}},
  p139:{id:'p139',name:'CRIMSON WING',r:2,ico:'üî≥',col:'#bb22ff',spd:2.2,hp:102,cd:18,hitR:5,bStyle:'omega16',sp:{name:'CRIMSON STORM',rb:'„ÇØ„É™„É†„Çæ„É≥„Çπ„Éà„Éº„É†'}},
  p140:{id:'p140',name:'MOON HAWK',r:2,ico:'üé¥',col:'#22ffbb',spd:2.3,hp:109,cd:18,hitR:5,bStyle:'tri3',sp:{name:'MOON SHOT',rb:'„É†„Éº„É≥„Ç∑„Éß„ÉÉ„Éà'}},
  p141:{id:'p141',name:'SUN WING',r:2,ico:'üÄÑ',col:'#ffdd00',spd:2.3,hp:95,cd:18,hitR:5,bStyle:'fan5',sp:{name:'SUN FLARE',rb:'„Çµ„É≥„Éï„É¨„Ç¢'}},
  p142:{id:'p142',name:'VOID WING',r:2,ico:'üÉè',col:'#00ddff',spd:2.2,hp:95,cd:18,hitR:5,bStyle:'big3',sp:{name:'VOID CROSS',rb:'„É¥„Ç©„Ç§„Éâ„ÇØ„É≠„Çπ'}},
  p143:{id:'p143',name:'CRYSTAL WING',r:2,ico:'üé≤',col:'#ff00dd',spd:2.3,hp:98,cd:18,hitR:5,bStyle:'fast3',sp:{name:'CRYSTAL STORM',rb:'„ÇØ„É™„Çπ„Çø„É´„Çπ„Éà„Éº„É†'}},
  p144:{id:'p144',name:'PLASMA HAWK2',r:2,ico:'üéØ',col:'#ddff00',spd:2.2,hp:108,cd:18,hitR:5,bStyle:'wide5',sp:{name:'PLASMA LANCE',rb:'„Éó„É©„Ç∫„Éû„É©„É≥„Çπ'}},
  p145:{id:'p145',name:'GRAVITY WING',r:3,ico:'üåç',col:'#00ffdd',spd:2.6,hp:126,cd:15,hitR:6,bStyle:'rapid2',sp:{name:'GRAVITY RAIN',rb:'„Ç∞„É©„Éì„ÉÜ„Ç£„É¨„Ç§„É≥'}},
  p146:{id:'p146',name:'STORM HAWK',r:3,ico:'üåé',col:'#dd00ff',spd:2.8,hp:126,cd:15,hitR:6,bStyle:'v5',sp:{name:'THUNDER CROSS2',rb:'„Çµ„É≥„ÉÄ„Éº„ÇØ„É≠„Çπ'}},
  p147:{id:'p147',name:'FROST WING',r:3,ico:'üåè',col:'#ff6600',spd:2.6,hp:139,cd:15,hitR:6,bStyle:'bomb5',sp:{name:'FROZEN BLAST',rb:'„Éï„É≠„Éº„Ç∫„É≥„Éñ„É©„Çπ„Éà'}},
  p148:{id:'p148',name:'INFERNO HAWK',r:3,ico:'üåê',col:'#00ff66',spd:2.8,hp:139,cd:15,hitR:6,bStyle:'ring8',sp:{name:'INFERNO BURST',rb:'„Ç§„É≥„Éï„Çß„É´„Éé„Éê„Éº„Çπ„Éà'}},
  p149:{id:'p149',name:'SHADOW HAWK',r:3,ico:'üó∫Ô∏è',col:'#6600ff',spd:2.5,hp:132,cd:15,hitR:6,bStyle:'solar',sp:{name:'SHADOW LANCE',rb:'„Ç∑„É£„Éâ„Ç¶„É©„É≥„Çπ'}},
  p150:{id:'p150',name:'CELESTIAL WING',r:3,ico:'üèîÔ∏è',col:'#ff0066',spd:2.7,hp:126,cd:15,hitR:6,bStyle:'divine',sp:{name:'CELESTIAL STORM',rb:'„Çª„É¨„Çπ„ÉÅ„É£„É´„Çπ„Éà„Éº„É†'}},
  p151:{id:'p151',name:'NANO HAWK',r:3,ico:'‚õ∞Ô∏è',col:'#66ff00',spd:2.6,hp:127,cd:15,hitR:6,bStyle:'apoc',sp:{name:'NANO RAIN',rb:'„Éä„Éé„É¨„Ç§„É≥'}},
  p152:{id:'p152',name:'KINETIC WING',r:3,ico:'üåã',col:'#0066ff',spd:2.7,hp:134,cd:15,hitR:6,bStyle:'cross4',sp:{name:'KINETIC CROSS',rb:'„Ç≠„Éç„ÉÜ„Ç£„ÉÉ„ÇØ„ÇØ„É≠„Çπ'}},
  p153:{id:'p153',name:'SPECTRAL HAWK',r:3,ico:'üóª',col:'#ff3355',spd:2.7,hp:122,cd:15,hitR:6,bStyle:'helix',sp:{name:'SPECTRAL BURST',rb:'„Çπ„Éö„ÇØ„Éà„É©„É´„Éê„Éº„Çπ„Éà'}},
  p154:{id:'p154',name:'RESONANCE WING',r:3,ico:'üèïÔ∏è',col:'#33ff55',spd:2.6,hp:124,cd:15,hitR:6,bStyle:'spiral',sp:{name:'RESONANCE2',rb:'„É¨„Çæ„Éä„É≥„Çπ'}},
  p155:{id:'p155',name:'QUANTUM HAWK',r:3,ico:'üåÑ',col:'#3355ff',spd:2.5,hp:130,cd:15,hitR:6,bStyle:'scatter',sp:{name:'QUANTUM STORM',rb:'„ÇØ„Ç¢„É≥„Çø„É†„Çπ„Éà„Éº„É†'}},
  p156:{id:'p156',name:'ULTIMA WING',r:3,ico:'üåÖ',col:'#ff5533',spd:2.7,hp:133,cd:15,hitR:6,bStyle:'needle',sp:{name:'ULTIMA LANCE',rb:'„Ç¢„É´„ÉÜ„Ç£„Éû„É©„É≥„Çπ'}},
  p157:{id:'p157',name:'GENESIS HAWK',r:3,ico:'üåÜ',col:'#55ff33',spd:2.6,hp:129,cd:15,hitR:6,bStyle:'wave',sp:{name:'GENESIS BURST',rb:'„Ç∏„Çß„Éç„Ç∑„Çπ„Éê„Éº„Çπ„Éà'}},
  p158:{id:'p158',name:'OMEGA WING',r:3,ico:'üåá',col:'#5533ff',spd:2.6,hp:131,cd:15,hitR:6,bStyle:'burst12',sp:{name:'OMEGA RAIN',rb:'„Ç™„É°„Ç¨„É¨„Ç§„É≥'}},
  p159:{id:'p159',name:'TRUE HAWK',r:3,ico:'üåÉ',col:'#ff5588',spd:2.6,hp:134,cd:15,hitR:6,bStyle:'omega16',sp:{name:'TRUE CROSS',rb:'„Éà„Ç•„É´„Éº„ÇØ„É≠„Çπ'}},
  p160:{id:'p160',name:'HYPER WING',r:3,ico:'üí´',col:'#55ff88',spd:2.8,hp:134,cd:15,hitR:6,bStyle:'tri3',sp:{name:'HYPER STORM',rb:'„Éè„Ç§„Éë„Éº„Çπ„Éà„Éº„É†'}},
  p161:{id:'p161',name:'TWIN HAWK',r:3,ico:'‚≠ê',col:'#5588ff',spd:2.6,hp:129,cd:15,hitR:6,bStyle:'fan5',sp:{name:'TWIN BURST',rb:'„ÉÑ„Ç§„É≥„Éê„Éº„Çπ„Éà'}},
  p162:{id:'p162',name:'LASER WING',r:3,ico:'üåü',col:'#ff8855',spd:2.6,hp:123,cd:15,hitR:6,bStyle:'big3',sp:{name:'LASER STORM',rb:'„É¨„Éº„Ç∂„Éº„Çπ„Éà„Éº„É†'}},
  p163:{id:'p163',name:'BLADE HAWK',r:3,ico:'‚ú®',col:'#88ff55',spd:2.7,hp:130,cd:15,hitR:6,bStyle:'fast3',sp:{name:'BLADE CROSS',rb:'„Éñ„É¨„Éº„Éâ„ÇØ„É≠„Çπ'}},
  p164:{id:'p164',name:'DEATH WING',r:3,ico:'üå†',col:'#8855ff',spd:2.7,hp:125,cd:15,hitR:6,bStyle:'wide5',sp:{name:'DEATH RAIN',rb:'„Éá„Çπ„É¨„Ç§„É≥'}},
  p165:{id:'p165',name:'PLASMA BIRD',r:3,ico:'üåå',col:'#ffcc88',spd:2.7,hp:121,cd:15,hitR:6,bStyle:'rapid2',sp:{name:'PLASMA SURGE',rb:'„Éó„É©„Ç∫„Éû„Çµ„Éº„Ç∏'}},
  p166:{id:'p166',name:'VOID BLADE',r:3,ico:'üåô',col:'#88ffcc',spd:2.8,hp:126,cd:15,hitR:6,bStyle:'v5',sp:{name:'VOID STORM2',rb:'„É¥„Ç©„Ç§„Éâ„Çπ„Éà„Éº„É†'}},
  p167:{id:'p167',name:'AQUA WING',r:3,ico:'üåõ',col:'#cc88ff',spd:2.6,hp:133,cd:15,hitR:6,bStyle:'bomb5',sp:{name:'AQUA CROSS',rb:'„Ç¢„ÇØ„Ç¢„ÇØ„É≠„Çπ'}},
  p168:{id:'p168',name:'TERRA HAWK',r:3,ico:'üåú',col:'#ffaa88',spd:2.7,hp:129,cd:15,hitR:6,bStyle:'ring8',sp:{name:'TERRA STORM',rb:'„ÉÜ„É©„Çπ„Éà„Éº„É†'}},
  p169:{id:'p169',name:'AERO BLADE',r:3,ico:'üåù',col:'#88ffaa',spd:2.8,hp:120,cd:15,hitR:6,bStyle:'solar',sp:{name:'AERO BURST',rb:'„Ç®„Ç¢„É≠„Éê„Éº„Çπ„Éà'}},
  p170:{id:'p170',name:'PHOTON BLADE',r:4,ico:'‚òÄÔ∏è',col:'#aa88ff',spd:2.9,hp:169,cd:12,hitR:6,bStyle:'divine',sp:{name:'PHOTON RAIN',rb:'„Éï„Ç©„Éà„É≥„É¨„Ç§„É≥'}},
  p171:{id:'p171',name:'DARK WING',r:4,ico:'üå§Ô∏è',col:'#ffdd88',spd:2.9,hp:164,cd:12,hitR:6,bStyle:'apoc',sp:{name:'DARK CROSS',rb:'„ÉÄ„Éº„ÇØ„ÇØ„É≠„Çπ'}},
  p172:{id:'p172',name:'HOLY BLADE',r:4,ico:'‚õÖ',col:'#88ffdd',spd:3,hp:172,cd:12,hitR:6,bStyle:'cross4',sp:{name:'HOLY STORM',rb:'„Éõ„Éº„É™„Éº„Çπ„Éà„Éº„É†'}},
  p173:{id:'p173',name:'CHAOS HAWK',r:4,ico:'üå•Ô∏è',col:'#dd88ff',spd:3.1,hp:166,cd:12,hitR:6,bStyle:'helix',sp:{name:'CHAOS LANCE',rb:'„Ç´„Ç™„Çπ„É©„É≥„Çπ'}},
  p174:{id:'p174',name:'OMEGA BLADE',r:4,ico:'‚òÅÔ∏è',col:'#ffbbaa',spd:3,hp:171,cd:12,hitR:6,bStyle:'spiral',sp:{name:'OMEGA CROSS',rb:'„Ç™„É°„Ç¨„ÇØ„É≠„Çπ'}},
  p175:{id:'p175',name:'NEON BLADE',r:4,ico:'üå¶Ô∏è',col:'#aaffbb',spd:3,hp:163,cd:12,hitR:6,bStyle:'scatter',sp:{name:'NEON BURST2',rb:'„Éç„Ç™„É≥„Éê„Éº„Çπ„Éà'}},
  p176:{id:'p176',name:'CRYSTAL BLADE',r:4,ico:'üåßÔ∏è',col:'#bbaaffCC',spd:3,hp:166,cd:12,hitR:6,bStyle:'needle',sp:{name:'CRYSTAL CROSS',rb:'„ÇØ„É™„Çπ„Çø„É´„ÇØ„É≠„Çπ'}},
  p177:{id:'p177',name:'VOLT HAWK',r:4,ico:'‚õàÔ∏è',col:'#ff77aa',spd:3.1,hp:157,cd:12,hitR:6,bStyle:'wave',sp:{name:'VOLT RAIN',rb:'„É¥„Ç©„É´„Éà„É¨„Ç§„É≥'}},
  p178:{id:'p178',name:'FROST BLADE',r:4,ico:'üå©Ô∏è',col:'#aa77ff',spd:2.9,hp:171,cd:12,hitR:6,bStyle:'burst12',sp:{name:'FROST STORM',rb:'„Éï„É≠„Çπ„Éà„Çπ„Éà„Éº„É†'}},
  p179:{id:'p179',name:'SHADOW BLADE2',r:4,ico:'üå®Ô∏è',col:'#77aaff',spd:3.2,hp:163,cd:12,hitR:6,bStyle:'omega16',sp:{name:'SHADOW BURST',rb:'„Ç∑„É£„Éâ„Ç¶„Éê„Éº„Çπ„Éà'}},
  p180:{id:'p180',name:'SOLAR BLADE',r:4,ico:'‚ùÑÔ∏è',col:'#ff7744',spd:2.9,hp:165,cd:12,hitR:6,bStyle:'tri3',sp:{name:'SOLAR CROSS',rb:'„ÇΩ„Éº„É©„Éº„ÇØ„É≠„Çπ'}},
  p181:{id:'p181',name:'LUNAR HAWK',r:4,ico:'üå¨Ô∏è',col:'#7744ff',spd:3.2,hp:158,cd:12,hitR:6,bStyle:'fan5',sp:{name:'LUNAR BURST',rb:'„É´„Éä„Éº„Éê„Éº„Çπ„Éà'}},
  p182:{id:'p182',name:'STAR BLADE',r:4,ico:'üå™Ô∏è',col:'#44ff77',spd:3,hp:168,cd:12,hitR:6,bStyle:'big3',sp:{name:'STAR STORM',rb:'„Çπ„Çø„Éº„Çπ„Éà„Éº„É†'}},
  p183:{id:'p183',name:'COSMIC HAWK',r:4,ico:'üå´Ô∏è',col:'#ff4477',spd:3.1,hp:162,cd:12,hitR:6,bStyle:'fast3',sp:{name:'COSMIC CROSS',rb:'„Ç≥„Ç∫„Éü„ÉÉ„ÇØ„ÇØ„É≠„Çπ'}},
  p184:{id:'p184',name:'GALAXY BLADE',r:4,ico:'üåà',col:'#4477ff',spd:3.2,hp:155,cd:12,hitR:6,bStyle:'wide5',sp:{name:'GALAXY BURST',rb:'„ÇÆ„É£„É©„ÇØ„Ç∑„Éº„Éê„Éº„Çπ„Éà'}},
  p185:{id:'p185',name:'PLASMA BLADE',r:4,ico:'‚òÇÔ∏è',col:'#ff44ee',spd:3.1,hp:172,cd:12,hitR:6,bStyle:'rapid2',sp:{name:'PLASMA CROSS',rb:'„Éó„É©„Ç∫„Éû„ÇØ„É≠„Çπ'}},
  p186:{id:'p186',name:'VOID BLADE2',r:4,ico:'‚ö°',col:'#eeee44',spd:2.9,hp:172,cd:12,hitR:6,bStyle:'v5',sp:{name:'VOID BURST',rb:'„É¥„Ç©„Ç§„Éâ„Éê„Éº„Çπ„Éà'}},
  p187:{id:'p187',name:'ICE BLADE',r:4,ico:'üíß',col:'#44eeee',spd:3.1,hp:167,cd:12,hitR:6,bStyle:'bomb5',sp:{name:'ICE CROSS',rb:'„Ç¢„Ç§„Çπ„ÇØ„É≠„Çπ'}},
  p188:{id:'p188',name:'FLAME BLADE',r:4,ico:'üí¶',col:'#ffaaee',spd:3,hp:173,cd:12,hitR:6,bStyle:'ring8',sp:{name:'FLAME STORM',rb:'„Éï„É¨„Éº„É†„Çπ„Éà„Éº„É†'}},
  p189:{id:'p189',name:'THUNDER BLADE2',r:4,ico:'üî•',col:'#eeffaa',spd:2.9,hp:163,cd:12,hitR:6,bStyle:'solar',sp:{name:'THUNDER RAIN2',rb:'„Çµ„É≥„ÉÄ„Éº„É¨„Ç§„É≥'}},
  p190:{id:'p190',name:'SPIRIT BLADE',r:5,ico:'ü¶ä',col:'#aaeeff',spd:3.4,hp:192,cd:9,hitR:7,bStyle:'divine',sp:{name:'SPIRIT BURST',rb:'„Çπ„Éî„É™„ÉÉ„Éà„Éê„Éº„Çπ„Éà'}},
  p191:{id:'p191',name:'DRAGON BLADE',r:5,ico:'üê∫',col:'#ff99ee',spd:3.4,hp:201,cd:9,hitR:7,bStyle:'apoc',sp:{name:'DRAGON CROSS',rb:'„Éâ„É©„Ç¥„É≥„ÇØ„É≠„Çπ'}},
  p192:{id:'p192',name:'ANGEL BLADE',r:5,ico:'ü¶Ö',col:'#99ff99',spd:3.4,hp:198,cd:9,hitR:7,bStyle:'cross4',sp:{name:'ANGEL STORM',rb:'„Ç®„É≥„Ç∏„Çß„É´„Çπ„Éà„Éº„É†'}},
  p193:{id:'p193',name:'DEMON HAWK',r:5,ico:'ü¶Å',col:'#9999ee',spd:3.4,hp:188,cd:9,hitR:7,bStyle:'helix',sp:{name:'DEMON BURST',rb:'„Éá„É¢„É≥„Éê„Éº„Çπ„Éà'}},
  p194:{id:'p194',name:'ABYSS BLADE',r:5,ico:'üêØ',col:'#ff66bb',spd:3.5,hp:199,cd:9,hitR:7,bStyle:'spiral',sp:{name:'ABYSS STORM',rb:'„Ç¢„Éì„Çπ„Çπ„Éà„Éº„É†'}},
  p195:{id:'p195',name:'NOVA BLADE',r:5,ico:'üêª',col:'#bb66ff',spd:3.6,hp:190,cd:9,hitR:7,bStyle:'scatter',sp:{name:'NOVA STORM',rb:'„Éé„É¥„Ç°„Çπ„Éà„Éº„É†'}},
  p196:{id:'p196',name:'ION WING',r:5,ico:'ü¶ù',col:'#66bbff',spd:3.3,hp:197,cd:9,hitR:7,bStyle:'needle',sp:{name:'ION CROSS',rb:'„Ç§„Ç™„É≥„ÇØ„É≠„Çπ'}},
  p197:{id:'p197',name:'ZERO BLADE',r:5,ico:'ü¶à',col:'#ff66ee',spd:3.4,hp:188,cd:9,hitR:7,bStyle:'wave',sp:{name:'ZERO BURST',rb:'„Çº„É≠„Éê„Éº„Çπ„Éà'}},
  p198:{id:'p198',name:'PRISM WING',r:5,ico:'üêâ',col:'#eeff66',spd:3.5,hp:195,cd:9,hitR:7,bStyle:'burst12',sp:{name:'PRISM STORM',rb:'„Éó„É™„Ç∫„É†„Çπ„Éà„Éº„É†'}},
  p199:{id:'p199',name:'APOCALYPSE WING',r:5,ico:'ü¶ï',col:'#66eeff',spd:3.4,hp:190,cd:9,hitR:7,bStyle:'omega16',sp:{name:'CRIMSON BURST',rb:'„ÇØ„É™„É†„Çæ„É≥„Éê„Éº„Çπ„Éà'}},
  p99:{id:'p99',name:'TRUE VOID',r:5,ico:'‚õèÔ∏è',col:'#ff6666',spd:3.6,hp:201,cd:9,hitR:7,bStyle:'fast3',sp:{name:'TRUE APOCALYPSE',rb:'„Éà„Ç•„É´„Éº„Éª„Ç¢„Éù„Ç´„É™„Éó„Çπ',cost:150},desc:'ÁúüÁµÇÁÑâÂûã„ÄÇ',atk:9,def:9,spd_s:8},
};

// ‚îÄ‚îÄ‚îÄ ITEMS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const ITEMS={
  i_sps:{id:'i_sps',name:'SP CORE S',r:1,ico:'üí†',desc:'ÂøÖÊÆ∫„Ç≥„Çπ„Éà-5',type:'sp',val:5},
  i_atk:{id:'i_atk',name:'ATK CHIP',r:1,ico:'üî©',desc:'ÊîªÊíÉ+1',type:'atk',val:1},
  i_spm:{id:'i_spm',name:'SP CORE M',r:2,ico:'üî∑',desc:'ÂøÖÊÆ∫„Ç≥„Çπ„Éà-12',type:'sp',val:12},
  i_hp:{id:'i_hp',name:'HP MODULE',r:2,ico:'üíä',desc:'HP+25',type:'hp',val:25},
  i_spl:{id:'i_spl',name:'SP CORE L',r:3,ico:'üíé',desc:'ÂøÖÊÆ∫„Ç≥„Çπ„Éà-22',type:'sp',val:22},
  i_spd:{id:'i_spd',name:'TURBO WING',r:3,ico:'üå™Ô∏è',desc:'ÈÄüÂ∫¶+0.6',type:'spd',val:0.6},
  i_spxl:{id:'i_spxl',name:'SP ULTRA',r:4,ico:'üåü',desc:'ÂøÖÊÆ∫„Ç≥„Çπ„Éà-35',type:'sp',val:35},
  i_cd:{id:'i_cd',name:'RAPID FIRE',r:4,ico:'üöÄ',desc:'Â∞ÑÈÄü+3',type:'cd',val:3},
};

// ‚îÄ‚îÄ‚îÄ GACHA TABLE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const GTABLE=[
  {w:8,tp:'p',id:'p0'},{w:8,tp:'p',id:'p1'},{w:8,tp:'p',id:'p2'},{w:8,tp:'p',id:'p3'},{w:8,tp:'p',id:'p4'},{w:8,tp:'p',id:'p5'},{w:8,tp:'p',id:'p6'},{w:8,tp:'p',id:'p7'},{w:8,tp:'p',id:'p8'},{w:8,tp:'p',id:'p9'},{w:8,tp:'p',id:'p10'},{w:8,tp:'p',id:'p11'},{w:8,tp:'p',id:'p12'},{w:8,tp:'p',id:'p13'},{w:8,tp:'p',id:'p14'},{w:8,tp:'p',id:'p15'},{w:8,tp:'p',id:'p16'},{w:8,tp:'p',id:'p17'},{w:8,tp:'p',id:'p18'},{w:8,tp:'p',id:'p19'},{w:8,tp:'p',id:'p20'},{w:8,tp:'p',id:'p21'},{w:8,tp:'p',id:'p22'},{w:8,tp:'p',id:'p23'},{w:8,tp:'p',id:'p24'},{w:8,tp:'p',id:'p25'},{w:8,tp:'p',id:'p26'},{w:8,tp:'p',id:'p27'},{w:8,tp:'p',id:'p28'},{w:8,tp:'p',id:'p29'},{w:8,tp:'p',id:'p30'},{w:8,tp:'p',id:'p31'},{w:8,tp:'p',id:'p32'},{w:8,tp:'p',id:'p33'},{w:8,tp:'p',id:'p34'},{w:8,tp:'p',id:'p35'},{w:8,tp:'p',id:'p36'},{w:8,tp:'p',id:'p37'},{w:8,tp:'p',id:'p38'},{w:8,tp:'p',id:'p39'},{w:5,tp:'p',id:'p40'},{w:5,tp:'p',id:'p41'},{w:5,tp:'p',id:'p42'},{w:5,tp:'p',id:'p43'},{w:5,tp:'p',id:'p44'},{w:5,tp:'p',id:'p45'},{w:5,tp:'p',id:'p46'},{w:5,tp:'p',id:'p47'},{w:5,tp:'p',id:'p48'},{w:5,tp:'p',id:'p49'},{w:5,tp:'p',id:'p50'},{w:5,tp:'p',id:'p51'},{w:5,tp:'p',id:'p52'},{w:5,tp:'p',id:'p53'},{w:5,tp:'p',id:'p54'},{w:5,tp:'p',id:'p55'},{w:5,tp:'p',id:'p56'},{w:5,tp:'p',id:'p57'},{w:5,tp:'p',id:'p58'},{w:5,tp:'p',id:'p59'},{w:5,tp:'p',id:'p60'},{w:5,tp:'p',id:'p61'},{w:5,tp:'p',id:'p62'},{w:5,tp:'p',id:'p63'},{w:5,tp:'p',id:'p64'},{w:5,tp:'p',id:'p65'},{w:5,tp:'p',id:'p66'},{w:5,tp:'p',id:'p67'},{w:5,tp:'p',id:'p68'},{w:5,tp:'p',id:'p69'},{w:3,tp:'p',id:'p70'},{w:3,tp:'p',id:'p71'},{w:3,tp:'p',id:'p72'},{w:3,tp:'p',id:'p73'},{w:3,tp:'p',id:'p74'},{w:3,tp:'p',id:'p75'},{w:3,tp:'p',id:'p76'},{w:3,tp:'p',id:'p77'},{w:3,tp:'p',id:'p78'},{w:3,tp:'p',id:'p79'},{w:3,tp:'p',id:'p80'},{w:3,tp:'p',id:'p81'},{w:3,tp:'p',id:'p82'},{w:3,tp:'p',id:'p83'},{w:3,tp:'p',id:'p84'},{w:3,tp:'p',id:'p85'},{w:3,tp:'p',id:'p86'},{w:3,tp:'p',id:'p87'},{w:3,tp:'p',id:'p88'},{w:3,tp:'p',id:'p89'},{w:2,tp:'p',id:'p90'},{w:2,tp:'p',id:'p91'},{w:2,tp:'p',id:'p92'},{w:2,tp:'p',id:'p93'},{w:2,tp:'p',id:'p94'},{w:2,tp:'p',id:'p95'},{w:2,tp:'p',id:'p96'},{w:2,tp:'p',id:'p97'},{w:1,tp:'p',id:'p98'},{w:1,tp:'p',id:'p99'},
  {w:3,tp:'p',id:'p100'},  {w:3,tp:'p',id:'p101'},  {w:3,tp:'p',id:'p102'},  {w:3,tp:'p',id:'p103'},  {w:3,tp:'p',id:'p104'},  {w:3,tp:'p',id:'p105'},  {w:3,tp:'p',id:'p106'},  {w:3,tp:'p',id:'p107'},  {w:3,tp:'p',id:'p108'},  {w:3,tp:'p',id:'p109'},  {w:3,tp:'p',id:'p110'},  {w:3,tp:'p',id:'p111'},  {w:3,tp:'p',id:'p112'},  {w:3,tp:'p',id:'p113'},  {w:3,tp:'p',id:'p114'},  {w:3,tp:'p',id:'p115'},  {w:3,tp:'p',id:'p116'},  {w:3,tp:'p',id:'p117'},  {w:3,tp:'p',id:'p118'},  {w:3,tp:'p',id:'p119'},  {w:5,tp:'p',id:'p120'},  {w:5,tp:'p',id:'p121'},  {w:5,tp:'p',id:'p122'},  {w:5,tp:'p',id:'p123'},  {w:5,tp:'p',id:'p124'},  {w:5,tp:'p',id:'p125'},  {w:5,tp:'p',id:'p126'},  {w:5,tp:'p',id:'p127'},  {w:5,tp:'p',id:'p128'},  {w:5,tp:'p',id:'p129'},  {w:5,tp:'p',id:'p130'},  {w:5,tp:'p',id:'p131'},  {w:5,tp:'p',id:'p132'},  {w:5,tp:'p',id:'p133'},  {w:5,tp:'p',id:'p134'},  {w:5,tp:'p',id:'p135'},  {w:5,tp:'p',id:'p136'},  {w:5,tp:'p',id:'p137'},  {w:5,tp:'p',id:'p138'},  {w:5,tp:'p',id:'p139'},  {w:5,tp:'p',id:'p140'},  {w:5,tp:'p',id:'p141'},  {w:5,tp:'p',id:'p142'},  {w:5,tp:'p',id:'p143'},  {w:5,tp:'p',id:'p144'},  {w:8,tp:'p',id:'p145'},  {w:8,tp:'p',id:'p146'},  {w:8,tp:'p',id:'p147'},  {w:8,tp:'p',id:'p148'},  {w:8,tp:'p',id:'p149'},  {w:8,tp:'p',id:'p150'},  {w:8,tp:'p',id:'p151'},  {w:8,tp:'p',id:'p152'},  {w:8,tp:'p',id:'p153'},  {w:8,tp:'p',id:'p154'},  {w:8,tp:'p',id:'p155'},  {w:8,tp:'p',id:'p156'},  {w:8,tp:'p',id:'p157'},  {w:8,tp:'p',id:'p158'},  {w:8,tp:'p',id:'p159'},  {w:8,tp:'p',id:'p160'},  {w:8,tp:'p',id:'p161'},  {w:8,tp:'p',id:'p162'},  {w:8,tp:'p',id:'p163'},  {w:8,tp:'p',id:'p164'},  {w:8,tp:'p',id:'p165'},  {w:8,tp:'p',id:'p166'},  {w:8,tp:'p',id:'p167'},  {w:8,tp:'p',id:'p168'},  {w:8,tp:'p',id:'p169'},  {w:12,tp:'p',id:'p170'},  {w:12,tp:'p',id:'p171'},  {w:12,tp:'p',id:'p172'},  {w:12,tp:'p',id:'p173'},  {w:12,tp:'p',id:'p174'},  {w:12,tp:'p',id:'p175'},  {w:12,tp:'p',id:'p176'},  {w:12,tp:'p',id:'p177'},  {w:12,tp:'p',id:'p178'},  {w:12,tp:'p',id:'p179'},  {w:12,tp:'p',id:'p180'},  {w:12,tp:'p',id:'p181'},  {w:12,tp:'p',id:'p182'},  {w:12,tp:'p',id:'p183'},  {w:12,tp:'p',id:'p184'},  {w:12,tp:'p',id:'p185'},  {w:12,tp:'p',id:'p186'},  {w:12,tp:'p',id:'p187'},  {w:12,tp:'p',id:'p188'},  {w:12,tp:'p',id:'p189'},  {w:20,tp:'p',id:'p190'},  {w:20,tp:'p',id:'p191'},  {w:20,tp:'p',id:'p192'},  {w:20,tp:'p',id:'p193'},  {w:20,tp:'p',id:'p194'},  {w:20,tp:'p',id:'p195'},  {w:20,tp:'p',id:'p196'},  {w:20,tp:'p',id:'p197'},  {w:20,tp:'p',id:'p198'},  {w:20,tp:'p',id:'p199'},
  {w:11,tp:'i',id:'i_sps'},{w:13,tp:'i',id:'i_atk'},{w:5,tp:'i',id:'i_spm'},{w:3,tp:'i',id:'i_hp'},{w:3,tp:'i',id:'i_spl'},{w:3,tp:'i',id:'i_spd'},{w:1,tp:'i',id:'i_spxl'},{w:1,tp:'i',id:'i_cd'}
];

// ‚îÄ‚îÄ‚îÄ STAGES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const STAGES=[
  {id:'s1',name:'STAGE 1',world:'SECTOR ALPHA',
    boss:{name:'WRAITH MK.I',ico:'üëæ',hp:34,col:'#00ff88'},
    eC:['#00ff88','#00eeaa'],bg:['#000614','#01091a'],coins:1},
  {id:'s2',name:'STAGE 2',world:'SECTOR ALPHA',
    boss:{name:'MAGMA CORE',ico:'üî•',hp:47,col:'#ff6600'},
    eC:['#ff6600','#ff3300'],bg:['#0e0400','#180700'],coins:1},
  {id:'s3',name:'STAGE 3',world:'SECTOR ALPHA',
    boss:{name:'ICE FORTRESS',ico:'üßä',hp:63,col:'#88ddff'},
    eC:['#44aaff','#88ddff'],bg:['#000514','#000e24'],coins:2},
  {id:'s4',name:'STAGE 4',world:'SECTOR BETA',
    boss:{name:'SHADOW CLAW',ico:'üåë',hp:83,col:'#aa44ff'},
    eC:['#aa44ff','#8822cc'],bg:['#040012','#08001c'],coins:2},
  {id:'s5',name:'STAGE 5',world:'SECTOR BETA',
    boss:{name:'VOID EMPEROR',ico:'üíÄ',hp:113,col:'#ff3344'},
    eC:['#ff3344','#ff1166'],bg:['#0e0002','#180004'],coins:3},
  {id:'s6',name:'STAGE 6',world:'SECTOR GAMMA',
    boss:{name:'COSMIC TITAN',ico:'üåå',hp:147,col:'#ffffff'},
    eC:['#aaaaff','#ffffff'],bg:['#000514','#040520'],coins:3},
  {id:'s7',name:'STAGE 7',world:'SECTOR GAMMA',
    boss:{name:'GALAXY CRUSHER',ico:'üåÄ',hp:187,col:'#ffd700'},
    eC:['#ffcc00','#ff8800'],bg:['#001206','#001e08'],coins:4},
  {id:'s8',name:'STAGE 8',world:'SECTOR OMEGA',
    boss:{name:'OMEGA DESTROYER',ico:'‚ò†Ô∏è',hp:253,col:'#ff00ff'},
    eC:['#ff00ff','#aa00ff'],bg:['#0e000e','#160016'],coins:5},
];

// ‚îÄ‚îÄ‚îÄ RARITY ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const RC=['','#6a7484','#3ebf6a','#3a8fff','#b43fff','#ff8f00'];
const RL=['','‚òÖ COMMON','‚òÖ‚òÖ UNCOMMON','‚òÖ‚òÖ‚òÖ RARE','‚òÖ‚òÖ‚òÖ‚òÖ EPIC','‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ LEGENDARY'];
const RCLS=['','r1','r2','r3','r4','r5'];

// ‚îÄ‚îÄ‚îÄ UTILS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const rnd=(a,b)=>a+Math.random()*(b-a);
const clamp=(v,a,b)=>v<a?a:v>b?b:v;
const dist2=(ax,ay,bx,by)=>{let dx=ax-bx,dy=ay-by;return dx*dx+dy*dy;};
const hit=(ax,ay,ar,bx,by,br)=>dist2(ax,ay,bx,by)<(ar+br)*(ar+br);
const RBC=['#ff2244','#ff6600','#ffaa00','#ffee00','#88ff00','#00ff88',
  '#00f5ff','#0088ff','#aa44ff','#ff44aa','#ffccff','#ffffff','#ff8844','#44ffee','#ffcc44'];
const rbC=n=>RBC[Math.abs(0|n)%RBC.length];
function hA(hex,a){
  let h=hex.replace('#','');
  if(h.length===3)h=h[0]+h[0]+h[1]+h[1]+h[2]+h[2];
  return `rgba(${parseInt(h.slice(0,2),16)},${parseInt(h.slice(2,4),16)},${parseInt(h.slice(4,6),16)},${a})`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  UI CONTROLLER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const UI={
  cur:null, bgRafs:{},
  show(id){
    document.querySelectorAll('.scr').forEach(s=>s.classList.remove('on'));
    document.getElementById(id).classList.add('on');
    UI.cur=id;
    // Sync URL hash for Android back button (with fallback for sandboxed environments)
    try{
      const hash='#'+id;
      if(location.hash!==hash) history.pushState({screen:id},id,hash);
    }catch(e){}
    // Show/hide bottom nav (hide during active gameplay)
    const nav=document.getElementById('bottomNav');
    const showNav=['sMenu','sGacha'].includes(id);
    if(nav){nav.style.display=showNav?'flex':'none';}
    // Add padding class to nav-visible screens
    document.querySelectorAll('.scr').forEach(s=>s.classList.remove('has-bnav'));
    if(showNav){const el=document.getElementById(id);if(el)el.classList.add('has-bnav');}
  },
  _bnSelect(id){
    document.querySelectorAll('.bnav-btn').forEach(b=>b.classList.remove('active'));
    const el=document.getElementById(id);if(el)el.classList.add('active');
  },
  updRainbow(){
    const r=document.getElementById('rainbowM');if(r)r.textContent=SAV.rainbow||0;
    const rg=document.getElementById('rainbowG');if(rg)rg.textContent=SAV.rainbow||0;
  },
  updCoins(){
    document.getElementById('coinM').textContent=SAV.coins;
    document.getElementById('coinG').textContent=SAV.coins;
    let b=document.getElementById('gBtn');if(b)b.disabled=SAV.coins<1;
    const rb=document.getElementById('rBtn');if(rb)rb.disabled=(SAV.rainbow||0)<1;
  },
  goMenu(){UI.show('sMenu');UI.updCoins();UI.menuBg();},
  goStage(){UI.show('sStage');UI.buildStageList();UI.stageBg();},
  goGacha(){UI.show('sGacha');UI.updCoins();GACHA.animMachine(0);},
  goEditor(){UI.show('sEditor');ED.init();try{const a=localStorage.getItem('sky_author');const el=document.getElementById('edAuthor');if(a&&el&&!el.value)el.value=a;}catch(e){}},
  goCommunity(){UI.show('sCommunity');CM.load();},

  menuBg(){
    let cvs=document.getElementById('menuCvs'),c=cvs.getContext('2d');
    let stars=Array.from({length:280},()=>({x:rnd(0,W),y:rnd(0,H),s:rnd(.3,2.4),sp:rnd(.2,2.2),b:rnd(0,Math.PI*2)}));
    let fr=0;
    const draw=()=>{
      c.clearRect(0,0,W,H);
      stars.forEach(s=>{s.y+=s.sp;s.b+=.013;if(s.y>H){s.y=0;s.x=rnd(0,W);}
        c.globalAlpha=.08+.16*Math.sin(s.b);c.fillStyle='#ffffff';c.fillRect(s.x,s.y,s.s,s.s);});
      c.globalAlpha=.05+.025*Math.sin(fr*.007);
      let g=c.createRadialGradient(W*.5,H*.36,0,W*.5,H*.36,240);
      g.addColorStop(0,'rgba(0,160,255,.35)');g.addColorStop(.55,'rgba(0,60,200,.12)');g.addColorStop(1,'transparent');
      c.fillStyle=g;c.fillRect(0,0,W,H);c.globalAlpha=1;fr++;
      if(UI.cur==='sMenu')requestAnimationFrame(draw);
    };
    draw();
  },

  buildStageList(){
    let list=document.getElementById('stageList');list.innerHTML='';
    let lastW='';
    STAGES.forEach((st,i)=>{
      if(st.world!==lastW){
        lastW=st.world;
        let h=document.createElement('div');h.className='world-label';h.textContent=st.world;list.appendChild(h);
      }
      let cleared=SAV.cleared.includes(st.id);
      let avail=i===0||SAV.cleared.includes(STAGES[i-1]?.id);
      let node=document.createElement('div');
      node.className='snode '+(cleared?'done':avail?'bopen':'locked');
      node.innerHTML=`
        <span class="sn-num">${st.name}</span>
        <span class="sn-ico">${st.boss.ico}</span>
        <span class="sn-nm">${st.boss.name}</span>
        ${cleared?'<span class="sn-star">‚≠ê</span>':''}
        ${avail&&!cleared?'<span class="sn-badge">BOSS</span>':''}
      `;
      if(avail) node.onclick=()=>UI.goCharSelect(i);
      let row=document.createElement('div');row.className='stage-row';row.appendChild(node);list.appendChild(row);
    });
  },

  stageBg(){
    let cvs=document.getElementById('stageCvs'),c=cvs.getContext('2d');
    let stars=Array.from({length:60},()=>({x:rnd(0,W),y:rnd(0,H),s:rnd(.3,1.6),sp:rnd(.1,.6)}));
    const draw=()=>{
      c.clearRect(0,0,W,H);
      stars.forEach(s=>{s.y+=s.sp;if(s.y>H){s.y=0;s.x=rnd(0,W);}
        c.globalAlpha=.12;c.fillStyle='#ffffff';c.fillRect(s.x,s.y,s.s,s.s);});
      c.globalAlpha=1;
      if(UI.cur==='sStage')requestAnimationFrame(draw);
    };
    draw();
  },

  _stgIdx:0,_selChar:'p0',
  goCharSelect(idx){
    UI._stgIdx=idx;
    let st=STAGES[idx];
    document.getElementById('ciStage').textContent=st.name+' ‚Äî '+st.world;
    document.getElementById('ciBoss').textContent='vs '+st.boss.name;
    UI.show('sChar');UI.buildCharGrid();setTimeout(()=>{const info=document.getElementById('selCharInfo');const pl=PLANES[UI._selChar];if(info&&pl){info.style.display='block';info.innerHTML='<b style="color:#ffc944">'+pl.name+'</b> &nbsp;|&nbsp; ‚ö° '+pl.sp.name+'<br>SP„Ç≥„Çπ„Éà: '+pl.sp.cost+' &nbsp; HP: '+pl.hp;}},50);
  },
  buildCharGrid(){
    let g=document.getElementById('charGrid');g.innerHTML='';
    // Show all 100 chars: unlocked ones first, then locked
    const allIds=Object.keys(PLANES);
    const unlocked=allIds.filter(id=>SAV.hangar.includes(id));
    const locked=allIds.filter(id=>!SAV.hangar.includes(id));
    const displayIds=[...unlocked,...locked.slice(0,Math.min(locked.length,80))]; // show up to 80 locked
    displayIds.forEach(pid=>{
    const isLocked=!SAV.hangar.includes(pid);
      let pl=PLANES[pid];if(!pl)return;
      let sel=UI._selChar===pid;
      let card=document.createElement('div');card.className='ccard'+(sel?' sel':'');
      let bar=(l,v,c)=>`<div class="stbar"><div class="stbar-l">${l}</div><div class="stbar-t"><div class="stbar-f" style="width:${v/10*100}%;background:${c}"></div></div></div>`;
      card.innerHTML=`
        <span class="cc-r ${RCLS[pl.r]}">${'‚òÖ'.repeat(pl.r)}</span>
        <div class="cc-ico">${pl.ico}</div>
        <div class="cc-name">${pl.name}</div>
        <div class="cc-sp">${pl.sp.name}</div>
        <div class="cc-stats">${bar('A',pl.atk,'#ff4444')}${bar('D',pl.def,'#4488ff')}${bar('S',pl.spd_s,'#44ff88')}</div>
      `;
      card.onclick=()=>{
        if(isLocked){// Show locked tooltip
          card.style.animation='none';card.offsetHeight;card.style.animation='lockedShake .3s';
          return;
        }
        UI._selChar=pid;UI.buildCharGrid();
      };
      if(isLocked){
        card.style.opacity='.35';card.style.filter='grayscale(1)';card.style.cursor='not-allowed';
        card.innerHTML+='<div style="position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:22px;">üîí</div>';
      }
      // Update selected info panel
      if(sel){
        const pl2=PLANES[pid];
        const info=document.getElementById('selCharInfo');
        if(info&&pl2){
          info.style.display='block';
          info.innerHTML='<b style="color:#ffc944">'+pl2.name+'</b> &nbsp;|&nbsp; ‚ö° '+pl2.sp.name+'<br>'+'SP„Ç≥„Çπ„Éà: '+pl2.sp.cost+' &nbsp; HP: '+pl2.hp+' &nbsp; ÈÄüÂ∫¶: '+pl2.spd_s+'‚òÖ'.repeat(Math.min(pl2.spd_s,5));
        }
      }
      g.appendChild(card);
    });
  },
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  GACHA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const GACHA={
  rainbowPull(){
    if((SAV.rainbow||0)<1){alert('Ëôπ„ÅÆÊ¨†Áâá„ÅåË∂≥„Çä„Åæ„Åõ„ÇìÔºÅ\n„Çπ„ÉÜ„Éº„Ç∏„ÇØ„É™„Ç¢„Åß1%„ÅÆÁ¢∫Áéá„ÅßÂÖ•Êâã„Åß„Åç„Åæ„Åô');return;}
    // „É¨„Ç∏„Çß„É≥„ÉÄ„É™„Éº(r5)„ÅÆ„ÅøÂØæË±°
    const r5List=Object.values(PLANES).filter(p=>p.r===5);
    // Êú™ÂèñÂæó„ÇíÂÑ™ÂÖà„ÄÅÂÖ®ÈÉ®ÊåÅ„Å£„Å¶„ÅÑ„Åü„Çâ„É©„É≥„ÉÄ„É†
    const notOwned=r5List.filter(p=>!SAV.hangar.includes(p.id));
    const pool=notOwned.length>0?notOwned:r5List;
    const pick=pool[Math.floor(Math.random()*pool.length)];
    SAV.rainbow--;
    let isNew=false;
    if(!SAV.hangar.includes(pick.id)){SAV.hangar.push(pick.id);isNew=true;doSave();/* Âç≥‰øùÂ≠ò */}
    doSave();
    UI.updRainbow();UI.updCoins();
    GACHA.showResult(pick,'p',isNew);GACHA.animMachine(5);
    const rb=document.getElementById('rBtn');if(rb)rb.disabled=(SAV.rainbow||0)<1;
  },
  pull(){
    if(SAV.coins<1)return;
    SAV.coins--;doSave();UI.updCoins();
    let total=GTABLE.reduce((s,r)=>s+r.w,0),roll=rnd(0,total),acc=0;
    let pick=GTABLE[GTABLE.length-1];
    for(let r of GTABLE){acc+=r.w;if(roll<acc){pick=r;break;}}
    let obj=pick.tp==='p'?PLANES[pick.id]:ITEMS[pick.id];if(!obj)return;
    let isNew=false;
    if(pick.tp==='p'){
      if(!SAV.hangar.includes(pick.id)){SAV.hangar.push(pick.id);isNew=true;doSave();/* Âç≥‰øùÂ≠ò */}
      else{// ÈáçË§áÊôÇ„ÅØ„Ç≥„Ç§„É≥0.5ÂÄãËøîÈÇÑ(Á´ØÊï∞Âàá„Çä‰∏ä„Åí)‚ÜíÂÆüË£Ö‰∏ä„ÅØÊ¨°ÂõûÂàÜ„Å´Á©çÁ´ã
        if(!SAV._dupCount)SAV._dupCount=0;
        SAV._dupCount++;
        if(SAV._dupCount>=2){SAV.coins++;SAV._dupCount=0;}
      }
    } else{GACHA.applyItem(ITEMS[pick.id]);isNew=true;}
    doSave();GACHA.showResult(obj,pick.tp,isNew);GACHA.animMachine(obj.r);
  },
  applyItem(item){
    let pid=UI._selChar,pl=PLANES[pid];if(!pl)return;
    if(item.type==='sp')SAV.spUps[pl.sp.name]=(SAV.spUps[pl.sp.name]||0)+item.val;
    else if(item.type==='hp')SAV.upgrades[pid+'_hp']=(SAV.upgrades[pid+'_hp']||0)+1;
    else if(item.type==='atk')SAV.upgrades[pid+'_atk']=(SAV.upgrades[pid+'_atk']||0)+1;
    else if(item.type==='spd')SAV.upgrades[pid+'_spd']=(SAV.upgrades[pid+'_spd']||0)+1;
    else if(item.type==='cd')SAV.upgrades[pid+'_cd']=(SAV.upgrades[pid+'_cd']||0)+1;
  },
  showResult(obj,tp,isNew){
    let r=obj.r;
    document.getElementById('grIco').textContent=obj.ico;
    document.getElementById('grRar').textContent=RL[r];document.getElementById('grRar').style.color=RC[r];
    document.getElementById('grTp').textContent=tp==='p'?'‚úà NEW PLANE':'üîß ITEM';document.getElementById('grTp').style.color=RC[r];
    document.getElementById('grNm').textContent=obj.name;document.getElementById('grNm').style.color=RC[r];document.getElementById('grNm').style.textShadow=`0 0 20px ${RC[r]}`;
    document.getElementById('grDesc').textContent=obj.desc;
    document.getElementById('grNew').style.display=isNew?'block':'none';
    let cvs=document.getElementById('grBg'),c=cvs.getContext('2d');
    cvs.width=W;cvs.height=H;
    c.clearRect(0,0,W,H);let g=c.createRadialGradient(W/2,H/2,0,W/2,H/2,Math.max(W,H)*.5);
    g.addColorStop(0,hA(RC[r],.22));g.addColorStop(.7,hA(RC[r],.07));g.addColorStop(1,'rgba(0,0,0,0)');
    c.fillStyle=g;c.fillRect(0,0,W,H);
    document.getElementById('gRes').style.display='flex';
    let ico=document.getElementById('grIco');ico.style.animation='none';void ico.offsetWidth;ico.style.animation='grp .5s ease-out';
  },
  closeResult(){document.getElementById('gRes').style.display='none';},
  animMachine(rarity){
    let cvs=document.getElementById('gmCvs');if(!cvs)return;
    let c=cvs.getContext('2d'),col=rarity>0?RC[rarity]:'#00f5ff',fr=0;
    const draw=()=>{
      c.clearRect(0,0,180,180);let g=c.createRadialGradient(90,90,0,90,90,82);
      g.addColorStop(0,hA(col,fr<28?.42:.12));g.addColorStop(1,'rgba(0,0,0,0)');
      c.fillStyle=g;c.fillRect(0,0,180,180);
      for(let i=0;i<10;i++){let a=fr*.07+i/10*Math.PI*2,rad=50+Math.sin(fr*.05+i)*18;
        c.strokeStyle=hA(col,fr<28?.85:.32);c.lineWidth=1.5;
        c.beginPath();c.arc(90,90,rad,a,a+.7);c.stroke();}
      fr++;if(fr<80)requestAnimationFrame(draw);
    };
    draw();
  },
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  BATTLE ENGINE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const canvas=document.getElementById('batCvs');
const ctx=canvas.getContext('2d');

// State
let frame=0,score=0,gState='idle',paused=false;
let combo=0,comboT=0,maxCombo=0,totalKills=0;
let PL={x:W/2,y:H-200,vx:0,vy:0,hp:100,mhp:100,sp:0,msp:100,cd:0,iframes:0};
let bullets=[],eBullets=[],enemies=[],parts=[];
let boss=null,bossD=null;
let dropItems=[];  // ËêΩ‰∏ã„Ç¢„Ç§„ÉÜ„É† {x,y,vy,type:'heal'|'guard',r,life}
let guardActive=false,guardTimer=0; // „Ç¨„Éº„Éâ„Ç∑„Éº„É´„ÉâÁä∂ÊÖã
let spawnQ=[],spawnTimer=0,bossTriggered=false;
let totalSpawned=0,killedHp=0,threshHp=0;
let frozenT=0,spOvT=0;
let CH=PLANES.p0||PLANES[Object.keys(PLANES)[0]]; // current hero
let ST=STAGES[0];        // current stage
let cSpd=4,cCd=14,cHit=7,cSpCost=100,cDmg=1;
let keys={},tVec={x:0,y:0},tShoot=false,tSp=false;
let stars=Array.from({length:110},()=>({x:rnd(0,W),y:rnd(0,H),s:rnd(.3,2),sp:rnd(.1,.7),b:rnd(0,Math.PI*2)}));
let _loopStarted=false;

const BAT={
  start(){
    // Compute stats
    let pl=PLANES[UI._selChar]||PLANES.p0||PLANES[Object.keys(PLANES)[0]];CH=pl;
    // Custom stage support
    if(UI._stgIdx===-1&&window._customStage){
      ST=window._customStage;
    } else {
      ST=STAGES[Math.max(0,Math.min(STAGES.length-1,UI._stgIdx))];
    }
    let pid=pl.id;
    let spUp=SAV.spUps[pl.sp.name]||0;
    let hpUp=(SAV.upgrades[pid+'_hp']||0)*25;
    let atkUp=(SAV.upgrades[pid+'_atk']||0);
    let spdUp=(SAV.upgrades[pid+'_spd']||0)*.6;
    let cdUp=(SAV.upgrades[pid+'_cd']||0)*3;
    cSpd=pl.spd+spdUp; cCd=Math.max(5,pl.cd-cdUp);
    cHit=pl.hitR; cSpCost=Math.max(16,pl.sp.cost-spUp); cDmg=1+atkUp*.12;
    // Reset
    frame=0;score=0;gState='playing';combo=0;comboT=0;maxCombo=0;totalKills=0;
    PL.x=W/2;PL.y=H-200;PL.vx=0;PL.vy=0;
    PL.hp=pl.hp+hpUp;PL.mhp=pl.hp+hpUp;PL.sp=0;PL.cd=0;PL.iframes=0;
    bullets=[];eBullets=[];enemies=[];parts=[];
    boss=null;bossD=null;frozenT=0;spOvT=0;
    spawnQ=[];spawnTimer=0;bossTriggered=false;killedHp=0;totalSpawned=0;
    document.getElementById('hudBoss').style.display='none';
    document.getElementById('resWin').style.display='none';
    document.getElementById('resLose').style.display='none';
    document.getElementById('spOv').style.display='none';
    document.getElementById('spTxt').classList.remove('show');
    document.getElementById('hudScore').textContent='0';
    const hs=document.getElementById('hiScoreLbl');
    if(hs)hs.textContent='BEST '+( SAV.hiscore>0?SAV.hiscore.toLocaleString():'---');
    document.getElementById('hudWave').textContent='';
    UI.show('sBattle');
    BAT.bindControls();
    BAT.buildQueue();
    if(!_loopStarted){_loopStarted=true;BAT.loop();}
  },

  buildCustomQueue(st){
    const TOUHOU_COLS=['#ff2244','#ff6600','#ffcc00','#aaff00','#00ff88',
      '#00f5ff','#0088ff','#aa44ff','#ff44aa','#ffffff'];
    const counts=st.enemyCounts||{basic:20,zigzag:10,heavy:5,sniper:5};
    const diffMult=[0.6,1.0,1.5,2.2][st.diff||1];
    Object.entries(counts).forEach(([t,n])=>{
      for(let i=0;i<n;i++){
        const col=TOUHOU_COLS[Math.floor(Math.random()*TOUHOU_COLS.length)];
        spawnQ.push({t,x:rnd(30,W-30),y:-40-spawnQ.length*28,col});
        totalSpawned++;
      }
    });
    // Shuffle
    for(let i=spawnQ.length-1;i>0;i--){let j=0|rnd(0,i+1);[spawnQ[i],spawnQ[j]]=[spawnQ[j],spawnQ[i]];}
    threshHp=spawnQ.reduce((s,e)=>s+(e.t==='heavy'?4:e.t==='sniper'?2:1),0)*0.4;
    document.getElementById('hudWave').textContent='√ó'+spawnQ.length;
    // Apply diff multiplier to enemy speed via stgIdx override
    window._customDiffMult=diffMult;
  },
  buildQueue(){
    // „Ç´„Çπ„Çø„É†„Çπ„ÉÜ„Éº„Ç∏ÂØæÂøú
    if(UI._stgIdx===-1&&window._customStage){
      BAT.buildCustomQueue(window._customStage);return;
    }
    // Êù±ÊñπË¶èÊ®°ÔºöÂ§ßÈáèÈÄ£Á∂ö„Çπ„Éù„Éº„É≥
    let n = 60 + UI._stgIdx * 14;
    // Êù±Êñπ„Ç´„É©„Éº„Éë„É¨„ÉÉ„ÉàÔºàÂºæ„Åî„Å®„Å´„Éê„É©„Éê„É©„Å™Ëâ≤Ôºâ
    const TOUHOU_COLS = [
      '#ff2244','#ff6600','#ffcc00','#aaff00','#00ff88',
      '#00f5ff','#0088ff','#aa44ff','#ff44aa','#ffffff',
      '#ff88cc','#88ffff','#ffff44','#ff4488','#44ffff',
      '#ff8844','#44ff44','#8844ff','#ff44ff','#44ffaa'
    ];
    for(let i=0;i<n;i++){
      let roll=Math.random();
      let t=roll<.07?'heavy':roll<.2?'zigzag':roll<.15?'sniper':'basic';
      let col=TOUHOU_COLS[Math.floor(Math.random()*TOUHOU_COLS.length)];
      spawnQ.push({t,x:rnd(30,W-30),y:-40-i*28,col});
      totalSpawned++;
    }
    for(let i=spawnQ.length-1;i>0;i--){let j=0|rnd(0,i+1);[spawnQ[i],spawnQ[j]]=[spawnQ[j],spawnQ[i]];}
    threshHp=spawnQ.reduce((s,e)=>s+(e.t==='heavy'?4:e.t==='sniper'?2:1),0)*0.4;
    document.getElementById('hudWave').textContent='√ó'+spawnQ.length;
  },

  spawnEnemy(cfg){
    let hp=cfg.t==='heavy'?4:cfg.t==='sniper'?2:1;
    const _eid='e'+Date.now()+Math.random().toString(36).slice(2,5);
    enemies.push({x:cfg.x,y:cfg.y,eid:_eid,t:cfg.t,
      w:cfg.t==='heavy'?44:28,h:cfg.t==='heavy'?36:24,
      hp,mhp:hp,col:cfg.col,
      vx:cfg.t==='zigzag'?(Math.random()<.5?1.6:-1.6):0,
      vy:(cfg.t==='heavy'?.6:cfg.t==='sniper'?.9:1.3+Math.max(0,UI._stgIdx)*.1)*(window._customDiffMult||1),
      zig:0,shotT:rnd(40,100)});
  },

  spawnBoss(){
    if(boss)return;
    bossD=ST.boss;
    boss={x:W/2,y:115,hp:bossD.hp,mhp:bossD.hp,vx:1.6+UI._stgIdx*.16,patT:0,dead:false,deathT:0};
    gState='boss';
    document.getElementById('bossLbl').textContent=bossD.name;
    document.getElementById('hudBoss').style.display='block';
    document.getElementById('hudWave').textContent='‚òÖ BOSS ‚òÖ';
    BAT.updBoss();
    BAT.flash(hA(bossD.col,.35),22);
  },

  // ‚îÄ Shoot patterns ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  shoot(){
    let x=PL.x,y=PL.y,c=CH.col,dm=cDmg,s=CH.bStyle;
    const B=(vx,vy,r,d)=>({x,y,vx,vy,col:c,r:r||4,dm:d!=null?d:dm});
    switch(s){
      case 'tri3': bullets.push(B(0,-14,4),B(-.55,-13,3,dm*.6),B(.55,-13,3,dm*.6));break;
      case 'fan5': for(let i=-2;i<=2;i++) bullets.push(B(i*.62,-14+Math.abs(i)*.3,3.5,dm*.75));break;
      case 'big3': bullets.push(B(0,-12,6,dm*1.5),B(-1.2,-11,5,dm),B(1.2,-11,5,dm));break;
      case 'fast3': bullets.push(B(0,-18,4,dm),B(-.4,-17,3,dm*.7),B(.4,-17,3,dm*.7));break;
      case 'wide5': for(let i=-2;i<=2;i++) bullets.push(B(i*1.9,-13,5,dm*.9));break;
      case 'rapid2': bullets.push(B(rnd(-.3,.3),-17,3,dm),B(rnd(-.3,.3),-15,3,dm));break;
      case 'v5': for(let i=-2;i<=2;i++) bullets.push(B(i*.58,-14-Math.abs(i)*.6,4,dm*.8));break;
      case 'bomb5': for(let i=-2;i<=2;i++) bullets.push(B(i*.9,-13,4.5,dm*.85));bullets.push(B(0,-9,0,-8,3,dm*.6));break;
      case 'ring8': for(let i=0;i<8;i++){let a=-Math.PI/2+i/8*Math.PI*.72-Math.PI*.36;bullets.push(B(Math.cos(a)*11,Math.sin(a)*11,3.5,dm*.8));}break;
      case 'solar': for(let i=0;i<7;i++){let a=-Math.PI*.72+i/6*Math.PI*1.44;bullets.push(B(Math.cos(a)*12,Math.sin(a)*12,4,dm*.85));}break;
      case 'divine': for(let i=-3;i<=3;i++) bullets.push(B(i*.42,-14,4,dm));bullets.push(B(0,-9,0,-8,5,dm));break;
      case 'apoc': for(let i=0;i<9;i++){let a=-Math.PI/2+rnd(-.5,.5)+i/9*Math.PI;bullets.push(B(Math.cos(a)*13,Math.sin(a)*13,3.5,dm*.85));}break;
      // ‚îÄ‚îÄ‚îÄ Êñ∞ÂºæÂπï8Á®Æ ‚îÄ‚îÄ‚îÄ
      case 'cross4': bullets.push(B(0,-15,4),B(0,8,3,dm*.4),B(-12,0,3,dm*.4),B(12,0,3,dm*.4));break;
      case 'helix': {const f=frame*.18;for(let i=0;i<4;i++){const a=f+i/4*Math.PI*2;bullets.push(B(Math.cos(a)*8,Math.sin(a)*8-14,3.5,dm*.8));}break;}
      case 'spiral': {for(let i=0;i<5;i++){const a=-Math.PI/2+i*.28+frame*.12;const r2=10+i*2;bullets.push(B(Math.cos(a)*r2,Math.sin(a)*r2-8,3,dm*.75));}break;}
      case 'scatter': {for(let i=0;i<6;i++) bullets.push(B(rnd(-6,6),-rnd(11,16),3,dm*.8));break;}
      case 'needle': {bullets.push(B(0,-22,3,dm*1.8));for(let i=0;i<2;i++) bullets.push(B((i===0?-1:1)*.4,-20,2,dm*.5));break;}
      case 'wave': {for(let i=-2;i<=2;i++){const wy=Math.sin(frame*.2+i)*3;bullets.push(B(i*.7,-14+wy,3.5,dm*.85));}break;}
      case 'burst12': {for(let i=0;i<12;i++){const a=-Math.PI*.7+i/11*Math.PI*1.4;bullets.push(B(Math.cos(a)*11,Math.sin(a)*11,3,dm*.6));}break;}
      case 'omega16': {for(let i=0;i<8;i++){const a=-Math.PI/2+i/8*Math.PI*2;bullets.push(B(Math.cos(a)*12,Math.sin(a)*12-2,3.5,dm*.65),B(Math.cos(a+.2)*7,Math.sin(a+.2)*7-8,2.5,dm*.5));}break;}
      default: bullets.push(B(0,-14,4),B(-.5,-13,3,dm*.6),B(.5,-13,3,dm*.6));
    }
  },

  // ‚îÄ Specials ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  gainSp(n){PL.sp=Math.min(PL.msp,PL.sp+(n||2));},
  triggerSp(){
    if(PL.sp<cSpCost)return;
    PL.sp=0;BAT.updHud();
    // SP name to function index map
    const SP_MAP={
      'NOVA BURST':0,'DIVE SHOT':1,'SHIELD BLAST':2,'GHOST SHOT':3,'LIGHTNING':4,
      'VENOM RUSH':5,'STORM CALL':6,'HOWLING FIRE':7,'DARK NOVA':8,'SOLAR FLARE':9,
      'DIVINE WRATH':10,'VOID APOCALYPSE':11,'METEOR SHOWER':12,'ICE LANCE':13,
      'PLASMA CANNON':14,'SHADOW BLADE':15,'AURORA RING':16,'THUNDER CROSS':17,
      'CRYSTAL BURST':18,'VOID RIFT':19,'FLAME SPIRAL':20,'AQUA TORRENT':21,
      'WIND SLASH':22,'EARTH QUAKE':23,'STAR RAIN':24,'DARK SPIRAL':25,
      'HOLY CROSS':26,'CHAOS BURST':27,'OMEGA BEAM':28,'LASER RAIN':29,
      'POISON CLOUD':30,'MAGNET PULL':31,'GRAVITY WELL':32,'TIME STOP':33,
      'DIMENSION CUT':34,'REBIRTH NOVA':35,'CRIMSON TIDE':36,'FROZEN WORLD':37,
      'NEON BURST':38,'PHOTON SWORD':39,'GALAXY STORM':40,'ATOM SPLIT':41,
      'PULSE WAVE':42,'VOID DRAIN':43,'PHOENIX RISE':44,'SHOCKWAVE':45,
      'MIRROR SHOT':46,'TSUNAMI':47,'VOLCANO BURST':48,'BLIZZARD':49,
      'TORNADO':50,'NIGHTMARE':51,'REQUIEM':52,'CRIMSON NOVA':53,
      'GLACIAL LANCE':54,'THUNDER GOD':55,'SAKURA STORM':56,'DRAGON FANG':57,
      'NEBULA BURST':58,'STARFALL':59,'ECLIPSE BEAM':60,'SHATTER RING':61,
      'SOUL DRAIN':62,'COSMIC RAY':63,'LAVA SURGE':64,'GALE FORCE':65,
      'TIDAL WAVE':66,'ACID RAIN':67,'WARP STRIKE':68,'QUASAR BLAST':69,
      'RUNE BURST':70,'ANGEL WING':71,'DEMON CLAW':72,'ABYSS CALL':73,
      'SUPERNOVA':74,'ION CANNON':75,'MACH STRIKE':76,'ZERO GRAVITY':77,
      'PRISM SHOT':78,'CRIMSON BLADE':79,'MOONFALL':80,'SUNBURST':81,
      'VOID STORM':82,'CRYSTAL CAGE':83,'PLASMA STORM':84,'GRAVITY BOMB':85,
      'THUNDER RAIN':86,'FROZEN STAR':87,'INFERNO':88,'SHADOW STORM':89,
      'CELESTIAL BEAM':90,'NANO BURST':91,'KINETIC BLAST':92,'SPECTRAL WAVE':93,
      'RESONANCE':94,'QUANTUM BURST':95,'ULTIMA BEAM':96,'GENESIS NOVA':97,
      'OMEGA STORM':98,'TRUE APOCALYPSE':99,
      'HYPER CANNON':100,'TWIN LANCER':101,'LASER CROSS':102,'BLADE RAIN':103,'DEATH SPIRAL':104,'PLASMA NET':105,'VOID ARROW':106,'AQUA BLAST':107,'TERRA BREAK':108,'AERO SLASH':109,'PHOTON STORM':110,'DARK RAIN':111,'HOLY FIRE':112,'CHAOS WHIRL':113,'OMEGA PULSE':114,'NEON RAIN':115,'CRYSTAL LANCE':116,'VOLT SURGE':117,'FROST NOVA':118,'SHADOW NET':119,'SOLAR RAY':120,'LUNAR STRIKE':121,'STAR LANCE':122,'COSMIC DRILL':123,'GALAXY WAVE':124,'PLASMA BURST':125,'VOID RING':126,'ICE STORM':127,'FLAME CROSS':128,'THUNDER BLADE':129,'SPIRIT WAVE':130,'DRAGON STORM':131,'ANGEL BEAM':132,'DEMON RUSH':133,'ABYSS LANCE':134,'NOVA CROSS':135,'ION BURST':136,'ZERO LANCE':137,'PRISM RAIN':138,'CRIMSON STORM':139,'MOON SHOT':140,'SUN FLARE':141,'VOID CROSS':142,'CRYSTAL STORM':143,'PLASMA LANCE':144,'GRAVITY RAIN':145,'THUNDER CROSS2':146,'FROZEN BLAST':147,'INFERNO BURST':148,'SHADOW LANCE':149,'CELESTIAL STORM':150,'NANO RAIN':151,'KINETIC CROSS':152,'SPECTRAL BURST':153,'RESONANCE2':154,'QUANTUM STORM':155,'ULTIMA LANCE':156,'GENESIS BURST':157,'OMEGA RAIN':158,'TRUE CROSS':159,'HYPER STORM':160,'TWIN BURST':161,'LASER STORM':162,'BLADE CROSS':163,'DEATH RAIN':164,'PLASMA SURGE':165,'VOID STORM2':166,'AQUA CROSS':167,'TERRA STORM':168,'AERO BURST':169,'PHOTON RAIN':170,'DARK CROSS':171,'HOLY STORM':172,'CHAOS LANCE':173,'OMEGA CROSS':174,'NEON BURST2':175,'CRYSTAL CROSS':176,'VOLT RAIN':177,'FROST STORM':178,'SHADOW BURST':179,'SOLAR CROSS':180,'LUNAR BURST':181,'STAR STORM':182,'COSMIC CROSS':183,'GALAXY BURST':184,'PLASMA CROSS':185,'VOID BURST':186,'ICE CROSS':187,'FLAME STORM':188,'THUNDER RAIN2':189,'SPIRIT BURST':190,'DRAGON CROSS':191,'ANGEL STORM':192,'DEMON BURST':193,'ABYSS STORM':194,'NOVA STORM':195,'ION CROSS':196,'ZERO BURST':197,'PRISM STORM':198,'CRIMSON BURST':199,'MOON BURST':200,'SUN STORM':201,'VOID LANCE2':202,'CRYSTAL BURST2':203,'APOCALYPSE':204,
    };
    let idx=SP_MAP[CH.sp.name];
    if(idx===undefined)idx=0;
    BAT.ALL_SP[idx]();
    BAT.showSpOv(CH.sp.name,CH.sp.rb,CH.col);
    BAT.flash(hA(CH.col,.38),50);
    tSp=false;
  },
  pauseGame(){
    if(gState!=='playing'&&gState!=='boss')return;
    paused=true;document.getElementById('pauseOv').style.display='flex';
  },
  resumeGame(){
    paused=false;document.getElementById('pauseOv').style.display='none';
    BAT._lastT=0; // „Çø„Ç§„É†„Çπ„Çø„É≥„Éó„É™„Çª„ÉÉ„Éà„ÅßÂ§ß„Ç∏„É£„É≥„ÉóÈò≤Ê≠¢
  },
  retryFromPause(){
    paused=false;document.getElementById('pauseOv').style.display='none';
    BAT.start();
  },
  quitToMenu(){
    paused=false;gState='idle';
    document.getElementById('pauseOv').style.display='none';
    UI.goMenu();
  },
  pt(x,y,col,n,big){for(let i=0;i<n;i++){let a=rnd(0,Math.PI*2),sp=rnd(1,big?7.5:3.8);let c2=col==='rb'?rbC(frame+i*7):col;parts.push({x,y,vx:Math.cos(a)*sp,vy:Math.sin(a)*sp,life:1,dc:rnd(.016,.05),r:rnd(1,big?5.5:3),col:c2});}},
  addScore(n){score+=n;document.getElementById('hudScore').textContent=score.toLocaleString();},
  spawnDrop(x,y){
    const t=Math.random()<.35?'heal':'guard';
    dropItems.push({x,y,vy:1.2+Math.random()*.8,type:t,r:11,life:280});
  },
  addKill(x,y,col,hp){
    totalKills++;killedHp+=hp;combo++;comboT=90;if(combo>maxCombo)maxCombo=combo;
    if(Math.random()<.15)BAT.spawnDrop(x,y);
    const bonus=combo>=10?combo*20:combo>=5?combo*10:combo>=3?combo*5:0;
    if(bonus>0)BAT.addScore(bonus);
    // Combo display
    const cd=document.getElementById('comboDisplay');
    const cn=document.getElementById('comboNum');
    if(cd&&cn){
      const c2=combo>=10?'#ff44aa':combo>=5?'#ffc944':'#00f5ff';
      cn.textContent=combo+'√ó';cn.style.color=c2;
      cd.style.opacity='1';cd.style.top=(combo>=5?'30px':'36px');
    }
    // particles
    BAT.pt(x,y,combo>=5?'rb':col,combo>=3?8:4,combo>=5);
  },
  bDmg(d){if(boss&&!boss.dead){boss.hp=Math.max(0,boss.hp-d);BAT.updBoss();}},
  spNova(){for(let i=0;i<20;i++){let a=i/20*Math.PI*2;bullets.push({x:PL.x,y:PL.y,vx:Math.cos(a)*10,vy:Math.sin(a)*10,col:CH.col,r:5,dm:8*cDmg});}BAT.pt(PL.x,PL.y,'rb',32,true);},
  spDive(){for(let i=0;i<9;i++)bullets.push({x:PL.x+rnd(-30,30),y:PL.y,vx:rnd(-.4,.4),vy:-20,col:CH.col,r:4,dm:12*cDmg});BAT.pt(PL.x,PL.y,CH.col,22,true);},
  spShield(){PL.iframes=190;enemies.forEach(e=>{e.hp-=7;BAT.pt(e.x,e.y,CH.col,4);});enemies=enemies.filter(e=>{if(e.hp<=0){BAT.addScore(200);killedHp+=e.mhp;return false;}return true;});BAT.pt(PL.x,PL.y,CH.col,28,true);},
  spGhost(){PL.iframes=130;for(let i=0;i<26;i++){let a=i/26*Math.PI*2;bullets.push({x:PL.x,y:PL.y,vx:Math.cos(a)*9.5,vy:Math.sin(a)*9.5,col:CH.col,r:4,dm:10*cDmg});}BAT.pt(PL.x,PL.y,'rb',28,true);},
  spLightning(){eBullets=[];enemies.forEach(e=>{e.hp-=9;BAT.pt(e.x,e.y,'#ffee44',5);});enemies=enemies.filter(e=>{if(e.hp<=0){BAT.addScore(200);killedHp+=e.mhp;return false;}return true;});BAT.bDmg(15);BAT.pt(PL.x,PL.y,'#ffee44',32,true);},
  spVenom(){for(let i=0;i<11;i++)bullets.push({x:PL.x+rnd(-20,20),y:PL.y-8,vx:rnd(-1.5,1.5),vy:-18,col:CH.col,r:3,dm:14*cDmg});PL.iframes=35;BAT.pt(PL.x,PL.y,CH.col,22,true);},
  spStorm(){for(let i=0;i<18;i++){let a=i/18*Math.PI*2;for(let r2=1;r2<=2;r2++)bullets.push({x:PL.x,y:PL.y,vx:Math.cos(a)*7*r2,vy:Math.sin(a)*7*r2,col:CH.col,r:4,dm:8*cDmg});}BAT.pt(PL.x,PL.y,'rb',44,true);},
  spFire(){enemies.forEach(e=>{e.hp-=16;BAT.pt(e.x,e.y,'#ff6600',8);});enemies=enemies.filter(e=>{if(e.hp<=0){BAT.addScore(300);killedHp+=e.mhp;return false;}return true;});BAT.bDmg(32);eBullets=[];BAT.pt(PL.x,PL.y,'#ff6600',44,true);PL.iframes=22;},
  spDark(){for(let i=0;i<26;i++){let a=i/26*Math.PI*2;bullets.push({x:PL.x,y:PL.y,vx:Math.cos(a)*11,vy:Math.sin(a)*11,col:CH.col,r:5,dm:10*cDmg});}frozenT=95;BAT.pt(PL.x,PL.y,CH.col,55,true);},
  spSolar(){for(let i=0;i<34;i++){let a=i/34*Math.PI*2;bullets.push({x:PL.x,y:PL.y,vx:Math.cos(a)*11.5,vy:Math.sin(a)*11.5,col:CH.col,r:5,dm:12*cDmg});}enemies.forEach(e=>{e.hp-=13;BAT.pt(e.x,e.y,'#ff8800',5);});enemies=enemies.filter(e=>{if(e.hp<=0){BAT.addScore(200);killedHp+=e.mhp;return false;}return true;});BAT.bDmg(24);eBullets=[];PL.iframes=22;BAT.pt(PL.x,PL.y,'rb',65,true);},
  spDivine(){for(let i=0;i<38;i++){let a=i/38*Math.PI*2;bullets.push({x:PL.x,y:PL.y,vx:Math.cos(a)*12.5,vy:Math.sin(a)*12.5,col:'#ffd700',r:6,dm:14*cDmg});}enemies.forEach(e=>{e.hp=0;BAT.pt(e.x,e.y,'#ffd700',8);});enemies=enemies.filter(e=>{if(e.hp<=0){BAT.addScore(500);killedHp+=e.mhp;return false;}return true;});BAT.bDmg(44);eBullets=[];PL.iframes=65;BAT.pt(PL.x,PL.y,'rb',88,true);},
  spApoc(){for(let i=0;i<46;i++){let a=rnd(0,Math.PI*2);bullets.push({x:PL.x,y:PL.y,vx:Math.cos(a)*13.5,vy:Math.sin(a)*13.5,col:'#ffffff',r:5,dm:16*cDmg});}enemies.forEach(e=>{e.hp=0;BAT.pt(e.x,e.y,'rb',10);});enemies=enemies.filter(e=>{if(e.hp<=0){BAT.addScore(500);killedHp+=e.mhp;return false;}return true;});BAT.bDmg(58);eBullets=[];frozenT=140;PL.iframes=65;BAT.pt(PL.x,PL.y,'rb',110,true);},
  // ‚îÄ ALL 100 SP functions as array ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  ALL_SP:[
    // 0: NOVA BURST
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<20;i++){let a=i/20*Math.PI*2;bullets.push({x,y,vx:Math.cos(a)*10,vy:Math.sin(a)*10,col:c,r:5,dm:dm*1.1});}BAT.pt(x,y,'rb',32,true);},
    // 1: DIVE SHOT
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<9;i++)bullets.push({x,y,vx:rnd(-.4,.4),vy:-20,col:c,r:4,dm:12*dm});BAT.pt(x,y,c,22,true);},
    // 2: SHIELD BLAST
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;PL.iframes=190;enemies.forEach(e=>{e.hp-=7;BAT.pt(e.x,e.y,c,4);});enemies=enemies.filter(e=>{if(e.hp<=0){BAT.addScore(200);killedHp+=e.mhp;return false;}return true;});BAT.pt(x,y,c,28,true);},
    // 3: GHOST SHOT
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;PL.iframes=130;for(let i=0;i<26;i++){let a=i/26*Math.PI*2;bullets.push({x,y,vx:Math.cos(a)*9.5,vy:Math.sin(a)*9.5,col:c,r:4,dm:dm});}BAT.pt(x,y,'rb',28,true);},
    // 4: LIGHTNING
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;eBullets=[];enemies.forEach(e=>{e.hp-=9;BAT.pt(e.x,e.y,'#ffee44',5);});enemies=enemies.filter(e=>{if(e.hp<=0){BAT.addScore(200);killedHp+=e.mhp;return false;}return true;});BAT.bDmg(15);BAT.pt(x,y,'#ffee44',32,true);},
    // 5: VENOM RUSH
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<11;i++)bullets.push({x,y,vx:rnd(-1.5,1.5),vy:-18,col:c,r:3,dm:14*dm});PL.iframes=35;BAT.pt(x,y,c,22,true);},
    // 6: STORM CALL
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<18;i++){let a=i/18*Math.PI*2;for(let r2=1;r2<=2;r2++)bullets.push({x,y,vx:Math.cos(a)*r2*6,vy:Math.sin(a)*r2*6,col:c,r:4,dm:dm*.85});}BAT.pt(x,y,'rb',44,true);},
    // 7: HOWLING FIRE
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;enemies.forEach(e=>{e.hp-=16;BAT.pt(e.x,e.y,'#ff6600',8);});enemies=enemies.filter(e=>{if(e.hp<=0){BAT.addScore(300);killedHp+=e.mhp;return false;}return true;});BAT.bDmg(32);eBullets=[];BAT.pt(x,y,'#ff6600',44,true);PL.iframes=22;},
    // 8: DARK NOVA
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<26;i++){let a=i/26*Math.PI*2;bullets.push({x,y,vx:Math.cos(a)*11,vy:Math.sin(a)*11,col:c,r:5,dm:dm});}frozenT=95;BAT.pt(x,y,c,55,true);},
    // 9: SOLAR FLARE
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<34;i++){let a=i/34*Math.PI*2;bullets.push({x,y,vx:Math.cos(a)*11.5,vy:Math.sin(a)*11.5,col:c,r:5,dm:dm});}enemies.forEach(e=>{e.hp-=13;BAT.pt(e.x,e.y,'#ff8800',5);});enemies=enemies.filter(e=>{if(e.hp<=0){BAT.addScore(200);killedHp+=e.mhp;return false;}return true;});BAT.bDmg(24);eBullets=[];PL.iframes=22;BAT.pt(x,y,'rb',65,true);},
    // 10: DIVINE WRATH
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<38;i++){let a=i/38*Math.PI*2;bullets.push({x,y,vx:Math.cos(a)*12.5,vy:Math.sin(a)*12.5,col:'#ffd700',r:6,dm:dm*1.1});}enemies.forEach(e=>{e.hp=0;BAT.pt(e.x,e.y,'#ffd700',8);});enemies=enemies.filter(e=>{if(e.hp<=0){BAT.addScore(500);killedHp+=e.mhp;return false;}return true;});BAT.bDmg(44);eBullets=[];PL.iframes=65;BAT.pt(x,y,'rb',88,true);},
    // 11: VOID APOCALYPSE
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<46;i++){let a=rnd(0,Math.PI*2);bullets.push({x,y,vx:Math.cos(a)*13.5,vy:Math.sin(a)*13.5,col:'#ffffff',r:5,dm:dm*1.1});}enemies.forEach(e=>{e.hp=0;BAT.pt(e.x,e.y,'rb',10);});enemies=enemies.filter(e=>{if(e.hp<=0){BAT.addScore(500);killedHp+=e.mhp;return false;}return true;});BAT.bDmg(58);eBullets=[];frozenT=140;PL.iframes=65;BAT.pt(x,y,'rb',110,true);},
    // 12: METEOR SHOWER
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<20;i++)setTimeout(()=>{if(gState!=='idle')bullets.push({x:rnd(0,W),y:-10,vx:0,vy:9+rnd(0,3),col:'#ffaa44',r:4,dm:dm*1.2})},i*30);BAT.pt(x,y,c,20,true);},
    // 13: ICE LANCE
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<5;i++)bullets.push({x,y,vx:(i-2)*.5,vy:-16,col:'#88ddff',r:5,dm:dm*1.4});frozenT=60;BAT.pt(x,y,'#88ddff',18,true);},
    // 14: PLASMA CANNON
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<3;i++)bullets.push({x,y:y-i*20,vx:0,vy:-18,col:'#aa88ff',r:6,dm:dm*2.0});BAT.pt(x,y,c,15,true);},
    // 15: SHADOW BLADE
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<12;i++){let a=i/12*Math.PI*2+Math.PI/12;bullets.push({x,y,vx:Math.cos(a)*9,vy:Math.sin(a)*9,col:'#445566',r:4,dm:dm*.9});}PL.iframes=80;BAT.pt(x,y,'#334455',20,true);},
    // 16: AURORA RING
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<16;i++){let a=i/16*Math.PI*2;bullets.push({x,y,vx:Math.cos(a)*8,vy:Math.sin(a)*8,col:`hsl(${i*22},100%,65%)`,r:5,dm:dm*.85});}BAT.pt(x,y,'rb',25,true);},
    // 17: THUNDER CROSS
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;[0,Math.PI/2,Math.PI,Math.PI*1.5].forEach(a=>{for(let r2=1;r2<=3;r2++)bullets.push({x,y,vx:Math.cos(a)*r2*4,vy:Math.sin(a)*r2*4,col:'#ffee00',r:4,dm:dm*.8});});BAT.pt(x,y,'#ffee00',20,true);},
    // 18: CRYSTAL BURST
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<24;i++){let a=i/24*Math.PI*2;bullets.push({x,y,vx:Math.cos(a)*(6+i*.1),vy:Math.sin(a)*(6+i*.1),col:'#88eeff',r:3+i*.05,dm:dm*.75});}BAT.pt(x,y,'#88eeff',22,true);},
    // 19: VOID RIFT
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;eBullets=[];enemies.forEach(e=>{e.hp-=8;BAT.pt(e.x,e.y,c,5);});enemies=enemies.filter(e=>{if(e.hp<=0){BAT.addScore(300);killedHp+=e.mhp;return false;}return true;});frozenT=110;BAT.pt(x,y,c,30,true);},
    // 20: FLAME SPIRAL
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<20;i++){let a=i/20*Math.PI*2+frame*.03;for(let r2=1;r2<=2;r2++)bullets.push({x,y,vx:Math.cos(a)*r2*5.5,vy:Math.sin(a)*r2*5.5,col:'#ff6600',r:4,dm:dm*.8});}BAT.pt(x,y,'#ff6600',25,true);},
    // 21: AQUA TORRENT
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<8;i++){let a=-Math.PI*.6+i/7*Math.PI*1.2;for(let j=1;j<=3;j++)bullets.push({x,y,vx:Math.cos(a)*j*4,vy:Math.sin(a)*j*4,col:'#44aaff',r:4,dm:dm*.8});}BAT.pt(x,y,'#44aaff',20,true);},
    // 22: WIND SLASH
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<7;i++){let a=-Math.PI/2+rnd(-.3,.3);bullets.push({x:x+rnd(-40,40),y,vx:Math.cos(a)*14,vy:Math.sin(a)*14,col:'#aaffaa',r:3,dm:dm*1.1});}PL.iframes=40;BAT.pt(x,y,'#aaffaa',18,true);},
    // 23: EARTH QUAKE
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;enemies.forEach(e=>{e.hp-=12;BAT.pt(e.x,e.y,'#886644',6);});enemies=enemies.filter(e=>{if(e.hp<=0){BAT.addScore(250);killedHp+=e.mhp;return false;}return true;});for(let i=0;i<12;i++){let a=i/12*Math.PI*2;bullets.push({x,y,vx:Math.cos(a)*7,vy:Math.sin(a)*7,col:'#886644',r:5,dm:dm});}BAT.pt(x,y,'#886644',20,true);},
    // 24: STAR RAIN
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<30;i++)setTimeout(()=>{if(gState!=='idle')bullets.push({x:rnd(0,W),y:rnd(0,H*.5),vx:rnd(-1,1),vy:6+rnd(0,4),col:'#ffffaa',r:3,dm:dm})},i*25);BAT.pt(x,y,'#ffffaa',25,true);},
    // 25: DARK SPIRAL
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<22;i++){let a=i/22*Math.PI*2+frame*.05;bullets.push({x,y,vx:Math.cos(a)*10,vy:Math.sin(a)*10,col:'#554466',r:4.5,dm:dm*.9});}frozenT=50;BAT.pt(x,y,'#554466',22,true);},
    // 26: HOLY CROSS
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;[0,Math.PI/4,Math.PI/2,Math.PI*.75,Math.PI,Math.PI*1.25,Math.PI*1.5,Math.PI*1.75].forEach(a=>{bullets.push({x,y,vx:Math.cos(a)*11,vy:Math.sin(a)*11,col:'#ffffcc',r:5,dm:dm*1.1});});PL.iframes=90;BAT.pt(x,y,'#ffffcc',25,true);},
    // 27: CHAOS BURST
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<40;i++){let a=rnd(0,Math.PI*2);bullets.push({x,y,vx:Math.cos(a)*rnd(4,13),vy:Math.sin(a)*rnd(4,13),col:rbC(frame+i*11),r:rnd(2,5),dm:dm*rnd(.6,1.2)});}BAT.pt(x,y,'rb',35,true);},
    // 28: OMEGA BEAM
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<5;i++){let a=-Math.PI/2+rnd(-.15,.15);bullets.push({x:x+rnd(-30,30),y,vx:Math.cos(a)*rnd(8,14),vy:Math.sin(a)*rnd(8,14),col:'#ffffff',r:6,dm:dm*2.2});}BAT.bDmg(20);BAT.pt(x,y,'#ffffff',22,true);},
    // 29: LASER RAIN
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<15;i++)setTimeout(()=>{if(gState!=='idle'){let a=rnd(-Math.PI*.4,.4)-Math.PI/2;bullets.push({x:rnd(20,W-20),y:0,vx:Math.cos(a)*10,vy:Math.sin(a)*10,col:'#ff4488',r:3,dm:dm*1.1});}},i*40);BAT.pt(x,y,c,18,true);},
    // 30: POISON CLOUD
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<16;i++){let a=i/16*Math.PI*2;bullets.push({x,y,vx:Math.cos(a)*6.5,vy:Math.sin(a)*6.5,col:'#44ff44',r:5,dm:dm*.85});}enemies.forEach(e=>{e.hp-=6;BAT.pt(e.x,e.y,'#44ff44',3);});enemies=enemies.filter(e=>{if(e.hp<=0){BAT.addScore(200);killedHp+=e.mhp;return false;}return true;});BAT.pt(x,y,'#44ff44',20,true);},
    // 31: MAGNET PULL
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;enemies.forEach(e=>{let dx=x-e.x,dy=y-e.y,d=Math.sqrt(dx*dx+dy*dy)||1;e.x+=dx/d*3;e.y+=dy/d*3;});for(let i=0;i<12;i++){let a=i/12*Math.PI*2;bullets.push({x,y,vx:Math.cos(a)*9,vy:Math.sin(a)*9,col:'#aaffff',r:4,dm:dm});}BAT.pt(x,y,'#aaffff',18,true);},
    // 32: GRAVITY WELL
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;enemies.forEach(e=>{e.vy*=.3;BAT.pt(e.x,e.y,'#8844ff',4);});frozenT=130;for(let i=0;i<18;i++){let a=i/18*Math.PI*2;bullets.push({x,y,vx:Math.cos(a)*10,vy:Math.sin(a)*10,col:'#8844ff',r:5,dm:dm*.9});}BAT.pt(x,y,'#8844ff',25,true);},
    // 33: TIME STOP
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;frozenT=200;eBullets=[];enemies.forEach(e=>{e.vy=0;});BAT.pt(x,y,'#ffffff',35,true);PL.iframes=60;},
    // 34: DIMENSION CUT
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<50;i++){let a=rnd(0,Math.PI*2),sp=rnd(2,6);bullets.push({x,y,vx:Math.cos(a)*sp*2,vy:Math.sin(a)*sp*2,col:rbC(frame+i*9),r:3,dm:dm*.9});}eBullets=[];BAT.pt(x,y,'rb',40,true);},
    // 35: REBIRTH NOVA
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;PL.hp=Math.min(PL.mhp,PL.hp+Math.floor(PL.mhp*.3));PL.iframes=100;for(let i=0;i<20;i++){let a=i/20*Math.PI*2;bullets.push({x,y,vx:Math.cos(a)*10,vy:Math.sin(a)*10,col:'#ffaaff',r:5,dm:dm});}BAT.updHud();BAT.pt(x,y,'#ffaaff',28,true);},
    // 36: CRIMSON TIDE
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<6;i++)setTimeout(()=>{if(gState!=='idle'){for(let j=0;j<8;j++){let a=j/8*Math.PI*2;bullets.push({x:PL.x,y:PL.y,vx:Math.cos(a)*9,vy:Math.sin(a)*9,col:'#ff2244',r:5,dm:dm*1.1});}}},i*60);BAT.pt(x,y,'#ff2244',22,true);},
    // 37: FROZEN WORLD
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;frozenT=160;eBullets=[];for(let i=0;i<30;i++){let a=i/30*Math.PI*2;bullets.push({x,y,vx:Math.cos(a)*9,vy:Math.sin(a)*9,col:'#88eeff',r:4,dm:dm*.85});}enemies.forEach(e=>{e.hp-=10;});enemies=enemies.filter(e=>{if(e.hp<=0){BAT.addScore(200);killedHp+=e.mhp;return false;}return true;});BAT.pt(x,y,'#88eeff',30,true);},
    // 38: NEON BURST
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<28;i++){let a=i/28*Math.PI*2;bullets.push({x,y,vx:Math.cos(a)*(7+i*.08),vy:Math.sin(a)*(7+i*.08),col:`hsl(${i*13},100%,70%)`,r:3.5,dm:dm*.8});}BAT.pt(x,y,'rb',25,true);},
    // 39: PHOTON SWORD
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<4;i++)bullets.push({x:x-30+i*20,y,vx:0,vy:-18+i*.5,col:'#ffcc00',r:4,dm:dm*1.6});PL.iframes=30;BAT.pt(x,y,'#ffcc00',16,true);},
    // 40: GALAXY STORM
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<36;i++){let a=i/36*Math.PI*2+frame*.04;bullets.push({x,y,vx:Math.cos(a)*10,vy:Math.sin(a)*10,col:`hsl(${i*10},100%,65%)`,r:4,dm:dm*.8});}BAT.bDmg(25);eBullets=[];BAT.pt(x,y,'rb',40,true);},
    // 41: ATOM SPLIT
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<3;i++){for(let j=0;j<12;j++){let a=j/12*Math.PI*2;bullets.push({x,y,vx:Math.cos(a)*(5+i*3),vy:Math.sin(a)*(5+i*3),col:['#ffaa00','#00ff88','#0088ff'][i],r:4,dm:dm*.85});}}BAT.pt(x,y,'rb',30,true);},
    // 42: PULSE WAVE
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<8;i++)setTimeout(()=>{if(gState!=='idle'){let a=-Math.PI*.6+i/7*Math.PI*1.2;for(let j=0;j<5;j++)bullets.push({x:PL.x,y:PL.y,vx:Math.cos(a+j*.1)*10,vy:Math.sin(a+j*.1)*10,col:'#44ffff',r:3.5,dm:dm*.8});}},i*35);BAT.pt(x,y,'#44ffff',20,true);},
    // 43: VOID DRAIN
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;enemies.forEach(e=>{let d=Math.min(e.hp-1,Math.floor(e.hp*.6));e.hp-=d;PL.sp=Math.min(PL.msp,PL.sp+d*5);BAT.pt(e.x,e.y,'#8844aa',4);});BAT.pt(x,y,'#8844aa',20,true);BAT.updHud();},
    // 44: PHOENIX RISE
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;PL.iframes=150;PL.hp=Math.min(PL.mhp,PL.hp+20);for(let i=0;i<28;i++){let a=i/28*Math.PI*2;bullets.push({x,y,vx:Math.cos(a)*9.5,vy:Math.sin(a)*9.5,col:'#ff8800',r:5,dm:dm*.9});}BAT.updHud();BAT.pt(x,y,'#ff8800',30,true);},
    // 45: SHOCKWAVE
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<6;i++){let a=i/6*Math.PI*2;for(let r2=1;r2<=4;r2++)bullets.push({x,y,vx:Math.cos(a)*r2*3.5,vy:Math.sin(a)*r2*3.5,col:`hsl(${r2*60},100%,65%)`,r:4,dm:dm*.85});}eBullets=[];BAT.pt(x,y,'rb',25,true);},
    // 46: MIRROR SHOT
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<14;i++){let a=-Math.PI*.5+i/13*Math.PI;bullets.push({x,y,vx:Math.cos(a)*9,vy:Math.sin(a)*9,col:'#ccffff',r:4,dm:dm*.9});bullets.push({x,y,vx:Math.cos(a+Math.PI)*9,vy:Math.sin(a+Math.PI)*9,col:'#ffcccc',r:4,dm:dm*.9});}BAT.pt(x,y,'rb',22,true);},
    // 47: TSUNAMI
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<5;i++)setTimeout(()=>{if(gState!=='idle'){for(let j=0;j<10;j++)bullets.push({x:rnd(0,W),y:PL.y-20+rnd(-10,10),vx:rnd(-2,2),vy:8,col:'#4488ff',r:4,dm:dm*1.1});}},i*50);BAT.pt(x,y,'#4488ff',22,true);},
    // 48: VOLCANO BURST
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<24;i++){let a=i/24*Math.PI*2;bullets.push({x,y,vx:Math.cos(a)*8+rnd(-.5,.5),vy:Math.sin(a)*8+rnd(-.5,.5),col:'#ff4400',r:5,dm:dm*.9});}BAT.bDmg(20);BAT.pt(x,y,'#ff4400',28,true);},
    // 49: BLIZZARD
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;frozenT=200;eBullets=[];for(let i=0;i<20;i++){let a=i/20*Math.PI*2;bullets.push({x,y,vx:Math.cos(a)*7,vy:Math.sin(a)*7,col:'#cceeff',r:4.5,dm:dm*.85});}BAT.pt(x,y,'#cceeff',30,true);},
    // 50: TORNADO
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<4;i++){const ang=i/4*Math.PI*2+frame*.05;for(let j=0;j<8;j++){let a=j/8*Math.PI*2+ang;bullets.push({x,y,vx:Math.cos(a)*8,vy:Math.sin(a)*8,col:`hsl(${i*90+j*10},100%,65%)`,r:3.5,dm:dm*.8});}}BAT.pt(x,y,'rb',30,true);},
    // 51: NIGHTMARE
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;eBullets=[];enemies.forEach(e=>{e.hp-=15;BAT.pt(e.x,e.y,'#440044',8);});enemies=enemies.filter(e=>{if(e.hp<=0){BAT.addScore(400);killedHp+=e.mhp;return false;}return true;});frozenT=80;PL.iframes=60;BAT.pt(x,y,'#440044',30,true);},
    // 52: REQUIEM
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<44;i++){let a=i/44*Math.PI*2+frame*.03;bullets.push({x,y,vx:Math.cos(a)*(8+Math.sin(i*.3)*3),vy:Math.sin(a)*(8+Math.sin(i*.3)*3),col:`hsl(${i*8},90%,65%)`,r:4,dm:dm*.9});}BAT.bDmg(35);eBullets=[];BAT.pt(x,y,'rb',45,true);},
    // 53: CRIMSON NOVA
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<3;i++)setTimeout(()=>{if(gState!=='idle'){for(let j=0;j<14;j++){let a=j/14*Math.PI*2;bullets.push({x:PL.x,y:PL.y,vx:Math.cos(a)*10,vy:Math.sin(a)*10,col:'#ff2244',r:5,dm:dm});}}},i*80);BAT.pt(x,y,'#ff2244',28,true);},
    // 54: GLACIAL LANCE
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<6;i++){let a=-Math.PI/2+rnd(-.2,.2);bullets.push({x:x+rnd(-25,25),y,vx:Math.cos(a)*.5,vy:-16,col:'#44ccff',r:5,dm:dm*1.5});}frozenT=70;BAT.pt(x,y,'#44ccff',20,true);},
    // 55: THUNDER GOD
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;enemies.forEach(e=>{e.hp-=20;BAT.pt(e.x,e.y,'#ffff00',10);});enemies=enemies.filter(e=>{if(e.hp<=0){BAT.addScore(500);killedHp+=e.mhp;return false;}return true;});BAT.bDmg(40);eBullets=[];for(let i=0;i<30;i++){let a=i/30*Math.PI*2;bullets.push({x,y,vx:Math.cos(a)*12,vy:Math.sin(a)*12,col:'#ffff00',r:5,dm:dm});}BAT.pt(x,y,'#ffff00',45,true);},
    // 56: SAKURA STORM
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<32;i++){let a=i/32*Math.PI*2;bullets.push({x,y,vx:Math.cos(a)*7,vy:Math.sin(a)*7,col:`hsl(${300+i*3},100%,70%)`,r:3.5,dm:dm*.8});}BAT.pt(x,y,'#ffaaee',28,true);},
    // 57: DRAGON FANG
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<3;i++){let a=-Math.PI/2+rnd(-.3,.3);bullets.push({x,y,vx:Math.cos(a)*3,vy:-15+i*2,col:'#ff6600',r:7,dm:dm*2.5});}BAT.bDmg(18);BAT.pt(x,y,'#ff6600',22,true);},
    // 58: NEBULA BURST
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<38;i++){let a=i/38*Math.PI*2+frame*.06;bullets.push({x,y,vx:Math.cos(a)*9.5,vy:Math.sin(a)*9.5,col:`hsl(${i*9},100%,65%)`,r:4,dm:dm*.85});}BAT.pt(x,y,'rb',35,true);},
    // 59: STARFALL
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<25;i++)setTimeout(()=>{if(gState!=='idle')bullets.push({x:rnd(30,W-30),y:-10,vx:rnd(-.5,.5),vy:9+rnd(0,3),col:'#ffffaa',r:4,dm:dm*1.2})},i*45);BAT.pt(x,y,'#ffffaa',22,true);},
    // 60: ECLIPSE BEAM
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<4;i++){let off=(i-1.5)*18;bullets.push({x:x+off,y,vx:off*.05,vy:-17,col:'#334466',r:4,dm:dm*1.8});}BAT.bDmg(22);BAT.pt(x,y,'#334466',20,true);PL.iframes=25;},
    // 61: SHATTER RING
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<20;i++){let a=i/20*Math.PI*2;bullets.push({x,y,vx:Math.cos(a)*9,vy:Math.sin(a)*9,col:'#ccaaff',r:5,dm:dm*.9});bullets.push({x,y,vx:Math.cos(a+.15)*6,vy:Math.sin(a+.15)*6,col:'#ff88cc',r:3,dm:dm*.6});}BAT.pt(x,y,'rb',28,true);},
    // 62: SOUL DRAIN
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;enemies.forEach(e=>{let d=Math.min(e.hp-1,e.mhp*.5|0);e.hp-=d;PL.hp=Math.min(PL.mhp,PL.hp+d*8);BAT.pt(e.x,e.y,'#8800aa',4);});BAT.updHud();BAT.pt(x,y,'#8800aa',22,true);},
    // 63: COSMIC RAY
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<10;i++)setTimeout(()=>{if(gState!=='idle'){let a=rnd(-Math.PI*.3,.3)-Math.PI/2;bullets.push({x:PL.x+rnd(-30,30),y:PL.y,vx:Math.cos(a)*12,vy:Math.sin(a)*12,col:'#aaffff',r:3.5,dm:dm*1.3});}},i*30);BAT.pt(x,y,'#aaffff',18,true);},
    // 64: LAVA SURGE
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<18;i++){let a=i/18*Math.PI*2;bullets.push({x,y,vx:Math.cos(a)*8,vy:Math.sin(a)*8,col:'#ff5500',r:5,dm:dm*.95});}enemies.forEach(e=>{e.hp-=9;BAT.pt(e.x,e.y,'#ff5500',4);});enemies=enemies.filter(e=>{if(e.hp<=0){BAT.addScore(250);killedHp+=e.mhp;return false;}return true;});BAT.pt(x,y,'#ff5500',24,true);},
    // 65: GALE FORCE
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<9;i++){let a=-Math.PI*.6+i/8*Math.PI*1.2;bullets.push({x,y,vx:Math.cos(a)*14,vy:Math.sin(a)*14,col:'#aaffaa',r:3,dm:dm*1.0});}PL.iframes=50;BAT.pt(x,y,'#aaffaa',18,true);},
    // 66: TIDAL WAVE
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<5;i++)setTimeout(()=>{if(gState!=='idle'){for(let j=0;j<12;j++){let a=j/12*Math.PI*2;bullets.push({x:PL.x,y:PL.y,vx:Math.cos(a)*8,vy:Math.sin(a)*8,col:'#4488ff',r:4,dm:dm*.85});}}},i*55);BAT.pt(x,y,'#4488ff',22,true);},
    // 67: ACID RAIN
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<20;i++){let a=rnd(0,Math.PI*2);bullets.push({x,y,vx:Math.cos(a)*7,vy:Math.sin(a)*7,col:'#88ff44',r:4,dm:dm*.9});}enemies.forEach(e=>{e.hp-=7;e.vy*=.5;BAT.pt(e.x,e.y,'#88ff44',3);});enemies=enemies.filter(e=>{if(e.hp<=0){BAT.addScore(220);killedHp+=e.mhp;return false;}return true;});BAT.pt(x,y,'#88ff44',20,true);},
    // 68: WARP STRIKE
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;PL.x=W/2;PL.y=H*.35;PL.vx=0;PL.vy=0;for(let i=0;i<30;i++){let a=i/30*Math.PI*2;bullets.push({x:PL.x,y:PL.y,vx:Math.cos(a)*10,vy:Math.sin(a)*10,col:rbC(frame+i*10),r:4,dm:dm*1.1});}PL.iframes=60;BAT.pt(PL.x,PL.y,'rb',30,true);},
    // 69: QUASAR BLAST
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<48;i++){let a=i/48*Math.PI*2+frame*.03;bullets.push({x,y,vx:Math.cos(a)*(9+i*.06),vy:Math.sin(a)*(9+i*.06),col:`hsl(${i*7.5},100%,65%)`,r:4,dm:dm*.85});}BAT.bDmg(38);eBullets=[];PL.iframes=30;BAT.pt(x,y,'rb',50,true);},
    // 70: RUNE BURST
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<16;i++){let a=i/16*Math.PI*2;for(let r2=0;r2<2;r2++)bullets.push({x,y,vx:Math.cos(a+r2*.2)*(7+r2*2.5),vy:Math.sin(a+r2*.2)*(7+r2*2.5),col:`hsl(${i*22+r2*90},100%,65%)`,r:4,dm:dm*.85});}BAT.pt(x,y,'rb',26,true);},
    // 71: ANGEL WING
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;PL.iframes=120;for(let i=0;i<32;i++){let a=-Math.PI*.8+i/31*Math.PI*1.6;bullets.push({x,y,vx:Math.cos(a)*10,vy:Math.sin(a)*10,col:'#ffffff',r:4,dm:dm*1.0});}PL.hp=Math.min(PL.mhp,PL.hp+15);BAT.updHud();BAT.pt(x,y,'#ffffff',28,true);},
    // 72: DEMON CLAW
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<22;i++){let a=i/22*Math.PI*2+frame*.04;bullets.push({x,y,vx:Math.cos(a)*10.5,vy:Math.sin(a)*10.5,col:'#cc2244',r:5.5,dm:dm*1.1});}enemies.forEach(e=>{e.hp-=11;BAT.pt(e.x,e.y,'#cc2244',4);});enemies=enemies.filter(e=>{if(e.hp<=0){BAT.addScore(350);killedHp+=e.mhp;return false;}return true;});BAT.pt(x,y,'#cc2244',28,true);},
    // 73: ABYSS CALL
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;frozenT=100;eBullets=[];enemies.forEach(e=>{e.hp-=13;BAT.pt(e.x,e.y,'#220033',6);});enemies=enemies.filter(e=>{if(e.hp<=0){BAT.addScore(350);killedHp+=e.mhp;return false;}return true;});for(let i=0;i<26;i++){let a=i/26*Math.PI*2;bullets.push({x,y,vx:Math.cos(a)*9,vy:Math.sin(a)*9,col:'#440066',r:5,dm:dm});}BAT.pt(x,y,'#440066',30,true);},
    // 74: SUPERNOVA
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<50;i++){let a=i/50*Math.PI*2+frame*.025;bullets.push({x,y,vx:Math.cos(a)*(9+i*.04),vy:Math.sin(a)*(9+i*.04),col:`hsl(${i*7.2},100%,65%)`,r:4,dm:dm*.9});}enemies.forEach(e=>{e.hp=0;BAT.pt(e.x,e.y,'rb',10);});enemies=[];BAT.bDmg(60);eBullets=[];PL.iframes=80;BAT.pt(x,y,'rb',60,true);},
    // 75: ION CANNON
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<3;i++){let off=(i-1)*30;for(let j=0;j<5;j++)bullets.push({x:x+off,y:y-j*15,vx:off*.04,vy:-16,col:'#88ccff',r:4,dm:dm*1.1});}BAT.pt(x,y,'#88ccff',20,true);},
    // 76: MACH STRIKE
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<7;i++){let a=-Math.PI/2+rnd(-.4,.4);bullets.push({x:x+rnd(-20,20),y,vx:Math.cos(a)*16,vy:Math.sin(a)*16,col:'#ffccaa',r:3,dm:dm*1.2});}PL.iframes=25;BAT.pt(x,y,'#ffccaa',16,true);},
    // 77: ZERO GRAVITY
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;enemies.forEach(e=>{e.vy=-Math.abs(e.vy)*3;e.vx*=3;BAT.pt(e.x,e.y,'#8844ff',4);});frozenT=60;for(let i=0;i<20;i++){let a=i/20*Math.PI*2;bullets.push({x,y,vx:Math.cos(a)*8,vy:Math.sin(a)*8,col:'#8844ff',r:4.5,dm:dm*.9});}BAT.pt(x,y,'#8844ff',24,true);},
    // 78: PRISM SHOT
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<18;i++){let a=i/18*Math.PI*2;const cols=['#ff4488','#44ffcc','#ffcc44','#4488ff'];bullets.push({x,y,vx:Math.cos(a)*9,vy:Math.sin(a)*9,col:cols[i%4],r:4,dm:dm*.9});bullets.push({x,y,vx:Math.cos(a+Math.PI)*5,vy:Math.sin(a+Math.PI)*5,col:cols[(i+2)%4],r:3,dm:dm*.65});}BAT.pt(x,y,'rb',25,true);},
    // 79: CRIMSON BLADE
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<5;i++){let a=-Math.PI/2+rnd(-.25,.25);bullets.push({x:x-20+i*10,y,vx:Math.cos(a)*15,vy:Math.sin(a)*15,col:'#cc2233',r:4,dm:dm*1.4});}enemies.forEach(e=>{e.hp-=8;BAT.pt(e.x,e.y,'#cc2233',3);});enemies=enemies.filter(e=>{if(e.hp<=0){BAT.addScore(200);killedHp+=e.mhp;return false;}return true;});BAT.pt(x,y,'#cc2233',18,true);},
    // 80: MOONFALL
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<25;i++)setTimeout(()=>{if(gState!=='idle'){let a=rnd(0,Math.PI*2);bullets.push({x:rnd(20,W-20),y:rnd(0,H*.4),vx:Math.cos(a)*7,vy:Math.sin(a)*7+4,col:'#aaaaff',r:4,dm:dm*1.1});}},i*40);BAT.pt(x,y,'#aaaaff',20,true);},
    // 81: SUNBURST
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<32;i++){let a=i/32*Math.PI*2;bullets.push({x,y,vx:Math.cos(a)*9,vy:Math.sin(a)*9,col:'#ffdd44',r:5,dm:dm*.9});}BAT.bDmg(28);enemies.forEach(e=>{e.hp-=8;BAT.pt(e.x,e.y,'#ffdd44',4);});enemies=enemies.filter(e=>{if(e.hp<=0){BAT.addScore(250);killedHp+=e.mhp;return false;}return true;});BAT.pt(x,y,'#ffdd44',30,true);},
    // 82: VOID STORM
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;frozenT=120;eBullets=[];for(let i=0;i<40;i++){let a=i/40*Math.PI*2+frame*.04;bullets.push({x,y,vx:Math.cos(a)*(8+Math.random()*4),vy:Math.sin(a)*(8+Math.random()*4),col:`hsl(${i*9},90%,60%)`,r:4,dm:dm*.9});}BAT.bDmg(30);BAT.pt(x,y,'rb',40,true);PL.iframes=50;},
    // 83: CRYSTAL CAGE
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;frozenT=150;for(let i=0;i<24;i++){let a=i/24*Math.PI*2;bullets.push({x,y,vx:Math.cos(a)*8.5,vy:Math.sin(a)*8.5,col:'#88eeff',r:4.5,dm:dm*.85});}enemies.forEach(e=>{e.vy=0;e.vx=0;});BAT.pt(x,y,'#88eeff',28,true);},
    // 84: PLASMA STORM
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<4;i++)setTimeout(()=>{if(gState!=='idle'){for(let j=0;j<16;j++){let a=j/16*Math.PI*2+i*.2;bullets.push({x:PL.x,y:PL.y,vx:Math.cos(a)*9,vy:Math.sin(a)*9,col:`hsl(${i*90+j*20},100%,65%)`,r:4,dm:dm*.9});}}},i*70);BAT.pt(x,y,'rb',30,true);},
    // 85: GRAVITY BOMB
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;enemies.forEach(e=>{let dx=x-e.x,dy=y-e.y,d=Math.sqrt(dx*dx+dy*dy)||1;e.x+=dx/d*60;e.y+=dy/d*60;e.hp-=14;BAT.pt(e.x,e.y,'#8844ff',6);});enemies=enemies.filter(e=>{if(e.hp<=0){BAT.addScore(400);killedHp+=e.mhp;return false;}return true;});for(let i=0;i<22;i++){let a=i/22*Math.PI*2;bullets.push({x,y,vx:Math.cos(a)*9,vy:Math.sin(a)*9,col:'#8844ff',r:5,dm:dm});}BAT.pt(x,y,'#8844ff',28,true);},
    // 86: THUNDER RAIN
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<7;i++)setTimeout(()=>{if(gState!=='idle'){for(let j=0;j<8;j++){let a=j/8*Math.PI*2;bullets.push({x:PL.x,y:PL.y,vx:Math.cos(a)*8,vy:Math.sin(a)*8,col:'#ffff44',r:4,dm:dm*.85});}}},i*45);BAT.pt(x,y,'#ffff44',22,true);},
    // 87: FROZEN STAR
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;frozenT=180;eBullets=[];enemies.forEach(e=>{e.hp-=11;BAT.pt(e.x,e.y,'#aaeeff',5);});enemies=enemies.filter(e=>{if(e.hp<=0){BAT.addScore(300);killedHp+=e.mhp;return false;}return true;});for(let i=0;i<26;i++){let a=i/26*Math.PI*2;bullets.push({x,y,vx:Math.cos(a)*8.5,vy:Math.sin(a)*8.5,col:'#aaeeff',r:4,dm:dm*.9});}BAT.pt(x,y,'#aaeeff',32,true);},
    // 88: INFERNO
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<56;i++){let a=i/56*Math.PI*2+frame*.03;bullets.push({x,y,vx:Math.cos(a)*(8+i*.03),vy:Math.sin(a)*(8+i*.03),col:`hsl(${i*6.4},100%,65%)`,r:4,dm:dm*.85});}enemies.forEach(e=>{e.hp-=18;BAT.pt(e.x,e.y,'rb',8);});enemies=enemies.filter(e=>{if(e.hp<=0){BAT.addScore(500);killedHp+=e.mhp;return false;}return true;});BAT.bDmg(42);eBullets=[];PL.iframes=70;BAT.pt(x,y,'rb',55,true);},
    // 89: SHADOW STORM
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<28;i++){let a=i/28*Math.PI*2+frame*.05;bullets.push({x,y,vx:Math.cos(a)*10,vy:Math.sin(a)*10,col:'#334455',r:5,dm:dm*1.0});}frozenT=90;enemies.forEach(e=>{e.hp-=12;BAT.pt(e.x,e.y,'#334455',4);});enemies=enemies.filter(e=>{if(e.hp<=0){BAT.addScore(320);killedHp+=e.mhp;return false;}return true;});BAT.pt(x,y,'#334455',26,true);},
    // 90: CELESTIAL BEAM
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<5;i++)setTimeout(()=>{if(gState!=='idle'){for(let j=0;j<20;j++){let a=j/20*Math.PI*2+i*.12;bullets.push({x:PL.x,y:PL.y,vx:Math.cos(a)*(9+i),vy:Math.sin(a)*(9+i),col:`hsl(${i*72+j*18},100%,65%)`,r:4,dm:dm*.9});}}},i*80);BAT.bDmg(50);eBullets=[];PL.iframes=60;BAT.pt(x,y,'rb',45,true);},
    // 91: NANO BURST
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<60;i++){let a=rnd(0,Math.PI*2);bullets.push({x,y,vx:Math.cos(a)*rnd(2,12),vy:Math.sin(a)*rnd(2,12),col:`hsl(${rnd(0,360)},100%,65%)`,r:rnd(1.5,4),dm:dm*rnd(.5,1.3)});}BAT.pt(x,y,'rb',40,true);},
    // 92: KINETIC BLAST
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<10;i++){let a=-Math.PI/2+rnd(-.5,.5);bullets.push({x:x+rnd(-40,40),y,vx:Math.cos(a)*rnd(8,15),vy:Math.sin(a)*rnd(8,15),col:'#44ccff',r:3.5,dm:dm*1.3});}PL.iframes=40;BAT.pt(x,y,'#44ccff',20,true);},
    // 93: SPECTRAL WAVE
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<6;i++){let f=i/5;for(let j=0;j<12;j++){let a=j/12*Math.PI*2+f*.3;bullets.push({x,y,vx:Math.cos(a)*(5+f*5),vy:Math.sin(a)*(5+f*5),col:`hsl(${f*180+j*30},100%,65%)`,r:3+f*1.5,dm:dm*(.7+f*.4)});}}BAT.pt(x,y,'rb',35,true);},
    // 94: RESONANCE
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<8;i++)setTimeout(()=>{if(gState!=='idle'){let a=i/8*Math.PI*2+frame*.06;for(let j=0;j<6;j++){let a2=a+j/6*Math.PI*2;bullets.push({x:PL.x,y:PL.y,vx:Math.cos(a2)*9,vy:Math.sin(a2)*9,col:`hsl(${i*45+j*60},100%,65%)`,r:4,dm:dm*.9});}}},i*55);BAT.pt(x,y,'rb',35,true);},
    // 95: QUANTUM BURST
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<52;i++){let a=i/52*Math.PI*2+frame*.04;bullets.push({x,y,vx:Math.cos(a)*(8+i*.04),vy:Math.sin(a)*(8+i*.04),col:`hsl(${i*6.9},100%,65%)`,r:4.5,dm:dm*.9});}BAT.bDmg(45);eBullets=[];enemies.forEach(e=>{e.hp-=16;BAT.pt(e.x,e.y,'rb',6);});enemies=enemies.filter(e=>{if(e.hp<=0){BAT.addScore(500);killedHp+=e.mhp;return false;}return true;});PL.iframes=80;BAT.pt(x,y,'rb',55,true);},
    // 96: ULTIMA BEAM
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<6;i++)setTimeout(()=>{if(gState!=='idle'){for(let j=0;j<24;j++){let a=j/24*Math.PI*2+i*.15+frame*.05;bullets.push({x:PL.x,y:PL.y,vx:Math.cos(a)*(9+i),vy:Math.sin(a)*(9+i),col:`hsl(${i*60+j*15},100%,65%)`,r:4.5,dm:dm*.95});}}},i*90);BAT.bDmg(55);eBullets=[];PL.iframes=90;BAT.pt(x,y,'rb',60,true);},
    // 97: GENESIS NOVA
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;enemies.forEach(e=>{e.hp=0;BAT.pt(e.x,e.y,'rb',12);});enemies=[];killedHp+=1000;frozenT=80;for(let i=0;i<42;i++){let a=i/42*Math.PI*2+frame*.03;bullets.push({x,y,vx:Math.cos(a)*11,vy:Math.sin(a)*11,col:`hsl(${i*8.6},100%,65%)`,r:5,dm:dm});}BAT.bDmg(50);eBullets=[];PL.iframes=60;BAT.pt(x,y,'rb',65,true);},
    // 98: OMEGA STORM
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;for(let i=0;i<7;i++)setTimeout(()=>{if(gState!=='idle'){frozenT=30;for(let j=0;j<22;j++){let a=j/22*Math.PI*2+i*.18+frame*.04;bullets.push({x:PL.x,y:PL.y,vx:Math.cos(a)*(10+i),vy:Math.sin(a)*(10+i),col:`hsl(${i*51+j*16},100%,65%)`,r:5,dm:dm});}if(i===6){eBullets=[];BAT.bDmg(60);}}},i*100);PL.iframes=80;BAT.pt(x,y,'rb',60,true);},
    // 99: TRUE APOCALYPSE
    function(){let x=PL.x,y=PL.y,c=CH.col,dm=cDmg;enemies.forEach(e=>{e.hp=0;BAT.pt(e.x,e.y,'rb',14);});enemies=[];killedHp+=2000;frozenT=200;eBullets=[];PL.iframes=120;PL.hp=PL.mhp;for(let i=0;i<60;i++){let a=i/60*Math.PI*2+frame*.025;bullets.push({x,y,vx:Math.cos(a)*(10+i*.06),vy:Math.sin(a)*(10+i*.06),col:`hsl(${i*6},100%,68%)`,r:5,dm:dm*1.1});}BAT.bDmg(80);BAT.updHud();BAT.pt(x,y,'rb',80,true);},

    // ‚îÄ‚îÄ‚îÄ NEW SP 100-199 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    ()=>{// 100 HYPER CANNON: Â∑®Â§ß1Áô∫+Ë°ùÊíÉÊ≥¢
      bullets.push({x:PL.x,y:PL.y,vx:0,vy:-24,col:CH.col,r:9,dm:20*cDmg});
      for(let i=0;i<12;i++){const a=i/12*Math.PI*2;bullets.push({x:PL.x,y:PL.y,vx:Math.cos(a)*8,vy:Math.sin(a)*8,col:CH.col,r:4,dm:5*cDmg});}
      BAT.pt(PL.x,PL.y,CH.col,30,true);},
    ()=>{// 101 TWIN LANCER: Â∑¶Âè≥2Êú¨„É©„É≥„Çπ
      for(let s=-1;s<=1;s+=2) for(let i=0;i<5;i++) bullets.push({x:PL.x+s*15,y:PL.y-i*12,vx:s*.3,vy:-20,col:CH.col,r:4,dm:8*cDmg});
      BAT.pt(PL.x,PL.y,CH.col,20,true);},
    ()=>{// 102 LASER CROSS: ‰∏ä+Â∑¶Âè≥3ÊñπÂêë„É¨„Éº„Ç∂„Éº
      for(let i=0;i<18;i++){bullets.push({x:PL.x,y:PL.y-i*18,vx:0,vy:-28,col:CH.col,r:3,dm:6*cDmg});}
      for(let i=0;i<10;i++) for(let s=-1;s<=1;s+=2) bullets.push({x:PL.x+s*i*18,y:PL.y,vx:s*22,vy:0,col:CH.col,r:3,dm:5*cDmg});
      BAT.pt(PL.x,PL.y,CH.col,25,true);},
    ()=>{// 103 BLADE RAIN: ‰∏ä„Åã„ÇâÈõ®„ÅÆ„Çà„ÅÜ„Å´Á¥∞„Åã„ÅÑÂºæ
      for(let i=0;i<24;i++) bullets.push({x:rnd(20,W-20),y:rnd(-60,-10),vx:0,vy:rnd(12,18),col:CH.col,r:3,dm:7*cDmg});
      BAT.pt(PL.x,PL.y,CH.col,20,true);},
    ()=>{// 104 DEATH SPIRAL: Ëû∫ÊóãÁä∂30Áô∫
      for(let i=0;i<30;i++){const a=i/30*Math.PI*6;const r2=i*2.5;bullets.push({x:PL.x+Math.cos(a)*r2,y:PL.y+Math.sin(a)*r2,vx:Math.cos(a)*9,vy:Math.sin(a)*9-8,col:CH.col,r:3.5,dm:6*cDmg});}
      BAT.pt(PL.x,PL.y,'rb',28,true);},
    ()=>{// 105 PLASMA NET: ÂâçÊñπ„Ç∞„É™„ÉÉ„ÉâÁä∂8x3
      for(let row=0;row<3;row++) for(let col2=0;col2<8;col2++) bullets.push({x:PL.x-56+col2*16,y:PL.y-row*20,vx:0,vy:-15,col:CH.col,r:3,dm:5*cDmg});
      BAT.pt(PL.x,PL.y,CH.col,22,true);},
    ()=>{// 106 VOID ARROW: Ê•µÂ§™5Áô∫ÂâçÊñπÈõÜ‰∏≠
      for(let i=-2;i<=2;i++) bullets.push({x:PL.x+i*8,y:PL.y,vx:i*.2,vy:-22,col:CH.col,r:5+Math.abs(i),dm:(9-Math.abs(i)*2)*cDmg});
      BAT.pt(PL.x,PL.y,CH.col,18,true);},
    ()=>{// 107 AQUA BLAST: ÊâáÁä∂12Áô∫‰ΩéÈÄüÂ§ßÁéâ
      for(let i=0;i<12;i++){const a=-Math.PI*.55+i/11*Math.PI*1.1;bullets.push({x:PL.x,y:PL.y,vx:Math.cos(a)*10,vy:Math.sin(a)*10,col:CH.col,r:6,dm:8*cDmg});}
      BAT.pt(PL.x,PL.y,CH.col,24,true);},
    ()=>{// 108 TERRA BREAK: Âú∞ÈúáÊ≥¢(Â∑¶Âè≥ÊîæÂ∞Ñ)
      for(let i=0;i<16;i++) for(let s=-1;s<=1;s+=2) bullets.push({x:PL.x+s*i*10,y:PL.y+rnd(-20,20),vx:s*(14+i*.3),vy:rnd(-2,2),col:CH.col,r:4,dm:5*cDmg});
      BAT.pt(PL.x,PL.y,CH.col,24,true);},
    ()=>{// 109 AERO SLASH: Á´úÂ∑ªÁä∂„É©„É≥„ÉÄ„É†Êã°Êï£
      for(let i=0;i<20;i++){const a=rnd(0,Math.PI*2);const sp=rnd(8,16);bullets.push({x:PL.x+rnd(-30,30),y:PL.y+rnd(-30,30),vx:Math.cos(a)*sp,vy:Math.sin(a)*sp-6,col:CH.col,r:3,dm:6*cDmg});}
      BAT.pt(PL.x,PL.y,CH.col,24,true);},
    ()=>{// 110 PHOTON STORM: È´òÈÄü8ÊñπÂêë2„Çª„ÉÉ„Éà
      for(let set=0;set<2;set++) for(let i=0;i<8;i++){const a=i/8*Math.PI*2+set*.2;bullets.push({x:PL.x,y:PL.y,vx:Math.cos(a)*14,vy:Math.sin(a)*14,col:CH.col,r:4,dm:7*cDmg});}
      BAT.pt(PL.x,PL.y,CH.col,22,true);},
    ()=>{// 111 DARK RAIN: ÂÖ®ÁîªÈù¢‰∏ä„Åã„ÇâÈôç„ÇäÊ≥®„Åê
      for(let i=0;i<30;i++){setTimeout(()=>{if(gState==='battle')bullets.push({x:rnd(10,W-10),y:-20,vx:rnd(-1,1),vy:rnd(10,18),col:CH.col,r:4,dm:7*cDmg});},i*60);}
      BAT.pt(PL.x,PL.y,CH.col,18,true);},
    ()=>{// 112 HOLY FIRE: ÂçÅÂ≠ó+Êñú„ÇÅÂêàË®à8ÊñπÂêë
      for(let i=0;i<8;i++){const a=i/8*Math.PI*2;bullets.push({x:PL.x,y:PL.y,vx:Math.cos(a)*12,vy:Math.sin(a)*12,col:'#ffffff',r:5,dm:9*cDmg});}
      BAT.pt(PL.x,PL.y,'#ffffff',26,true);},
    ()=>{// 113 CHAOS WHIRL: „É©„É≥„ÉÄ„É†‰ΩçÁΩÆ„Åã„ÇâÁô∫Áîü
      for(let i=0;i<16;i++){const a=rnd(0,Math.PI*2);bullets.push({x:rnd(40,W-40),y:rnd(100,H-100),vx:Math.cos(a)*10,vy:Math.sin(a)*10-4,col:CH.col,r:4,dm:7*cDmg});}
      BAT.pt(PL.x,PL.y,'rb',24,true);},
    ()=>{// 114 OMEGA PULSE: ÂêåÂøÉÂÜÜ3ÈáçÁàÜÁô∫
      for(let ring=1;ring<=3;ring++) for(let i=0;i<ring*6;i++){const a=i/(ring*6)*Math.PI*2;const sp=ring*5;bullets.push({x:PL.x,y:PL.y,vx:Math.cos(a)*sp,vy:Math.sin(a)*sp,col:CH.col,r:5-ring,dm:(7-ring)*cDmg});}
      BAT.pt(PL.x,PL.y,'rb',30,true);},
    ()=>{// 115 NEON RAIN: ËôπËâ≤È´òÈÄüÁ∏¶Â∞Ñ
      for(let i=0;i<20;i++){const col2=['#ff00ff','#00ffff','#ffff00','#ff0088','#00ff88'][i%5];bullets.push({x:PL.x+rnd(-60,60),y:PL.y,vx:rnd(-.5,.5),vy:-rnd(18,26),col:col2,r:3,dm:7*cDmg});}
      BAT.pt(PL.x,PL.y,'rb',20,true);},
    ()=>{// 116 CRYSTAL LANCE: ÂâçÊñπ5Êú¨ÂØÜÈõÜË≤´ÈÄöÂºæ
      for(let i=-2;i<=2;i++) for(let j=0;j<8;j++) bullets.push({x:PL.x+i*10,y:PL.y-j*15,vx:0,vy:-26,col:'#88ddff',r:3.5,dm:5*cDmg});
      BAT.pt(PL.x,PL.y,'#88ddff',22,true);},
    ()=>{// 117 VOLT SURGE: Á®≤Â¶ªÁä∂„Ç∏„Ç∞„Ç∂„Ç∞
      let bx=PL.x,by=PL.y;
      for(let i=0;i<12;i++){const nx=bx+rnd(-40,40),ny=by-rnd(30,60);bullets.push({x:bx,y:by,vx:(nx-bx)/5,vy:(ny-by)/5,col:'#ffff44',r:4,dm:6*cDmg});bx=nx;by=ny;}
      BAT.pt(PL.x,PL.y,'#ffff44',20,true);},
    ()=>{// 118 FROST NOVA: Ê∞∑„ÅÆÁµêÊô∂Áä∂8ÊñπÂêë+Êñú„ÇÅÂæÆÈáè
      for(let i=0;i<16;i++){const a=i/16*Math.PI*2;bullets.push({x:PL.x,y:PL.y,vx:Math.cos(a)*10,vy:Math.sin(a)*10,col:'#88eeFF',r:4,dm:6*cDmg});}
      enemies.forEach(e=>{e.hp=Math.max(1,e.hp-3);BAT.pt(e.x,e.y,'#88eeff',4);});
      BAT.pt(PL.x,PL.y,'#88eeff',22,true);},
    ()=>{// 119 SHADOW NET: ÊöóÈªí„ÅÆÁ∂≤(„É©„É≥„ÉÄ„É†ÂØÜÈõÜ)
      for(let i=0;i<25;i++) bullets.push({x:rnd(20,W-20),y:PL.y+rnd(-40,40),vx:rnd(-3,3),vy:-rnd(8,14),col:'#660088',r:4,dm:7*cDmg});
      BAT.pt(PL.x,PL.y,'#aa44ff',24,true);},
    // 120-139: „Éê„É™„Ç®„Éº„Ç∑„Éß„É≥
    ()=>{for(let i=0;i<14;i++){const a=-Math.PI/2+i/13*Math.PI;bullets.push({x:PL.x,y:PL.y,vx:Math.cos(a)*13,vy:Math.sin(a)*13,col:CH.col,r:4,dm:7*cDmg});}BAT.pt(PL.x,PL.y,CH.col,22,true);},
    ()=>{for(let i=0;i<5;i++){setTimeout(()=>{for(let j=0;j<6;j++){const a=j/6*Math.PI*2;if(gState==='battle')bullets.push({x:PL.x,y:PL.y,vx:Math.cos(a)*11,vy:Math.sin(a)*11,col:CH.col,r:4,dm:6*cDmg});}},i*120);}BAT.pt(PL.x,PL.y,CH.col,18,true);},
    ()=>{for(let i=0;i<20;i++){const a=i/20*Math.PI*4;bullets.push({x:PL.x+Math.cos(a)*20,y:PL.y+Math.sin(a)*20,vx:Math.cos(a)*9,vy:Math.sin(a)*9,col:CH.col,r:3.5,dm:6*cDmg});}BAT.pt(PL.x,PL.y,'rb',22,true);},
    ()=>{for(let i=0;i<8;i++) for(let j=0;j<3;j++){const a=i/8*Math.PI*2;bullets.push({x:PL.x,y:PL.y,vx:Math.cos(a)*(8+j*3),vy:Math.sin(a)*(8+j*3),col:CH.col,r:3,dm:5*cDmg});}BAT.pt(PL.x,PL.y,CH.col,24,true);},
    ()=>{for(let i=0;i<12;i++) bullets.push({x:PL.x+rnd(-80,80),y:-20,vx:rnd(-2,2),vy:rnd(14,20),col:CH.col,r:5,dm:9*cDmg});BAT.pt(PL.x,PL.y,CH.col,20,true);},
    ()=>{const cols=['#ff0000','#ff7700','#ffff00','#00ff00','#00ffff','#0000ff','#ff00ff'];for(let i=0;i<7;i++) for(let j=-1;j<=1;j++) bullets.push({x:PL.x+i*10-35,y:PL.y,vx:j*.5,vy:-15,col:cols[i],r:4,dm:7*cDmg});BAT.pt(PL.x,PL.y,'rb',24,true);},
    ()=>{bullets.push({x:PL.x,y:PL.y,vx:0,vy:-32,col:CH.col,r:12,dm:30*cDmg});BAT.pt(PL.x,PL.y,CH.col,32,true);},
    ()=>{for(let i=0;i<10;i++){const a=rnd(-Math.PI*.6,-Math.PI*.4);bullets.push({x:PL.x+rnd(-50,50),y:PL.y,vx:Math.cos(a)*rnd(8,16),vy:Math.sin(a)*rnd(8,16),col:CH.col,r:4,dm:7*cDmg});}BAT.pt(PL.x,PL.y,CH.col,20,true);},
    ()=>{for(let i=0;i<24;i++){const a=i/24*Math.PI*2+frame*.1;bullets.push({x:PL.x,y:PL.y,vx:Math.cos(a)*10,vy:Math.sin(a)*10,col:CH.col,r:3.5,dm:6*cDmg});}BAT.pt(PL.x,PL.y,'rb',26,true);},
    ()=>{for(let i=0;i<6;i++) for(let j=-1;j<=1;j++) bullets.push({x:PL.x,y:PL.y,vx:j*i*.8,vy:-12-i*2,col:CH.col,r:4,dm:6*cDmg});BAT.pt(PL.x,PL.y,CH.col,20,true);},
    // 140-159
    ()=>{enemies.forEach(e=>{BAT.addKill(e.x,e.y,e.col,e.mhp);});enemies=[];BAT.pt(PL.x,PL.y,'rb',32,true);},
    ()=>{for(let i=0;i<18;i++){const a=-Math.PI/2+rnd(-.8,.8);bullets.push({x:PL.x+rnd(-20,20),y:PL.y,vx:Math.cos(a)*rnd(10,18),vy:Math.sin(a)*rnd(10,18),col:CH.col,r:3.5,dm:7*cDmg});}BAT.pt(PL.x,PL.y,CH.col,20,true);},
    ()=>{for(let i=0;i<3;i++) for(let j=0;j<8;j++){const a=j/8*Math.PI*2+i*.4;bullets.push({x:PL.x,y:PL.y,vx:Math.cos(a)*(7+i*3),vy:Math.sin(a)*(7+i*3),col:CH.col,r:3+i,dm:(5+i*2)*cDmg});}BAT.pt(PL.x,PL.y,'rb',26,true);},
    ()=>{for(let i=0;i<20;i++){const a=-Math.PI/2+Math.sin(i*.5)*.8;bullets.push({x:PL.x+i*3-30,y:PL.y,vx:Math.cos(a)*12,vy:Math.sin(a)*12,col:CH.col,r:3.5,dm:6*cDmg});}BAT.pt(PL.x,PL.y,CH.col,22,true);},
    ()=>{PL.iframes=200;for(let i=0;i<20;i++){const a=i/20*Math.PI*2;bullets.push({x:PL.x+Math.cos(a)*60,y:PL.y+Math.sin(a)*60,vx:Math.cos(a)*11,vy:Math.sin(a)*11,col:CH.col,r:5,dm:8*cDmg});}BAT.pt(PL.x,PL.y,CH.col,26,true);},
    ()=>{for(let wave=0;wave<3;wave++){setTimeout(()=>{for(let i=0;i<8;i++){const a=i/8*Math.PI*2;if(gState==='battle')bullets.push({x:PL.x,y:PL.y,vx:Math.cos(a)*10,vy:Math.sin(a)*10,col:CH.col,r:4,dm:7*cDmg});}},wave*200);}BAT.pt(PL.x,PL.y,CH.col,20,true);},
    ()=>{for(let i=0;i<15;i++){const a=rnd(0,Math.PI*2);bullets.push({x:PL.x+Math.cos(a)*rnd(10,50),y:PL.y+Math.sin(a)*rnd(10,50),vx:Math.cos(a)*9,vy:Math.sin(a)*9-4,col:CH.col,r:4,dm:6*cDmg});}BAT.pt(PL.x,PL.y,'rb',22,true);},
    ()=>{for(let i=0;i<36;i++){const a=i/36*Math.PI*2;const r2=40+Math.sin(i*.8)*15;bullets.push({x:PL.x+Math.cos(a)*r2,y:PL.y+Math.sin(a)*r2,vx:Math.cos(a)*8,vy:Math.sin(a)*8,col:CH.col,r:3,dm:5*cDmg});}BAT.pt(PL.x,PL.y,'rb',28,true);},
    ()=>{for(let i=0;i<5;i++){setTimeout(()=>{if(gState==='battle'){const a=Math.atan2(enemies[0]?enemies[0].y-PL.y:PL.y,enemies[0]?enemies[0].x-PL.x:0)||(-Math.PI/2);for(let j=-2;j<=2;j++) bullets.push({x:PL.x,y:PL.y,vx:Math.cos(a+j*.15)*15,vy:Math.sin(a+j*.15)*15,col:CH.col,r:4,dm:8*cDmg});}},i*90);}BAT.pt(PL.x,PL.y,CH.col,18,true);},
    ()=>{for(let i=0;i<10;i++){const col2='hsl('+(i*36)+',100%,65%)';for(let j=-1;j<=1;j++) bullets.push({x:PL.x+j*20,y:PL.y-i*10,vx:j*.3,vy:-14-i*.5,col:col2,r:3.5,dm:5*cDmg});}BAT.pt(PL.x,PL.y,'rb',22,true);},
    // 160-179
    ()=>{for(let i=0;i<8;i++){const a=i/8*Math.PI*2;for(let j=1;j<=3;j++) bullets.push({x:PL.x,y:PL.y,vx:Math.cos(a)*j*4.5,vy:Math.sin(a)*j*4.5,col:CH.col,r:5-j,dm:(8-j*2)*cDmg});}BAT.pt(PL.x,PL.y,'rb',24,true);},
    ()=>{for(let i=0;i<25;i++){const a=-Math.PI/2+rnd(-.4,.4);bullets.push({x:PL.x+rnd(-30,30),y:PL.y,vx:Math.cos(a)*rnd(12,20),vy:Math.sin(a)*rnd(12,20),col:CH.col,r:3,dm:6*cDmg});}BAT.pt(PL.x,PL.y,CH.col,22,true);},
    ()=>{for(let layer=0;layer<4;layer++) for(let i=0;i<6;i++){const a=i/6*Math.PI*2+layer*.3;bullets.push({x:PL.x,y:PL.y,vx:Math.cos(a)*(6+layer*2.5),vy:Math.sin(a)*(6+layer*2.5),col:CH.col,r:3.5,dm:5*cDmg});}BAT.pt(PL.x,PL.y,'rb',26,true);},
    ()=>{for(let i=0;i<16;i++){const a=i/16*Math.PI*2+Math.PI/16;const sp=8+Math.sin(i*.8)*4;bullets.push({x:PL.x,y:PL.y,vx:Math.cos(a)*sp,vy:Math.sin(a)*sp,col:CH.col,r:4,dm:6*cDmg});}BAT.pt(PL.x,PL.y,'rb',22,true);},
    ()=>{for(let i=0;i<6;i++) bullets.push({x:PL.x+(i%3)*20-20,y:PL.y-Math.floor(i/3)*15,vx:0,vy:-22,col:CH.col,r:6,dm:12*cDmg});BAT.pt(PL.x,PL.y,CH.col,20,true);},
    ()=>{BAT.spNova();BAT.pt(PL.x,PL.y,CH.col,20,true);},
    ()=>{BAT.spDive();BAT.pt(PL.x,PL.y,CH.col,18,true);},
    ()=>{BAT.spShield();BAT.pt(PL.x,PL.y,'#88eeff',24,true);},
    ()=>{BAT.spGhost();BAT.pt(PL.x,PL.y,CH.col,22,true);},
    ()=>{BAT.spLightning();BAT.pt(PL.x,PL.y,'#ffee44',22,true);},
    // 180-199
    ()=>{for(let i=0;i<30;i++){const a=i/30*Math.PI*8;const r2=5+i*1.8;bullets.push({x:PL.x+Math.cos(a)*r2*.3,y:PL.y+Math.sin(a)*r2*.3,vx:Math.cos(a)*10,vy:Math.sin(a)*10-5,col:CH.col,r:3,dm:5*cDmg});}BAT.pt(PL.x,PL.y,'rb',26,true);},
    ()=>{for(let i=0;i<12;i++){const a=i/12*Math.PI*2;const big=i%3===0;bullets.push({x:PL.x,y:PL.y,vx:Math.cos(a)*9,vy:Math.sin(a)*9,col:CH.col,r:big?7:3.5,dm:(big?12:5)*cDmg});}BAT.pt(PL.x,PL.y,CH.col,24,true);},
    ()=>{for(let i=0;i<20;i++){const px=PL.x+Math.cos(i/20*Math.PI*2)*50;const py=PL.y+Math.sin(i/20*Math.PI*2)*50;const a=Math.atan2(py-PL.y,px-PL.x);bullets.push({x:px,y:py,vx:Math.cos(a)*11,vy:Math.sin(a)*11,col:CH.col,r:4,dm:7*cDmg});}BAT.pt(PL.x,PL.y,'rb',28,true);},
    ()=>{for(let i=0;i<8;i++) for(let s=-1;s<=1;s+=2) bullets.push({x:PL.x+s*i*12,y:PL.y,vx:s*3,vy:-14-i*1.2,col:CH.col,r:4,dm:6*cDmg});BAT.pt(PL.x,PL.y,CH.col,22,true);},
    ()=>{for(let i=0;i<20;i++){const t=i/19;const a=-Math.PI*.8+t*Math.PI*1.6;bullets.push({x:PL.x,y:PL.y,vx:Math.cos(a)*12,vy:Math.sin(a)*12,col:CH.col,r:4,dm:7*cDmg});}BAT.pt(PL.x,PL.y,CH.col,22,true);},
    ()=>{for(let i=0;i<28;i++){const a=i/28*Math.PI*2;const speed=6+Math.sin(i*.4)*5;bullets.push({x:PL.x,y:PL.y,vx:Math.cos(a)*speed,vy:Math.sin(a)*speed,col:CH.col,r:3.5,dm:6*cDmg});}BAT.pt(PL.x,PL.y,'rb',28,true);},
    ()=>{for(let i=0;i<40;i++){const a=rnd(0,Math.PI*2);bullets.push({x:PL.x,y:PL.y,vx:Math.cos(a)*rnd(4,14),vy:Math.sin(a)*rnd(4,14)-4,col:'hsl('+(i*9)+',100%,65%)',r:3,dm:5*cDmg});}BAT.pt(PL.x,PL.y,'rb',32,true);},
    ()=>{// 196: „Éü„É©„Éº„Ç∑„Éß„ÉÉ„Éà(Êïµ„ÅÆÊï∞„Å†„ÅëËøΩÂ∞æ)
      const targets=enemies.slice(0,8);
      if(targets.length===0){BAT.spNova();}else{targets.forEach(e=>{const a=Math.atan2(e.y-PL.y,e.x-PL.x);bullets.push({x:PL.x,y:PL.y,vx:Math.cos(a)*16,vy:Math.sin(a)*16,col:CH.col,r:5,dm:14*cDmg});});}
      BAT.pt(PL.x,PL.y,CH.col,22,true);},
    ()=>{// 197: Ë∂ÖÊñ∞Êòü(ÂÖ®Êñπ‰Ωç50Áô∫)
      for(let i=0;i<50;i++){const a=i/50*Math.PI*2;bullets.push({x:PL.x,y:PL.y,vx:Math.cos(a)*12,vy:Math.sin(a)*12,col:'hsl('+(i*7.2)+',100%,65%)',r:4,dm:6*cDmg});}
      BAT.pt(PL.x,PL.y,'rb',36,true);},
    ()=>{// 198: „Éñ„É©„ÉÉ„ÇØ„Éõ„Éº„É´(ÊïµHPÂÖ®‰Ωì-30%)
      enemies.forEach(e=>{e.hp=Math.ceil(e.hp*.7);BAT.pt(e.x,e.y,'#aa00ff',6);});
      if(boss&&!boss.dead) boss.hp=Math.ceil(boss.hp*.85);
      for(let i=0;i<20;i++){const a=i/20*Math.PI*2;bullets.push({x:PL.x,y:PL.y,vx:Math.cos(a)*10,vy:Math.sin(a)*10,col:'#aa00ff',r:5,dm:8*cDmg});}
      BAT.pt(PL.x,PL.y,'#aa00ff',32,true);},
    ()=>{// 199: APOCALYPSE(Á©∂Ê•µÂ••Áæ©)
      for(let i=0;i<60;i++){const a=i/60*Math.PI*6;const r2=i*.8;bullets.push({x:PL.x+Math.cos(a)*r2*.4,y:PL.y+Math.sin(a)*r2*.4,vx:Math.cos(a)*11,vy:Math.sin(a)*11-3,col:'hsl('+(i*6)+',100%,70%)',r:4,dm:7*cDmg});}
      PL.iframes=180;BAT.pt(PL.x,PL.y,'rb',40,true);},
  ],

  // ‚îÄ HUD ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  updHud(){
    document.getElementById('hpBar').style.width=(PL.hp/PL.mhp*100)+'%';
    document.getElementById('spBar').style.width=(PL.sp/PL.msp*100)+'%';
  },
  updBoss(){if(!boss)return;document.getElementById('bossBar').style.width=Math.max(0,boss.hp/boss.mhp*100)+'%';},
  flash(col,dur){let el=document.getElementById('spFlash');el.style.background=col;el.style.display='block';setTimeout(()=>el.style.display='none',dur*16);},
  showSpOv(name,ruby,col){
    let ov=document.getElementById('spOv'),cvs=document.getElementById('spOvCvs'),c=cvs.getContext('2d');
    c.clearRect(0,0,W,H);c.fillStyle='rgba(0,0,0,.8)';c.fillRect(0,0,W,H);
    let g=c.createRadialGradient(W/2,H/2,0,W/2,H/2,Math.min(W,H)*.43);
    g.addColorStop(0,hA(col,.32));g.addColorStop(.6,hA(col,.1));g.addColorStop(1,'rgba(0,0,0,0)');
    c.fillStyle=g;c.fillRect(0,0,W,H);
    c.strokeStyle=hA(col,.2);c.lineWidth=1;
    for(let i=-8;i<W/28+2;i++){c.beginPath();c.moveTo(i*28-80,0);c.lineTo(i*28+80,H);c.stroke();}
    document.getElementById('spWho').textContent='‚Äî '+CH.name+' ‚Äî';
    document.getElementById('spNm').textContent=name;
    document.getElementById('spNm').style.color=col;document.getElementById('spNm').style.textShadow=`0 0 26px ${col},0 0 52px ${col}`;
    document.getElementById('spRb').textContent=ruby;
    ov.style.display='block';
    requestAnimationFrame(()=>document.getElementById('spTxt').classList.add('show'));
    spOvT=85;
  },
  hitPl(d){
    if(PL.iframes>0)return;
    PL.hp-=d;PL.iframes=48;BAT.pt(PL.x,PL.y,'rb',12);BAT.updHud();
    if(PL.hp<=0){PL.hp=0;BAT.updHud();gState='dead';if(navigator.vibrate)navigator.vibrate(200);}else{if(navigator.vibrate)navigator.vibrate(30);}
    // „ÉÄ„É°„Éº„Ç∏„Éï„É©„ÉÉ„Ç∑„É•
    const dmgOv=document.getElementById('dmgOv');
    if(dmgOv){dmgOv.style.display='block';dmgOv.style.animation='none';dmgOv.style.webkitAnimation='none';dmgOv.offsetHeight;dmgOv.style.animation='dmgFlash .4s ease-out forwards';dmgOv.style.webkitAnimation='dmgFlash .4s ease-out forwards';}
  },

  // ‚îÄ Random enemy shoot ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    eShoot(e){
    let a=Math.atan2(PL.y-e.y,PL.x-e.x);
    let spd=e.t==='sniper'?3.8:1.4+UI._stgIdx*.12;
    let si=UI._stgIdx;
    // Êù±Êñπ„Çπ„Çø„Ç§„É´ÔºöÂºæ„Åî„Å®„Å´„É©„É≥„ÉÄ„É†Ëâ≤
    const C=['#ff2244','#ff6600','#ffcc00','#aaff00','#00ff88','#00f5ff','#0088ff',
             '#aa44ff','#ff44aa','#ffffff','#ff88cc','#88ffff','#ffff44','#ff4488',
             '#ff8844','#44ff44','#8844ff','#ff44ff','#44ffaa','#ffaa44'];
    const rc=()=>C[Math.floor(Math.random()*C.length)];
    const EB=(vx,vy,r,col)=>({x:e.x,y:e.y,vx,vy,r:r||5,col:col||rc(),src:e.eid});
    let p=e.t==='sniper'?0:Math.floor(Math.random()*(4+Math.min(si,3)));
    switch(Math.min(p,9)){
      case 0: // Áãô„ÅÑÊíÉ„Å°Ôºà„Çπ„Éä„Ç§„Éë„Éº„ÅØ„Åì„ÇåÂõ∫ÂÆöÔºâ
        eBullets.push(EB(Math.cos(a)*spd,Math.sin(a)*spd,e.t==='sniper'?3:5));break;
      case 1: // 2way
        for(let d=-1;d<=1;d+=2) eBullets.push(EB(Math.cos(a+d*.28)*spd,Math.sin(a+d*.28)*spd,4));break;
      case 2: // 2wayÊñú„ÇÅ
        for(let d=-1;d<=1;d+=2) eBullets.push(EB(Math.cos(a+d*.22)*spd,Math.sin(a+d*.22)*spd,4));break;
      case 3: // 2Áô∫„É™„É≥„Ç∞
        for(let i=0;i<2;i++){let aa=i/2*Math.PI*2;eBullets.push(EB(Math.cos(aa)*spd*.9,Math.sin(aa)*spd*.9,4));}break;
      case 4: // 2Áô∫ÂâçÂæå
        for(let i=0;i<2;i++){let aa=a+i*Math.PI;eBullets.push(EB(Math.cos(aa)*spd*.85,Math.sin(aa)*spd*.85,4));}break;
      case 5: // 2wayÂ∫É„ÇÅ
        [-1,1].forEach(d=>eBullets.push(EB(Math.cos(a+d*.35)*spd,Math.sin(a+d*.35)*spd,4)));break;
      case 6: // 2Áô∫„É©„É≥„ÉÄ„É†
        for(let i=0;i<2;i++) eBullets.push(EB(rnd(-1.2,1.2),spd*0.9+rnd(0,.5),4));break;
      case 7: // 2Áô∫Âºß
        for(let i=0;i<2;i++){let aa=a-Math.PI*.3+i*Math.PI*.6;eBullets.push(EB(Math.cos(aa)*spd*.8,Math.sin(aa)*spd*.8,3));}break;
      case 8: // 2Áô∫ÂØæËßí
        for(let i=0;i<2;i++){let aa=a+i*Math.PI+.4;eBullets.push(EB(Math.cos(aa)*spd*.7,Math.sin(aa)*spd*.7,3));eBullets.push(EB(Math.cos(aa+.2)*spd,Math.sin(aa+.2)*spd,3));}break;
      default: // Áãô„ÅÑ
        eBullets.push(EB(Math.cos(a)*spd,Math.sin(a)*spd,5));
    }
  },

  // ‚îÄ Random boss shoot ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    bossShoot(){
    if(!boss||boss.dead)return;
    let a=Math.atan2(PL.y-boss.y,PL.x-boss.x);
    let rage=boss.hp<boss.mhp*.4;
    let spd=rage?2.8:2.0;
    let si=UI._stgIdx;
    // Êù±Êñπ„Ç´„É©„ÉºÔºöÂºæ„Åî„Å®„Å´ÂÖ®ÈÉ®ÈÅï„ÅÜËâ≤
    let hue=frame*4.7;
    const HC=(h)=>`hsl(${(h)%360},100%,65%)`;
    const EB=(vx,vy,r,col)=>({x:boss.x,y:boss.y,vx,vy,r:r||5,col:col||HC(hue+Math.random()*60)});
    let p=Math.floor(Math.random()*(rage?14:10));
    switch(Math.min(p,13)){
      case 0: // Áãô„ÅÑÂ§ßÂºæ
        eBullets.push(EB(Math.cos(a)*spd*1.2,Math.sin(a)*spd*1.2,9,HC(hue)));break;
      case 1: // 1way
        eBullets.push(EB(Math.cos(a)*spd,Math.sin(a)*spd,6,HC(hue)));break;
      case 2: // 1wayÁãô„ÅÑ
        eBullets.push(EB(Math.cos(a)*spd,Math.sin(a)*spd,5,HC(hue)));break;
      case 3: // ÂÖ®Êñπ‰Ωç2Áô∫
        for(let i=0;i<2;i++){let aa=i/2*Math.PI*2;eBullets.push(EB(Math.cos(aa)*spd*.9,Math.sin(aa)*spd*.9,5,HC(hue+i*30)));}break;
      case 4: // ÂÖ®Êñπ‰Ωç1Áô∫
        for(let i=0;i<1;i++){let aa=i/1*Math.PI*2;eBullets.push(EB(Math.cos(aa)*spd,Math.sin(aa)*spd,5,HC(hue+i*22)));}break;
      case 5: // ÂÖ®Êñπ‰Ωç2Áô∫
        for(let i=0;i<2;i++){let aa=i/2*Math.PI*2;eBullets.push(EB(Math.cos(aa)*spd*.95,Math.sin(aa)*spd*.95,4,HC(hue+i*18)));}break;
      case 6: // ÂºßÁä∂2Áô∫
        for(let i=0;i<2;i++){let aa=-Math.PI*.7+i/1*Math.PI*1.4;eBullets.push(EB(Math.cos(aa)*spd,Math.sin(aa)*spd,4,HC(hue+i*15)));}break;
      case 7: // „Çπ„Éë„Ç§„É©„É´1Áô∫
        for(let i=0;i<1;i++){let aa=i*Math.PI*2+frame*.05;eBullets.push(EB(Math.cos(aa)*spd*1.1,Math.sin(aa)*spd*1.1,4,HC(hue+i*20)));}break;
      case 8: // Áãô„ÅÑ1ÈÄ£Â∞Ñ
        for(let i=0;i<1;i++) setTimeout(()=>{if(boss&&!boss.dead){let a2=Math.atan2(PL.y-boss.y,PL.x-boss.x);eBullets.push(EB(Math.cos(a2)*spd*1.3,Math.sin(a2)*spd*1.3,7,HC(hue+i*40)));}},i*90);break;
      case 9: // 1Áô∫„É™„É≥„Ç∞
        for(let i=0;i<1;i++){let aa=i*Math.PI*2;eBullets.push(EB(Math.cos(aa)*spd*.65,Math.sin(aa)*spd*.65,5,HC(hue+i*36)));eBullets.push(EB(Math.cos(aa+.28)*spd*1.1,Math.sin(aa+.28)*spd*1.1,4,HC(hue+i*36+180)));}break;
      case 10: // Áãô„ÅÑÔºã1Áô∫ÔºàÊøÄÊÄíÔºâ
        eBullets.push(EB(Math.cos(a)*spd*1.4,Math.sin(a)*spd*1.4,9,HC(hue)));
        for(let i=0;i<1;i++){let aa=i*Math.PI*2;eBullets.push(EB(Math.cos(aa)*spd*.8,Math.sin(aa)*spd*.8,4,HC(hue+i*45)));}break;
      case 11: // 2Áô∫„É™„É≥„Ç∞ÔºàÊøÄÊÄíÔºâ
        for(let i=0;i<2;i++){let aa=i/2*Math.PI*2;eBullets.push(EB(Math.cos(aa)*spd*1.1,Math.sin(aa)*spd*1.1,5,HC(hue+i*15)));}break;
      case 12: // Áãô„ÅÑ2ÈÄ£Â∞ÑÔºàÊøÄÊÄíÔºâ
        for(let i=0;i<2;i++) setTimeout(()=>{if(boss&&!boss.dead){let a2=Math.atan2(PL.y-boss.y,PL.x-boss.x);for(let d=-1;d<=1;d++)eBullets.push(EB(Math.cos(a2+d*.18)*spd*1.2,Math.sin(a2+d*.18)*spd*1.2,6,HC(hue+i*50+d*30)));}},i*70);break;
      case 13: // „Éá„Çπ„Éñ„É≠„ÉÉ„Çµ„É†2Áô∫ÔºàÊøÄÊÄíMAXÔºâ
        for(let i=0;i<2;i++){let aa=i/2*Math.PI*2+frame*.03;eBullets.push(EB(Math.cos(aa)*spd*1.2,Math.sin(aa)*spd*1.2,5,HC(hue+i*12)));}break;
    }
  },

  // ‚îÄ UPDATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  update(){
    if(paused||gState==='idle'||gState==='win')return;
    frame++;
    // „Ç≥„É≥„Éú„Çø„Ç§„Éû„Éº
    if(comboT>0){comboT--;if(comboT===0){combo=0;const cd=document.getElementById('comboDisplay');if(cd)cd.style.opacity='0';}}
    // ÊïµÊÆã„ÇäË°®Á§∫
    const ec=document.getElementById('enemyCount');
    if(ec){
      if(gState==='playing'){const rem=spawnQ.length+enemies.length;ec.textContent=rem>0?'ÊÆã„Çä '+rem+'‰Ωì':'';}
      else if(gState==='boss'){ec.textContent=boss&&!boss.dead?'üëπ BOSS Êà¶':'';} 
      else{ec.textContent='';}
    }
    if(frozenT>0)frozenT--;
    if(spOvT>0){spOvT--;if(spOvT===0){document.getElementById('spOv').style.display='none';document.getElementById('spTxt').classList.remove('show');}}

    // Move player
    const AC=0.52,DC=0.76;
    let ix=0,iy=0;
    if(keys['ArrowLeft']||keys['a']||keys['A']||keys['_L'])ix=-1;
    if(keys['ArrowRight']||keys['d']||keys['D']||keys['_R'])ix=1;
    if(keys['ArrowUp']||keys['w']||keys['W']||keys['_U'])iy=-1;
    if(keys['ArrowDown']||keys['s']||keys['S']||keys['_D'])iy=1;
    if(ix&&iy){ix*=.707;iy*=.707;}
    if(tVec.x||tVec.y){let l=Math.hypot(tVec.x,tVec.y)||1;ix=clamp(tVec.x/l,-1,1);iy=clamp(tVec.y/l,-1,1);}
    if(ix!==0)PL.vx=clamp(PL.vx+ix*AC,-cSpd,cSpd); else{PL.vx*=DC;if(Math.abs(PL.vx)<.05)PL.vx=0;}
    if(iy!==0)PL.vy=clamp(PL.vy+iy*AC,-cSpd,cSpd); else{PL.vy*=DC;if(Math.abs(PL.vy)<.05)PL.vy=0;}
    PL.x=clamp(PL.x+PL.vx,cHit+2,W-cHit-2);
    const _ctrl=document.getElementById('ctrl');
    const _ctrlH=_ctrl?(_ctrl.offsetHeight||148):148;
    PL.y=clamp(PL.y+PL.vy,cHit+2,H-_ctrlH-cHit-8);
    if(PL.iframes>0)PL.iframes--;

    // Shoot & SP
    PL.cd--;
    if((keys[' ']||tShoot||keys['_fire'])&&PL.cd<=0){BAT.shoot();PL.cd=cCd;BAT.gainSp(1.3);}
    if((tSp||keys['_sp'])&&PL.sp>=cSpCost)BAT.triggerSp();
    document.getElementById('aSp').classList.toggle('rdy',PL.sp>=cSpCost);

    // Move bullets
    bullets=bullets.filter(b=>{b.x+=b.vx||0;b.y+=b.vy;return b.y>-40&&b.y<H+30&&b.x>-40&&b.x<W+40;});
    eBullets=eBullets.filter(b=>{
      if(frozenT>0)return true;
      b.x+=b.vx;b.y+=b.vy;
      if(b.y>H+40||b.x<-40||b.x>W+40||b.y<-80)return false;
      // Ëá™Âºæ„Å®ÂΩì„Åü„Å£„Åü„Çâ‰∏°ÊñπÊ∂à„Åô
      let shotDown=false;
      bullets=bullets.filter(pb=>{
        if(hit(pb.x,pb.y,pb.r,b.x,b.y,b.r+2)){shotDown=true;BAT.pt(b.x,b.y,'#ffffff',3);return false;}
        return true;
      });
      if(shotDown)return false;
      if(PL.iframes<=0&&hit(PL.x,PL.y,Math.max(2,cHit-2),b.x,b.y,Math.max(1,b.r-1))){BAT.hitPl(10+UI._stgIdx*2);return false;}
      return true;
    });

    if(gState==='playing'){
      // Spawn
      spawnTimer++;
      if(enemies.length<15&&spawnQ.length>0){spawnTimer++;const spRate=spawnQ.length>20?18:spawnQ.length>8?26:38;if(spawnTimer>=spRate){BAT.spawnEnemy(spawnQ.shift());spawnTimer=0;}}
      // Update enemies
      enemies.forEach(e=>{
        if(frozenT>0)return;
        e.y+=e.vy;
        if(e.t==='zigzag'){e.zig++;if(e.zig%58===0)e.vx=-e.vx;e.x+=e.vx;e.x=clamp(e.x,e.w/2,W-e.w/2);}
        e.shotT--;
        if(e.shotT<=0){BAT.eShoot(e);e.shotT=Math.max(36,110-UI._stgIdx*6);}
        if(PL.iframes<=0&&hit(PL.x,PL.y,cHit+1,e.x,e.y,e.w/2-3)){BAT.hitPl(28);e.hp=0;}
      });
      // Bullets hit enemies
      bullets.forEach(b=>{
        enemies.forEach(e=>{
          if(e.hp>0&&hit(b.x,b.y,b.r,e.x,e.y,e.w/2)){
            let d=b.dm||1;e.hp-=d;b.y=-9999;BAT.gainSp(2);
            if(e.hp<=0){if(e.eid)eBullets=eBullets.filter(eb=>eb.src!==e.eid);BAT.addScore(e.t==='heavy'?300:e.t==='sniper'?200:100);BAT.addKill(e.x,e.y,e.col,e.mhp);}
            else BAT.pt(e.x,e.y,rbC(frame),4);
          }
        });
      });
      enemies=enemies.filter(e=>e.hp>0&&e.y<H+90);
      bullets=bullets.filter(b=>b.y>-9000);
      // Boss trigger: 40% enemies killed OR queue empty + enemies gone
      if(!bossTriggered&&(killedHp>=threshHp||(spawnQ.length===0&&enemies.length===0))){
        bossTriggered=true;setTimeout(()=>BAT.spawnBoss(),500);
      }
    } else if(gState==='boss'){
      if(boss.dead){
        boss.deathT++;
        if(boss.deathT%3===0)BAT.pt(boss.x+rnd(-38,38),boss.y+rnd(-26,26),'rb',11,true);
        if(boss.deathT>120){
          if(!SAV.cleared.includes(ST.id))SAV.cleared.push(ST.id);
          // Á¢∫ÁéáÂà∂Â†±ÈÖ¨: 50%‚Üí3ÂÄã, 20%‚Üí5ÂÄã, 10%‚Üí15ÂÄã, 1%‚ÜíËôπ„ÅÆÊ¨†Áâá1ÂÄã
          const rnd100=Math.random()*100;
          let rewardCoins=0,rewardRainbow=0,rewardLabel='';
          if(rnd100<1){rewardRainbow=1;SAV.rainbow=(SAV.rainbow||0)+1;rewardLabel='üåà Ëôπ„ÅÆÊ¨†Áâá +1ÔºÅ';}
          else if(rnd100<11){rewardCoins=15;SAV.coins+=15;rewardLabel='‚öôÔ∏è ÈâÑ„ÅÆÊ¨†Áâá +15ÔºÅ';}
          else if(rnd100<31){rewardCoins=5;SAV.coins+=5;rewardLabel='‚öôÔ∏è ÈâÑ„ÅÆÊ¨†Áâá +5ÔºÅ';}
          else if(rnd100<81){rewardCoins=3;SAV.coins+=3;rewardLabel='‚öôÔ∏è ÈâÑ„ÅÆÊ¨†Áâá +3ÔºÅ';}
          else{rewardLabel='Â†±ÈÖ¨„Å™„Åó...';}
          if(score>SAV.hiscore){SAV.hiscore=score;}
          doSave();UI.updCoins();UI.updRainbow();
          document.getElementById('winCoin').textContent=rewardLabel;
          gState='win';
    document.getElementById('winCoin').textContent=rewardLabel;
    document.getElementById('winScore').textContent=score.toLocaleString();
    document.getElementById('winCombo').textContent='MAX '+maxCombo+'√ó';
    document.getElementById('winKills').textContent=totalKills+'Ê©ü';
    document.getElementById('resWin').style.display='flex';
        }
        return;
      }
      if(frozenT<=0){
        boss.x+=boss.vx;if(boss.x<68||boss.x>W-68)boss.vx=-boss.vx;
        boss.y=110+Math.sin(boss.patT*.019)*44;boss.patT++;
        let rage=boss.hp<boss.mhp*.4;
        if(boss.patT%(rage?22:36)===0)BAT.bossShoot();
        if(boss.patT%80===0)BAT.bossShoot();
        // „Éú„ÇπÊà¶‰∏≠„Å´3Áßí„Åî„Å®„Ç¢„Ç§„ÉÜ„É†„Éâ„É≠„ÉÉ„Éó
        if(boss.patT%180===0)BAT.spawnDrop(boss.x+(-60+Math.random()*120),boss.y+40);
      }
      bullets.forEach(b=>{
        if(boss&&!boss.dead&&hit(b.x,b.y,b.r,boss.x,boss.y,50)){
          let d=b.dm||1;boss.hp=Math.max(0,boss.hp-d);b.y=-9999;
          BAT.gainSp(3);BAT.updBoss();BAT.addScore(20);
          BAT.pt(boss.x+rnd(-14,14),boss.y+rnd(-10,10),'rb',4);
          if(boss.hp<=0){boss.dead=true;boss.deathT=0;BAT.addScore(2000+UI._stgIdx*600);BAT.pt(boss.x,boss.y,'rb',65,true);}
        }
      });
      bullets=bullets.filter(b=>b.y>-9000);
      if(!boss.dead&&PL.iframes<=0&&hit(PL.x,PL.y,cHit+8,boss.x,boss.y,50))BAT.hitPl(42);
      BAT.updBoss();
    }
    parts.forEach(p=>{p.x+=p.vx;p.y+=p.vy;p.vy+=.04;p.life-=p.dc;});
    parts=parts.filter(p=>p.life>0);
    // „Éâ„É≠„ÉÉ„Éó„Ç¢„Ç§„ÉÜ„É†Êõ¥Êñ∞
    if(guardTimer>0){
      guardTimer--;
      if(guardTimer===0){guardActive=false;}
      const gl=document.getElementById('guardLbl');const gt=document.getElementById('guardTrack');const gb=document.getElementById('guardBar');
      if(gl){gl.style.display=guardActive?'block':'none';}if(gt){gt.style.display=guardActive?'block':'none';}if(gb){gb.style.width=(guardTimer/360*100)+'%';}
    }
    dropItems.forEach(it=>{
      it.y+=it.vy;it.life--;
      // „Éó„É¨„Ç§„É§„Éº„Å®ÂΩì„Åü„ÇäÂà§ÂÆöÔºàÂèñÂæóÔºâ
      if(Math.hypot(it.x-PL.x,it.y-PL.y)<it.r+cHit){
        if(it.type==='heal'){PL.hp=Math.min(PL.mhp,PL.hp+Math.round(PL.mhp*.25));BAT.updHud();BAT.pt(PL.x,PL.y,'#44ff88',12);}
        else{guardActive=true;guardTimer=360;BAT.pt(PL.x,PL.y,'#44aaff',14);}  // „Ç¨„Éº„Éâ6Áßí
        it.life=0;
      }
    });
    dropItems=dropItems.filter(it=>it.life>0&&it.y<H+30);
    // „Ç¨„Éº„Éâ‰∏≠„ÅØÊïµÂºæ„ÇíÂºæ„Åè
    if(guardActive){
      eBullets=eBullets.filter(eb=>{
        if(Math.hypot(eb.x-PL.x,eb.y-PL.y)<cHit+22){BAT.pt(eb.x,eb.y,'#44aaff',4);return false;}
        return true;
      });
    }
    BAT.updHud();
    if(gState==='dead'){
      const ls=document.getElementById('loseScore');const lk=document.getElementById('loseKills');
      if(ls)ls.textContent=score.toLocaleString();if(lk)lk.textContent=totalKills+'Ê©ü';
      document.getElementById('resLose').style.display='flex';
    }
  },

  // ‚îÄ DRAW ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  draw(){
    // BG
    let bg=ctx.createLinearGradient(0,0,0,H);bg.addColorStop(0,ST.bg[0]);bg.addColorStop(1,ST.bg[1]);
    ctx.fillStyle=bg;ctx.fillRect(0,0,W,H);
    // Stars
    stars.forEach(s=>{s.y+=s.sp*.7;if(s.y>H){s.y=0;s.x=rnd(0,W);}
      ctx.globalAlpha=.12+.16*Math.abs(Math.sin(frame*.013+s.b*8));ctx.fillStyle='#ffffff';ctx.fillRect(s.x,s.y,s.s,s.s);});
    ctx.globalAlpha=1;
    if(boss&&!boss.dead&&boss.hp<boss.mhp*.4&&frame%52<5){ctx.fillStyle='rgba(255,0,0,.05)';ctx.fillRect(0,0,W,H);}
    if(frozenT>0){ctx.fillStyle='rgba(136,221,255,.07)';ctx.fillRect(0,0,W,H);}
    // Player bullets
    bullets.forEach(b=>{ctx.save();ctx.shadowBlur=11;ctx.shadowColor=b.col;ctx.fillStyle=b.col;ctx.beginPath();ctx.arc(b.x,b.y,b.r,0,Math.PI*2);ctx.fill();ctx.restore();});
    // Enemy bulletsÔºàÊù±Êñπ„Çπ„Çø„Ç§„É´Ôºö„Ç≥„Ç¢„Å®ÂÖâËº™Ôºâ
    eBullets.forEach(b=>{
      ctx.save();
      // Â§ñÂÅ¥„ÅÆÂÖâËº™
      ctx.shadowBlur=18;ctx.shadowColor=b.col;
      ctx.globalAlpha=0.35;ctx.fillStyle=b.col;
      ctx.beginPath();ctx.arc(b.x,b.y,b.r*1.8,0,Math.PI*2);ctx.fill();
      // ‰∏≠Èñì„Ç∞„É≠„Éº
      ctx.globalAlpha=0.6;
      ctx.beginPath();ctx.arc(b.x,b.y,b.r*1.2,0,Math.PI*2);ctx.fill();
      // ÁôΩ„Ç≥„Ç¢
      ctx.globalAlpha=1;ctx.fillStyle='#ffffff';ctx.shadowBlur=6;ctx.shadowColor=b.col;
      ctx.beginPath();ctx.arc(b.x,b.y,b.r*0.45,0,Math.PI*2);ctx.fill();
      ctx.restore();
    });
    // Enemies
    enemies.forEach(e=>{
      ctx.save();ctx.shadowBlur=10;ctx.shadowColor=e.col;ctx.fillStyle=e.col;
      if(e.t==='heavy'){
        ctx.beginPath();ctx.moveTo(e.x,e.y+e.h/2);ctx.lineTo(e.x-e.w/2,e.y);ctx.lineTo(e.x-e.w/3,e.y-e.h/2);ctx.lineTo(e.x+e.w/3,e.y-e.h/2);ctx.lineTo(e.x+e.w/2,e.y);ctx.closePath();ctx.fill();
        ctx.fillStyle='#0a0a0a';ctx.fillRect(e.x-18,e.y-e.h/2-8,36,4);ctx.fillStyle=e.col;ctx.fillRect(e.x-18,e.y-e.h/2-8,36*(e.hp/e.mhp),4);
      } else if(e.t==='sniper'){
        ctx.beginPath();ctx.moveTo(e.x,e.y-e.h/2);ctx.lineTo(e.x-e.w/4,e.y+e.h/2);ctx.lineTo(e.x+e.w/4,e.y+e.h/2);ctx.closePath();ctx.fill();
        let a2=Math.atan2(PL.y-e.y,PL.x-e.x);ctx.strokeStyle=hA(e.col,.32);ctx.lineWidth=1;ctx.setLineDash([3,4]);
        ctx.beginPath();ctx.moveTo(e.x,e.y);ctx.lineTo(e.x+Math.cos(a2)*85,e.y+Math.sin(a2)*85);ctx.stroke();ctx.setLineDash([]);
      } else if(e.t==='zigzag'){
        ctx.beginPath();ctx.moveTo(e.x,e.y+e.h/2);ctx.lineTo(e.x-e.w/2,e.y-e.h/2+8);ctx.lineTo(e.x-e.w/4,e.y-e.h/2);ctx.lineTo(e.x+e.w/4,e.y-e.h/2);ctx.lineTo(e.x+e.w/2,e.y-e.h/2+8);ctx.closePath();ctx.fill();
        ctx.strokeStyle=hA(e.col,.38);ctx.lineWidth=1;ctx.beginPath();ctx.arc(e.x,e.y,e.w/2+4+2*Math.sin(frame*.11),0,Math.PI*2);ctx.stroke();
      } else {
        ctx.beginPath();ctx.moveTo(e.x,e.y+e.h/2);ctx.lineTo(e.x-e.w/2,e.y-e.h/2+8);ctx.lineTo(e.x-e.w/4,e.y-e.h/2);ctx.lineTo(e.x+e.w/4,e.y-e.h/2);ctx.lineTo(e.x+e.w/2,e.y-e.h/2+8);ctx.closePath();ctx.fill();
      }
      ctx.restore();
    });
    // Boss
    if(boss){
      ctx.save();let p2=.7+.3*Math.sin(frame*.1);
      if(boss.dead)ctx.globalAlpha=Math.max(0,1-boss.deathT/80);
      ctx.shadowBlur=26*p2;ctx.shadowColor=bossD.col;ctx.fillStyle=bossD.col;
      ctx.beginPath();ctx.moveTo(boss.x,boss.y-40);ctx.lineTo(boss.x+46,boss.y);ctx.lineTo(boss.x+32,boss.y+32);ctx.lineTo(boss.x-32,boss.y+32);ctx.lineTo(boss.x-46,boss.y);ctx.closePath();ctx.fill();
      ctx.fillStyle=hA(bossD.col,.48);
      ctx.beginPath();ctx.moveTo(boss.x-46,boss.y);ctx.lineTo(boss.x-68,boss.y+20);ctx.lineTo(boss.x-32,boss.y+32);ctx.closePath();ctx.fill();
      ctx.beginPath();ctx.moveTo(boss.x+46,boss.y);ctx.lineTo(boss.x+68,boss.y+20);ctx.lineTo(boss.x+32,boss.y+32);ctx.closePath();ctx.fill();
      ctx.fillStyle='rgba(255,255,255,.94)';ctx.shadowColor='#ffffff';
      ctx.beginPath();ctx.arc(boss.x,boss.y,9.5*p2,0,Math.PI*2);ctx.fill();
      ctx.strokeStyle=bossD.col;ctx.lineWidth=2;ctx.globalAlpha=.42+.3*Math.sin(frame*.14);
      ctx.beginPath();ctx.arc(boss.x,boss.y,52+5*Math.sin(frame*.1),0,Math.PI*2);ctx.stroke();
      // face emoji
      if(!boss.dead){ctx.globalAlpha=1;ctx.shadowBlur=0;ctx.font='24px serif';ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillText(bossD.ico,boss.x,boss.y);}
      ctx.restore();
    }
    // Player ship
    BAT.drawPlayer();
    // Particles
    parts.forEach(p=>{ctx.save();ctx.globalAlpha=p.life*.9;ctx.shadowBlur=8;ctx.shadowColor=p.col;ctx.fillStyle=p.col;
      ctx.beginPath();ctx.arc(p.x,p.y,p.r*Math.max(.1,p.life),0,Math.PI*2);ctx.fill();
      if(p.r>2&&p.life>.5){ctx.globalAlpha=p.life*.38;ctx.strokeStyle=p.col;ctx.lineWidth=.7;
        ctx.beginPath();ctx.moveTo(p.x-p.r*1.5,p.y);ctx.lineTo(p.x+p.r*1.5,p.y);ctx.moveTo(p.x,p.y-p.r*1.5);ctx.lineTo(p.x,p.y+p.r*1.5);ctx.stroke();}
      ctx.restore();
    });
    // „Éâ„É≠„ÉÉ„Éó„Ç¢„Ç§„ÉÜ„É†ÊèèÁîª
    dropItems.forEach(function(it){
      const pulse=.7+.3*Math.sin(frame*.18);
      const col=it.type==='heal'?'#44ff88':'#44aaff';
      ctx.save();
      ctx.shadowBlur=18*pulse;ctx.shadowColor=col;
      ctx.globalAlpha=.3*pulse;ctx.fillStyle=col;
      ctx.beginPath();ctx.arc(it.x,it.y,it.r*1.6,0,Math.PI*2);ctx.fill();
      ctx.globalAlpha=.9;ctx.fillStyle=col;
      ctx.beginPath();ctx.arc(it.x,it.y,it.r,0,Math.PI*2);ctx.fill();
      ctx.globalAlpha=1;ctx.shadowBlur=0;
      ctx.font='bold '+(it.r*1.3)+'px serif';
      ctx.textAlign='center';ctx.textBaseline='middle';
      ctx.fillStyle='#ffffff';
      ctx.fillText(it.type==='heal'?'‚ô•':'G',it.x,it.y);
      ctx.restore();
    });
    // „Ç¨„Éº„Éâ„Ç∑„Éº„É´„ÉâÊèèÁîª
    if(guardActive){
      const gp=.4+.6*Math.sin(frame*.22);
      ctx.save();ctx.globalAlpha=.18*gp;
      ctx.fillStyle='#44aaff';
      ctx.beginPath();ctx.arc(PL.x,PL.y,cHit+22,0,Math.PI*2);ctx.fill();
      ctx.globalAlpha=.6*gp;ctx.strokeStyle='#88ddff';ctx.lineWidth=2.5;
      ctx.beginPath();ctx.arc(PL.x,PL.y,cHit+22,0,Math.PI*2);ctx.stroke();
      ctx.restore();
    }
    // SP ready
    if(PL.sp>=cSpCost&&gState!=='idle'){
      ctx.save();ctx.globalAlpha=.42+.4*Math.sin(frame*.14);ctx.fillStyle=CH.col;
      ctx.font='bold 9px Orbitron,monospace';ctx.textAlign='center';ctx.shadowBlur=8;ctx.shadowColor=CH.col;
      ctx.fillText('‚ö° '+CH.sp.name,W/2,H-158);ctx.restore();
    }
  },

  drawPlayer(){
    let x=PL.x,y=PL.y;
    if(PL.iframes>0&&Math.floor(PL.iframes/5)%2===0)return;
    ctx.save();
    // Thruster
    let tp=.5+.5*Math.sin(frame*.3),tx=x+PL.vx*.15;
    let tg=ctx.createRadialGradient(tx,y+21,0,tx,y+21,23);
    tg.addColorStop(0,`rgba(0,110,255,${tp})`);tg.addColorStop(1,'rgba(0,0,200,0)');
    ctx.fillStyle=tg;ctx.beginPath();ctx.ellipse(tx,y+21,9,23,0,0,Math.PI*2);ctx.fill();
    // Tilt
    ctx.translate(x,y);ctx.rotate(PL.vx*-.023);ctx.translate(-x,-y);
    ctx.shadowBlur=14;ctx.shadowColor=CH.col;ctx.fillStyle=CH.col;
    ctx.beginPath();ctx.moveTo(x,y-20);ctx.lineTo(x-13,y+15);ctx.lineTo(x-5,y+8);ctx.lineTo(x,y+13);ctx.lineTo(x+5,y+8);ctx.lineTo(x+13,y+15);ctx.closePath();ctx.fill();
    // Cockpit
    ctx.fillStyle='rgba(0,10,24,.85)';ctx.beginPath();ctx.ellipse(x,y-5,4,6,0,0,Math.PI*2);ctx.fill();
    // Hitbox dot
    ctx.shadowBlur=6;ctx.shadowColor='#ffffff';ctx.fillStyle='rgba(255,255,255,.92)';ctx.beginPath();ctx.arc(x,y,cHit,0,Math.PI*2);ctx.fill();
    // Plane icon above
    ctx.shadowBlur=0;ctx.font='15px serif';ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillText(CH.ico,x,y-30);
    ctx.restore();
  },

  // ‚îÄ Main loop ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  _lastT:0,
  loop(ts){
    requestAnimationFrame(BAT.loop);
    // 60fpsÂõ∫ÂÆö ‚Äî 1„Éï„É¨„Éº„É†16.67ms„ÄÇ„Éè„Ç§„É™„Éï„É¨„ÉÉ„Ç∑„É•„É¨„Éº„ÉàÁîªÈù¢„Åß„ÇÇÈÄü„Åè„Å™„Çâ„Å™„ÅÑ
    if(!BAT._lastT){BAT._lastT=ts;}
    let dt=ts-BAT._lastT;
    if(dt<12)return; // „Åæ„Å†1„Éï„É¨„Éº„É†Áµå„Å£„Å¶„ÅÑ„Å™„ÅÑ‚Üí„Çπ„Ç≠„ÉÉ„Éó
    if(dt>100)dt=16; // „Çø„ÉñÈùû„Ç¢„ÇØ„ÉÜ„Ç£„ÉñÂæå„ÅÆÂ§ß„Ç∏„É£„É≥„Éó„ÇíÈò≤„Åê
    BAT._lastT=ts;
    if(UI.cur==='sBattle'&&gState!=='idle'){if(!paused)BAT.update();BAT.draw();}
  },

  // ‚îÄ Controls ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  bindControls(){
    ['dpU','dpD','dpL','dpR','aFire','aSp','aMap'].forEach(id=>{
      let old=document.getElementById(id);if(!old)return;
      let neo=old.cloneNode(true);old.parentNode.replaceChild(neo,old);
    });
    function hold(id,key){
      let el=document.getElementById(id);if(!el)return;
      el.addEventListener('touchstart',e=>{e.preventDefault();keys[key]=true;},{passive:false});
      el.addEventListener('touchend',e=>{e.preventDefault();keys[key]=false;});
      el.addEventListener('mousedown',()=>keys[key]=true);
      el.addEventListener('mouseup',()=>keys[key]=false);
      el.addEventListener('mouseleave',()=>keys[key]=false);
    }
    hold('dpU','_U');hold('dpD','_D');hold('dpL','_L');hold('dpR','_R');
    hold('aFire','_fire');
    document.getElementById('aSp').addEventListener('click',()=>BAT.triggerSp());
    document.getElementById('aMap').addEventListener('click',()=>BAT.pauseGame());
  },
};

// ‚îÄ‚îÄ‚îÄ GLOBAL INPUT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
window.addEventListener('keydown',e=>{keys[e.key]=true;if(e.key===' ')e.preventDefault();});
window.addEventListener('keyup',e=>{keys[e.key]=false;});

// Canvas touch (drag to move, tap=shoot, double-tap=SP)
let _tid=null,_tSX=0,_tSY=0,_tLast=0;
canvas.addEventListener('touchstart',e=>{
  e.preventDefault();
  let now=Date.now();if(now-_tLast<240)tSp=true;_tLast=now;
  let t=e.changedTouches[0];_tid=t.identifier;_tSX=t.clientX;_tSY=t.clientY;tShoot=true;
},{passive:false});
canvas.addEventListener('touchmove',e=>{
  e.preventDefault();
  const scale=canvas.getBoundingClientRect().width/W||1;
  for(let t of e.changedTouches)if(t.identifier===_tid){tVec.x=(t.clientX-_tSX)/scale;tVec.y=(t.clientY-_tSY)/scale;}
},{passive:false});
canvas.addEventListener('touchend',()=>{tVec.x=0;tVec.y=0;tShoot=false;tSp=false;_tid=null;});


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  STAGE EDITOR
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const BOSS_OPTIONS = [
  {name:'WRAITH',    ico:'üëæ', hp:400,  col:'#00ff88'},
  {name:'MAGMA',     ico:'üî•', hp:600,  col:'#ff6600'},
  {name:'ICE WALL',  ico:'üßä', hp:800,  col:'#88ddff'},
  {name:'SHADOW',    ico:'üåë', hp:1100, col:'#aa44ff'},
  {name:'VOID KING', ico:'üíÄ', hp:1500, col:'#ff3344'},
  {name:'STAR GOD',  ico:'üåü', hp:2000, col:'#ffd700'},
  {name:'BLACK HOLE',ico:'üåÄ', hp:2600, col:'#ffffff'},
  {name:'DARK ANGEL',ico:'üòà', hp:3200, col:'#ff00ff'},
];
const BG_THEMES = [
  {name:'Ê∑±ÂÆáÂÆô',   bg:['#000614','#01091a']},
  {name:'Ê∫∂Â≤©',     bg:['#0e0400','#180700']},
  {name:'Ê∞∑Ê≤≥',     bg:['#000514','#000e24']},
  {name:'ÊöóÈªí',     bg:['#040012','#08001c']},
  {name:'Ë°ÄÊà¶',     bg:['#0e0002','#180004']},
  {name:'ÈäÄÊ≤≥',     bg:['#000514','#040520']},
  {name:'Áø°Áø†',     bg:['#001206','#001e08']},
  {name:'ËôöÁ©∫',     bg:['#0e000e','#160016']},
];
const BG_SWATCHES = ['#01091a','#180700','#000e24','#08001c','#180004','#040520','#001e08','#160016'];
const OBS_OPTIONS = [
  {id:'asteroid', ico:'‚òÑÔ∏è', name:'ÈöïÁü≥'},
  {id:'mine',     ico:'üí£', name:'Ê©üÈõ∑'},
  {id:'laser',    ico:'‚ö°', name:'„É¨„Éº„Ç∂„Éº'},
  {id:'shield',   ico:'üõ°Ô∏è', name:'„Éê„É™„Ç¢'},
  {id:'fog',      ico:'üå´Ô∏è', name:'Èúß'},
  {id:'gravity',  ico:'üåÄ', name:'ÈáçÂäõÂ†¥'},
];
const DIFF_LABELS = ['EASY','NORMAL','HARD','HELL'];
const DIFF_CLASSES = ['diff-e','diff-n','diff-h','diff-x'];
const DIFF_MULT = [0.6, 1.0, 1.5, 2.2]; // enemy speed multiplier

const ED = {
  enemies: {basic:20, zigzag:10, heavy:5, sniper:5},
  selBoss: 0,
  selBg: 0,
  selObs: new Set(),
  diff: 1,

  init(){
    this._buildBossGrid();
    this._buildBgSwatches();
    this._buildObsGrid();
    this.updateTotal();
    document.getElementById('pubSuccess').style.display='none';
  },

  _buildBossGrid(){
    const g=document.getElementById('bossGrid');
    if(!g)return;
    g.innerHTML='';
    BOSS_OPTIONS.forEach((b,i)=>{
      const d=document.createElement('div');
      d.className='boss-card'+(i===this.selBoss?' boss-sel':'');
      d.innerHTML=`<div class="boss-ico">${b.ico}</div>
        <div class="boss-nm">${b.name}</div>
        <div class="boss-hp">HP ${b.hp.toLocaleString()}</div>`;
      d.onclick=()=>{this.selBoss=i;this._buildBossGrid();};
      g.appendChild(d);
    });
  },

  _buildBgSwatches(){
    const g=document.getElementById('bgSwatches');
    if(!g)return;
    g.innerHTML='';
    BG_SWATCHES.forEach((col,i)=>{
      const d=document.createElement('div');
      d.className='bg-sw'+(i===this.selBg?' bg-sw-sel':'');
      d.style.background=`radial-gradient(circle, ${BG_THEMES[i].bg[0]} 0%, ${col} 100%)`;
      d.style.borderColor=i===this.selBg?col:'transparent';
      d.title=BG_THEMES[i].name;
      d.onclick=()=>{this.selBg=i;this._buildBgSwatches();};
      g.appendChild(d);
    });
  },

  _buildObsGrid(){
    const g=document.getElementById('obsGrid');
    if(!g)return;
    g.innerHTML='';
    OBS_OPTIONS.forEach(obs=>{
      const d=document.createElement('div');
      d.className='obs-item'+(this.selObs.has(obs.id)?' obs-sel':'');
      d.innerHTML=`<div class="obs-ico">${obs.ico}</div><div class="obs-nm">${obs.name}</div>`;
      d.onclick=()=>{
        if(this.selObs.has(obs.id))this.selObs.delete(obs.id);
        else this.selObs.add(obs.id);
        this._buildObsGrid();
      };
      g.appendChild(d);
    });
  },

  adjustEnemy(type, delta){
    this.enemies[type]=Math.max(0, Math.min(50, (this.enemies[type]||0)+delta));
    const el=document.getElementById('ev'+type.charAt(0).toUpperCase()+type.slice(1));
    if(el)el.textContent=this.enemies[type];
    this.updateTotal();
  },

  updateTotal(){
    const t=Object.values(this.enemies).reduce((a,b)=>a+b,0);
    const el=document.getElementById('edTotalEnemies');
    if(el)el.textContent=t;
  },

  updateDiff(v){
    this.diff=parseInt(v);
    const el=document.getElementById('edDiffLbl');
    if(el)el.innerHTML=`<span class="cm-diff-badge ${DIFF_CLASSES[this.diff]}">${DIFF_LABELS[this.diff]}</span>`;
  },

  _buildStageData(){
    const name=(document.getElementById('edName')?.value||'').trim()||'ÁÑ°Âêç„Çπ„ÉÜ„Éº„Ç∏';
    const desc=(document.getElementById('edDesc')?.value||'').trim()||'Ë™¨Êòé„Å™„Åó';
    const author=(document.getElementById('edAuthor')?.value||'').trim()||'ÂåøÂêç';
    const boss=BOSS_OPTIONS[this.selBoss];
    const theme=BG_THEMES[this.selBg];
    // Build enemy queue
    const enemyList=[];
    Object.entries(this.enemies).forEach(([t,n])=>{
      for(let i=0;i<n;i++) enemyList.push({t,col:theme.bg[0]==='#000614'?'#00f5ff':'#ff6600'});
    });
    // Shuffle
    for(let i=enemyList.length-1;i>0;i--){let j=0|Math.random()*(i+1);[enemyList[i],enemyList[j]]=[enemyList[j],enemyList[i]];}
    return {
      id:'cu_'+Date.now(),
      name, desc, author,
      boss:{name:boss.name,ico:boss.ico,hp:boss.hp,col:boss.col},
      bg:theme.bg,
      eC:[boss.col,'#ffffff'],
      coins:1,
      diff:this.diff,
      authorId:CM.uid(),
      obs:[...this.selObs],
      enemyCounts:{...this.enemies},
      createdAt:Date.now(),
      likes:0,
      plays:0,
    };
  },

  testPlay(){
    const st=this._buildStageData();
    // Inject as temporary stage
    window._customStage=st;
    UI._stgIdx=-1; // custom flag
    UI._selChar=SAV.hangar[0]||'p0';
    UI.show('sChar');
    UI.buildCharGrid();
    // Override start to use custom stage
    window._testMode=true;
  },

  async publish(){
    const name=(document.getElementById('edName')?.value||'').trim();
    if(!name){
      alert('„Çπ„ÉÜ„Éº„Ç∏Âêç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');return;
    }
    const total=Object.values(this.enemies).reduce((a,b)=>a+b,0);
    if(total<5){alert('Êïµ„ÇíÊúÄ‰Ωé5‰ΩìÈÖçÁΩÆ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');return;}

    const btn=document.getElementById('pubBtn');
    btn.disabled=true;btn.textContent='ÂÖ¨Èñã‰∏≠...';

    const st=this._buildStageData();
    try{
      await window.storage.set('community:'+st.id, JSON.stringify(st), true);
      try{const an=document.getElementById('edAuthor')?.value?.trim();if(an)localStorage.setItem('sky_author',an);}catch(e){}
      // Update index
      let idx=[];
      try{const r=await window.storage.get('community_index',true);if(r)idx=JSON.parse(r.value);}catch(e){}
      idx.unshift(st.id);
      if(idx.length>100)idx=idx.slice(0,100);
      await window.storage.set('community_index',JSON.stringify(idx),true);
      // Save my stages locally
      let mine=[];
      try{const r=await window.storage.get('my_stages');if(r)mine=JSON.parse(r.value);}catch(e){}
      mine.unshift(st.id);
      await window.storage.set('my_stages',JSON.stringify(mine));

      document.getElementById('pubSuccess').style.display='block';
      document.getElementById('pubSuccess').textContent='‚úì ÂÖ¨Èñã„Åó„Åæ„Åó„ÅüÔºÅ24ÊôÇÈñìÂæå„Å´Ëá™ÂãïÂâäÈô§„Åï„Çå„Åæ„Åô';
      btn.textContent='‚úì ÂÖ¨ÈñãÊ∏à„Åø';
    }catch(e){
      btn.disabled=false;btn.textContent='üåç ÂÖ¨Èñã„Åô„Çã';
      alert('ÂÖ¨Èñã„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: '+e.message);
    }
  },
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  COMMUNITY VIEWER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const CM = {
  _uid:null,
  _stage:null,
  tab:'all',
  stages:[],

  uid(){
    if(this._uid)return this._uid;
    try{
      let id=localStorage.getItem('sky_uid');
      if(!id){id='u'+Date.now().toString(36)+Math.random().toString(36).slice(2,6);localStorage.setItem('sky_uid',id);}
      this._uid=id;
    }catch(e){this._uid='anon';}
    return this._uid;
  },

  switchTab(t){
    this.tab=t;
    ['all','new','mine'].forEach(function(id){
      const el=document.getElementById('cmTab'+id[0].toUpperCase()+id.slice(1));
      if(el)el.className='cm-tab'+(t===id?' cm-tab-act':'');
    });
    this.render();
  },

  async load(){
    const list=document.getElementById('cmList');
    if(list)list.innerHTML='<div class="cm-loading">Ë™≠„ÅøËæº„Åø‰∏≠...</div>';
    try{
      let idx=[];
      try{const r=await window.storage.get('community_index',true);if(r)idx=JSON.parse(r.value);}catch(e){}
      const now=Date.now();
      const ONE_DAY=86400000;
      const expiredIds=[];
      const results=await Promise.all(idx.slice(0,50).map(async function(id){
        try{
          const r=await window.storage.get('community:'+id,true);
          if(!r)return null;
          const st=JSON.parse(r.value);
          // 24ÊôÇÈñì„ÅßÊúüÈôêÂàá„Çå
          if(now-(st.createdAt||0)>ONE_DAY){
            expiredIds.push(id);
            return null;
          }
          // ÊÆã„ÇäÊôÇÈñì„Çí„Ç≠„É£„ÉÉ„Ç∑„É•
          st._expiresIn=ONE_DAY-(now-(st.createdAt||0));
          return st;
        }catch(e){}
        return null;
      }));
      this.stages=results.filter(Boolean);
      // ÊúüÈôêÂàá„Çå„ÇíÈùûÂêåÊúü„ÅßÂâäÈô§
      if(expiredIds.length>0){
        (async function(){
          for(const id of expiredIds){
            try{
              await window.storage.delete('community:'+id,true);
              await window.storage.delete('comments:'+id,true);
            }catch(e){}
          }
          try{
            const r=await window.storage.get('community_index',true);
            if(r){
              let idx2=JSON.parse(r.value).filter(function(i){return expiredIds.indexOf(i)===-1;});
              await window.storage.set('community_index',JSON.stringify(idx2),true);
            }
          }catch(e){}
        })();
      }
      const cnt=document.getElementById('cmCount');
      if(cnt)cnt.textContent=this.stages.length+'‰ΩúÂìÅ';
    }catch(e){
      if(list)list.innerHTML='<div class="cm-empty">Ë™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü</div>';
      return;
    }
    this.render();
  },

  async render(){
    const list=document.getElementById('cmList');
    if(!list)return;
    const uid=this.uid();
    let data=[].concat(this.stages);
    if(this.tab==='new')data.sort(function(a,b){return(b.createdAt||0)-(a.createdAt||0);});
    else if(this.tab==='mine')data=data.filter(function(s){return s.authorId===uid;});
    else data.sort(function(a,b){return(b.createdAt||0)-(a.createdAt||0);});
    if(data.length===0){
      list.innerHTML=
        '<div class="yt-empty">'+
        '<div class="yt-empty-ico">'+(this.tab==='mine'?'üõ†':'üåç')+'</div>'+
        (this.tab==='mine'
          ?'„Åæ„Å†ÂÖ¨Èñã„Åó„Åü„Çπ„ÉÜ„Éº„Ç∏„Åå„ÅÇ„Çä„Åæ„Åõ„Çì<br>„Äå‰Ωú„Çã„Äç„Åã„Çâ„Çπ„ÉÜ„Éº„Ç∏„Çí‰Ωú„Å£„Å¶<br>‰∏ñÁïå„Å´ÂÖ¨Èñã„Åó„Çà„ÅÜÔºÅ'
          :'„Åæ„Å†„Çπ„ÉÜ„Éº„Ç∏„Åå„ÅÇ„Çä„Åæ„Åõ„Çì<br>„Äå‰Ωú„Çã„Äç„Åã„Çâ‰∏ñÁïåÂàù„ÅÆ<br>„Ç´„Çπ„Çø„É†„Çπ„ÉÜ„Éº„Ç∏„Çí‰Ωú„Çç„ÅÜÔºÅ')+'</div>';
      return;
    }
    list.innerHTML='';
    const self=this;
    // Featured: ÊúÄÊñ∞1‰ª∂„ÇíÂ§ß„Åç„ÅèË°®Á§∫
    if(this.tab!=='mine'&&data.length>0){
      const feat=data[0];
      list.appendChild(self._makeCard(feat, uid, true));
      if(data.length>1){
        const secHd=document.createElement('div');
        secHd.className='yt-section-header';
        secHd.textContent='üìã „Åô„Åπ„Å¶„ÅÆ„Çπ„ÉÜ„Éº„Ç∏';
        list.appendChild(secHd);
        data.slice(1).forEach(function(st){ list.appendChild(self._makeCard(st, uid, false)); });
      }
    } else {
      data.forEach(function(st){ list.appendChild(self._makeCard(st, uid, false)); });
    }
  },

  _makeCard(st, uid, featured){
    const card=document.createElement('div');
    card.className='yt-card'+(featured?' yt-featured':'');
    const diff=st.diff||1;
    const total=Object.values(st.enemyCounts||{}).reduce(function(a,b){return a+b;},0)||0;
    const age=this._ago(st.createdAt);
    const isMine=st.authorId===uid;
    const remain=st._expiresIn||0;
    const rh=Math.floor(remain/3600000);
    const rm=Math.floor((remain%3600000)/60000);
    const remainStr=rh>1?rh+'h':rh===1?'1h '+rm+'m':rm>0?rm+'m':'<1m';
    const urgentCol=rh<3?'#ff4455':'#ffc944';
    const bossIco=(st.boss&&st.boss.ico)||'üëæ';
    const diffCls=['diff-e','diff-n','diff-h','diff-x'][diff]||'diff-n';
    const diffLbl=['EASY','NORMAL','HARD','HELL'][diff]||'NORMAL';
    const diffCols=['#44ff88','#aaff00','#ffc944','#ff44aa'];
    // BG gradient based on diff
    const bgCols=[['#001a08','#003010'],['#0a0a00','#1a1800'],['#1a0800','#301000'],['#1a0018','#280020']];
    const bg=bgCols[diff]||bgCols[1];
    // Author icon (emoji from name)
    const authorIco=bossIco;
    card.innerHTML=
      '<div class="yt-thumb">'+
        '<div class="yt-thumb-bg" style="background:linear-gradient(135deg,'+bg[0]+','+bg[1]+');"></div>'+
        '<div class="yt-thumb-boss" style="color:'+(st.boss&&st.boss.col||'#00f5ff')+';">'+bossIco+'</div>'+
        '<div class="yt-thumb-diff"><span class="cm-diff-badge '+diffCls+'">'+diffLbl+'</span></div>'+
        '<div class="yt-thumb-dur" style="color:'+urgentCol+'">‚è±'+remainStr+'</div>'+
        '<div class="yt-thumb-play">‚ñ∂</div>'+
      '</div>'+
      '<div class="yt-info">'+
        '<div class="yt-author-ico">'+authorIco+'</div>'+
        '<div class="yt-meta">'+
          '<div class="yt-title">'+this._esc(st.name||'ÁÑ°Âêç„Çπ„ÉÜ„Éº„Ç∏')+'</div>'+
          '<div class="yt-sub">'+
            '<span>'+this._esc(st.author||'ÂåøÂêç')+'</span>'+
            ' ¬∑ '+'<span>üëæ '+total+'‰Ωì</span>'+
            ' ¬∑ '+'<span>üí¨ '+(st.commentCount||0)+'</span>'+
            ' ¬∑ '+'<span>‚ñ∂ '+(st.plays||0)+'Âõû</span>'+
            ' ¬∑ '+age+
          '</div>'+
        '</div>'+
      '</div>'+
      '<div class="yt-actions">'+
        '<div class="yt-desc">'+this._esc(st.desc||'')+'</div>'+
        (isMine?'<button class="yt-del-btn" id="ydel_'+st.id+'">üóë</button>':'')+
        '<button class="yt-play-btn" id="ydet_'+st.id+'">Ë©≥Á¥∞ ‚Ä∫</button>'+
      '</div>';
    // „Ç§„Éô„É≥„Éà„Éê„Ç§„É≥„Éâ
    const self=this;
    const detBtn=card.querySelector('#ydet_'+st.id);
    if(detBtn)detBtn.addEventListener('click',function(e){e.stopPropagation();self.openDetail(st.id);});
    const delBtn=card.querySelector('#ydel_'+st.id);
    if(delBtn)delBtn.addEventListener('click',function(e){e.stopPropagation();self.confirmDel(st.id);});
    // „Ç´„Éº„ÉâÂÖ®‰Ωì„ÇØ„É™„ÉÉ„ÇØ„ÅßË©≥Á¥∞
    card.addEventListener('click',function(){self.openDetail(st.id);});
    return card;
  },

  _esc(s){return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');},

  async confirmDel(id){
    if(!confirm('„Åì„ÅÆ„Çπ„ÉÜ„Éº„Ç∏„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü'))return;
    try{
      await window.storage.delete('community:'+id,true);
      await window.storage.delete('comments:'+id,true);
      try{
        let idx=[];const r=await window.storage.get('community_index',true);
        if(r)idx=JSON.parse(r.value);
        idx=idx.filter(function(i){return i!==id;});
        await window.storage.set('community_index',JSON.stringify(idx),true);
      }catch(e){}
      try{
        let mine=[];const r=await window.storage.get('my_stages');
        if(r)mine=JSON.parse(r.value);
        mine=mine.filter(function(i){return i!==id;});
        await window.storage.set('my_stages',JSON.stringify(mine));
      }catch(e){}
      this.stages=this.stages.filter(function(s){return s.id!==id;});
      const cnt=document.getElementById('cmCount');
      if(cnt)cnt.textContent=this.stages.length+'‰ΩúÂìÅ';
      this.render();
    }catch(e){alert('ÂâäÈô§„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');}
  },

  async openDetail(id){
    const st=this.stages.find(function(s){return s.id===id;});
    if(!st)return;
    this._stage=st;
    const uid=this.uid();
    const isMine=st.authorId===uid;
    const diff=st.diff||1;
    const total=Object.values(st.enemyCounts||{}).reduce(function(a,b){return a+b;},0)||0;
    document.getElementById('sdTitle').textContent=st.name||'ÁÑ°Âêç';
    document.getElementById('sdIco').textContent=(st.boss&&st.boss.ico)||'üëæ';
    document.getElementById('sdName').textContent=st.name||'ÁÑ°Âêç';
    document.getElementById('sdSub').textContent='by '+(st.author||'ÂåøÂêç')+' ¬∑ '+this._ago(st.createdAt);
    document.getElementById('sdDesc').textContent=st.desc||'Ë™¨Êòé„Å™„Åó';
    document.getElementById('sdMeta').innerHTML=
      '<span class="sd-tag cm-diff-badge '+DIFF_CLASSES[diff]+'">'+DIFF_LABELS[diff]+'</span>'+
      '<span class="sd-tag">üëæ '+total+'‰Ωì</span>'+
      '<span class="sd-tag">üíÄ '+((st.boss&&st.boss.name)||'?')+'</span>'+
      '<span class="sd-tag">‚ñ∂ '+(st.plays||0)+'Âõû</span>';
    document.getElementById('sdDelBtn').style.display=isMine?'block':'none';
    document.getElementById('sdPlayBtn').onclick=function(){CM.play(id);};
    // „Ç≥„É°„É≥„ÉàÂÖ•Âäõ„ÅßEnter„Ç≠„Éº
    const inp=document.getElementById('sdCmtInp');
    if(inp){inp.onkeydown=function(e){if(e.key==='Enter'){e.preventDefault();CM.sendComment();}};}
    UI.show('sStageDetail');
    await this.loadComments(id);
  },

  async delCurrent(){
    if(!this._stage)return;
    if(!confirm('„Åì„ÅÆ„Çπ„ÉÜ„Éº„Ç∏„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü'))return;
    await this.confirmDel(this._stage.id);
    UI.goCommunity();
  },

  async loadComments(stageId){
    const list=document.getElementById('sdCmtList');
    if(!list)return;
    list.innerHTML='<div class="cmt-empty">Ë™≠„ÅøËæº„Åø‰∏≠...</div>';
    try{
      let cmts=[];
      try{const r=await window.storage.get('comments:'+stageId,true);if(r)cmts=JSON.parse(r.value);}catch(e){}
      const cnt=document.getElementById('sdCmtCnt');
      if(cnt)cnt.textContent=cmts.length>0?'('+cmts.length+')':'';
      if(cmts.length===0){list.innerHTML='<div class="cmt-empty">„Åæ„Å†„Ç≥„É°„É≥„Éà„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div>';return;}
      const uid=this.uid();
      const self=this;
      list.innerHTML='';
      cmts.forEach(function(c,i){
        const isMine=c.uid===uid;
        const el=document.createElement('div');
        el.className='cmt-item';
        el.innerHTML=
          '<div class="cmt-head">'+
          '<span class="cmt-author">'+self._esc(c.author||'ÂåøÂêç')+'</span>'+
          '<span class="cmt-time">'+self._ago(c.ts)+'</span>'+
          (isMine?'<button class="cmt-del" id="cdel_'+i+'">‚úï</button>':'')+
          '</div>'+
          '<div class="cmt-body">'+self._esc(c.text)+'</div>';
        if(isMine){
          const db=el.querySelector('#cdel_'+i);
          if(db)db.addEventListener('click',function(){CM.delComment(stageId,i);});
        }
        list.appendChild(el);
      });
    }catch(e){list.innerHTML='<div class="cmt-empty">Ë™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü</div>';}
  },

  async sendComment(){
    const stageId=this._stage&&this._stage.id;
    if(!stageId)return;
    const inp=document.getElementById('sdCmtInp');
    const text=inp?(inp.value||'').trim():'';
    if(!text)return;
    const uid=this.uid();
    let author='ÂåøÂêç';
    try{const a=localStorage.getItem('sky_author');if(a)author=a;}catch(e){}
    try{const a=document.getElementById('edAuthor');if(a&&a.value.trim())author=a.value.trim();}catch(e){}
    try{
      let cmts=[];
      try{const r=await window.storage.get('comments:'+stageId,true);if(r)cmts=JSON.parse(r.value);}catch(e){}
      cmts.push({uid:uid,author:author,text:text,ts:Date.now()});
      if(cmts.length>100)cmts=cmts.slice(-100);
      await window.storage.set('comments:'+stageId,JSON.stringify(cmts),true);
      // „Ç≥„É°„É≥„ÉàÊï∞Êõ¥Êñ∞
      try{
        const sr=await window.storage.get('community:'+stageId,true);
        if(sr){const sd=JSON.parse(sr.value);sd.commentCount=cmts.length;await window.storage.set('community:'+stageId,JSON.stringify(sd),true);}
      }catch(e){}
      if(inp)inp.value='';
      await this.loadComments(stageId);
    }catch(e){alert('ÈÄÅ‰ø°„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');}
  },

  async delComment(stageId,idx){
    if(!confirm('„Ç≥„É°„É≥„Éà„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü'))return;
    try{
      let cmts=[];
      try{const r=await window.storage.get('comments:'+stageId,true);if(r)cmts=JSON.parse(r.value);}catch(e){}
      cmts.splice(idx,1);
      await window.storage.set('comments:'+stageId,JSON.stringify(cmts),true);
      try{
        const sr=await window.storage.get('community:'+stageId,true);
        if(sr){const sd=JSON.parse(sr.value);sd.commentCount=cmts.length;await window.storage.set('community:'+stageId,JSON.stringify(sd),true);}
      }catch(e){}
      await this.loadComments(stageId);
    }catch(e){alert('ÂâäÈô§„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');}
  },

  async play(id){
    const st=this._stage||this.stages.find(function(s){return s.id===id;});
    if(!st)return;
    try{st.plays=(st.plays||0)+1;await window.storage.set('community:'+id,JSON.stringify(st),true);}catch(e){}
    window._customStage=st;
    UI._stgIdx=-1;
    UI._selChar=SAV.hangar[0]||'p0';
    UI.show('sChar');
    UI.buildCharGrid();
  },

  _ago(ts){
    if(!ts)return '';
    const s=Math.floor((Date.now()-ts)/1000);
    if(s<60)return '„Åü„Å£„Åü‰ªä';
    if(s<3600)return Math.floor(s/60)+'ÂàÜÂâç';
    if(s<86400)return Math.floor(s/3600)+'ÊôÇÈñìÂâç';
    return Math.floor(s/86400)+'Êó•Ââç';
  },
};


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// „Éó„É≠„Ç∑„Éº„Ç∏„É£„É´ÁîüÊàê„Ç∑„Çπ„ÉÜ„É† ‚Äî „Ç≠„É£„É©√ó1000 + „Çπ„ÉÜ„Éº„Ç∏√ó1000
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// „Ç∑„Éº„Éâ‰ªò„Åç‰π±Êï∞ÔºàÊØéÂõûÂêå„Åò„Ç≠„É£„É©„ÅåÁîüÊàê„Åï„Çå„ÇãÔºâ
function seededRng(seed){
  let s=(seed^0x9e3779b9)>>>0;
  return function(){
    s=((s>>>16^s)*0x45d9f3b)>>>0;
    s=((s>>>16^s)*0x45d9f3b)>>>0;
    return((s>>>16^s)&0x7fffffff)/0x7fffffff;
  };
}

// ‚îÄ‚îÄ‚îÄ „Ç≠„É£„É© p200-p1199 (1000‰Ωì) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
(function generatePlanes(){
  const BS=['tri3','fan5','big3','fast3','wide5','rapid2','v5','bomb5','ring8','solar',
            'divine','apoc','cross4','helix','spiral','scatter','needle','wave','burst12','omega16'];
  const NA=['NOVA','TWIN','LASER','BLADE','DEATH','PLASMA','VOID','AQUA','TERRA','AERO',
    'PHOTON','DARK','HOLY','CHAOS','OMEGA','NEON','CRYSTAL','VOLT','FROST','SHADOW',
    'SOLAR','LUNAR','STAR','COSMIC','GALAXY','EMBER','STORM','IRON','RUNE','SOUL',
    'DREAM','CURSE','PRISM','ECHO','TITAN','RADIANT','ARCH','SPIKE','FLUX','ZENITH',
    'WRAITH','BLAZE','SURGE','DRIFT','BLOOM','FANG','CLAW','HORN','PULSE','WARP'];
  const NB=['HAWK','BLADE','BIRD','WING','ANGEL','DART','RAY','CLAW','SLASH','STORM',
    'RAIN','FIRE','WHIRL','PULSE','BURST','LANCE','SURGE','NOVA','FLARE','RAY',
    'STRIKE','FANG','DRILL','WAVE','BLAST','RING','BEAM','SPIRIT','RUSH','QUAKE',
    'SHOT','CROSS','SPIKE','SURGE','GALE','TIDE','TIDE','SABER','FURY','WRATH'];
  const IC=['üå∏','ü¶ã','üê¶','ü¶Ñ','üê≤','üå∫','üçÅ','üåô','üí´','‚ö°','üî•','‚ùÑÔ∏è','üåä','üåø','üåà',
    'üéØ','üîÆ','üßø','üåÄ','‚ôæÔ∏è','üî±','‚öúÔ∏è','üèÜ','üëÅÔ∏è','üåü','üíé','üí†','üî∑','üî∂','üü£',
    'ü¶ä','üê∫','ü¶Ö','ü¶Å','üêØ','üêª','ü¶ù','ü¶à','üêâ','ü¶ï','üåç','üåã','üóª','üåå','‚≠ê',
    '‚ú®','üå†','‚òÄÔ∏è','‚õÖ','‚õàÔ∏è','üå®Ô∏è','üå¨Ô∏è','üå™Ô∏è','üåà','üíß','üé¥','üÄÑ','üÉè','üé≤','‚öôÔ∏è',
    'üîë','üóùÔ∏è','üîí','‚öíÔ∏è','üî®','üîß','üî©','üåµ','üçÄ','üå¥','üå≤','üå≥','üêã','ü¶à','ü¶≠'];
  const SNA=['HYPER','TWIN','LASER','BLADE','DEATH','PLASMA','VOID','AQUA','TERRA','AERO',
    'PHOTON','DARK','HOLY','CHAOS','OMEGA','NEON','CRYSTAL','VOLT','FROST','SHADOW',
    'SOLAR','LUNAR','STAR','COSMIC','GALAXY','EMBER','STORM','IRON','RUNE','SOUL',
    'DREAM','CURSE','PRISM','ECHO','TITAN','RADIANT','ARCH','SPIKE','FLUX','ZENITH',
    'WRAITH','BLAZE','SURGE','DRIFT','BLOOM','FANG','PULSE','WARP','GALE','TIDE'];
  const SNB=['CANNON','LANCER','CROSS','RAIN','SPIRAL','NET','ARROW','BLAST','BREAK','SLASH',
    'STORM','FIRE','WHIRL','PULSE','BURST','LANCE','SURGE','NOVA','FLARE','RAY',
    'STRIKE','FANG','DRILL','WAVE','BLAST','RING','IMPLOSION','BEAM','SPIRIT','RUSH',
    'QUAKE','SPIKE','GALE','TIDE','SABER','FURY','WRATH','SURGE','STRIKE','WAVE'];
  const RBA=['„Éè„Ç§„Éë„Éº','„ÉÑ„Ç§„É≥','„É¨„Éº„Ç∂„Éº','„Éñ„É¨„Éº„Éâ','„Éá„Çπ','„Éó„É©„Ç∫„Éû','„É¥„Ç©„Ç§„Éâ','„Ç¢„ÇØ„Ç¢','„ÉÜ„É©','„Ç®„Ç¢„É≠',
    '„Éï„Ç©„Éà„É≥','„ÉÄ„Éº„ÇØ','„Éõ„Éº„É™„Éº','„Ç´„Ç™„Çπ','„Ç™„É°„Ç¨','„Éç„Ç™„É≥','„ÇØ„É™„Çπ„Çø„É´','„É¥„Ç©„É´„Éà','„Éï„É≠„Çπ„Éà','„Ç∑„É£„Éâ„Ç¶',
    '„ÇΩ„Éº„É©„Éº','„É´„Éä„Éº','„Çπ„Çø„Éº','„Ç≥„Ç∫„Éü„ÉÉ„ÇØ','„ÇÆ„É£„É©„ÇØ„Ç∑„Éº','„Ç®„É≥„Éê„Éº','„Çπ„Éà„Éº„É†','„Ç¢„Ç§„Ç¢„É≥','„É´„Éº„É≥','„ÇΩ„Ç¶„É´',
    '„Éâ„É™„Éº„É†','„Ç´„Éº„Çπ','„Éó„É™„Ç∫„É†','„Ç®„Ç≥„Éº','„Çø„Ç§„Çø„É≥','„É©„Éá„Ç£„Ç¢„É≥„Éà','„Ç¢„Éº„ÇØ','„Çπ„Éë„Ç§„ÇØ','„Éï„É©„ÉÉ„ÇØ„Çπ','„Çº„Éã„Çπ',
    '„É¨„Ç§„Çπ','„Éñ„É¨„Ç§„Ç∫','„Çµ„Éº„Ç∏','„Éâ„É™„Éï„Éà','„Éñ„É´„Éº„É†','„Éï„Ç°„É≥„Ç∞','„Éë„É´„Çπ','„ÉØ„Éº„Éó','„Ç≤„Ç§„É´','„Çø„Ç§„Éâ'];
  const RBB=['„Ç≠„É£„Éé„É≥','„É©„É≥„Çµ„Éº','„ÇØ„É≠„Çπ','„É¨„Ç§„É≥','„Çπ„Éë„Ç§„É©„É´','„Éç„ÉÉ„Éà','„Ç¢„É≠„Éº','„Éñ„É©„Çπ„Éà','„Éñ„É¨„Ç§„ÇØ','„Çπ„É©„ÉÉ„Ç∑„É•',
    '„Çπ„Éà„Éº„É†','„Éï„Ç°„Ç§„Ç¢','„ÉØ„Éº„É´','„Éë„É´„Çπ','„Éê„Éº„Çπ„Éà','„É©„É≥„Çπ','„Çµ„Éº„Ç∏','„Éé„É¥„Ç°','„Éï„É¨„Ç¢','„É¨„Ç§',
    '„Çπ„Éà„É©„Ç§„ÇØ','„Éï„Ç°„É≥„Ç∞','„Éâ„É™„É´','„Ç¶„Çß„Éº„Éñ','„Éñ„É©„Çπ„Éà','„É™„É≥„Ç∞','„Ç§„É≥„Éó„É≠„Éº„Ç∏„Éß„É≥','„Éì„Éº„É†','„Çπ„Éî„É™„ÉÉ„Éà','„É©„ÉÉ„Ç∑„É•',
    '„ÇØ„Ç®„Ç§„ÇØ','„Çπ„Éë„Ç§„ÇØ','„Ç≤„Ç§„É´','„Çø„Ç§„Éâ','„Çª„Ç§„Éê„Éº','„Éï„É•„Éº„É™„Éº','„É©„Éº„Çπ','„Çµ„Éº„Ç∏','„Çπ„Éà„É©„Ç§„ÇØ','„Ç¶„Çß„Éº„Éñ'];

  for(let i=0;i<1000;i++){
    const id='p'+(200+i);
    const rng=seededRng(200+i);
    const rv=rng();
    const r=rv<.25?1:rv<.55?2:rv<.80?3:rv<.95?4:5;
    const spd=Math.round(([0,1.7,2.1,2.5,2.9,3.3][r]+rng()*.3)*10)/10;
    const hp=[0,70,92,122,157,188][r]+Math.floor(rng()*22);
    const cd=[0,22,18,15,12,9][r];
    const hitR=r<=2?5:r<=4?6:7;
    const name=NA[Math.floor(rng()*NA.length)]+' '+NB[Math.floor(rng()*NB.length)];
    const ico=IC[Math.floor(rng()*IC.length)];
    const hue=Math.floor(rng()*360);
    const col='hsl('+hue+','+(60+Math.floor(rng()*40))+'%,'+(55+Math.floor(rng()*20))+'%)';
    const bStyle=BS[Math.floor(rng()*BS.length)];
    const spName=SNA[Math.floor(rng()*SNA.length)]+' '+SNB[Math.floor(rng()*SNB.length)];
    const spRb=RBA[Math.floor(rng()*RBA.length)]+RBB[Math.floor(rng()*RBB.length)];
    // ÂøÖÊÆ∫ÊäÄ„Éë„É©„É°„Éº„ÇøÔºàÂÖ®Âì°„É¶„Éã„Éº„ÇØÔºâ
    const spV=Math.floor(rng()*8); // 0-7: 8Á®Æ„ÅÆÂü∫Êú¨ÂΩ¢
    const spN=3+Math.floor(rng()*10); // Áô∫Â∞ÑÊï∞
    const spS=8+rng()*10; // ÈÄüÂ∫¶
    const spR=3+rng()*4; // Âºæ„Çµ„Ç§„Ç∫
    const spD=4+rng()*8; // „ÉÄ„É°„Éº„Ç∏‰øÇÊï∞
    const spC='hsl('+Math.floor(rng()*360)+',100%,65%)';
    const spA=rng()*Math.PI*2; // Âü∫Ê∫ñËßíÂ∫¶
    PLANES[id]={id,name,r,ico,col,spd,hp,cd,hitR,bStyle,
      sp:{name:spName,rb:spRb},
      _spV:spV,_spN:spN,_spS:spS,_spR:spR,_spD:spD,_spC:spC,_spA:spA,
      atk:Math.ceil(r*1.8+rng()*2),def:Math.ceil(r*1.5+rng()*2),spd_s:Math.ceil(r*1.6+rng()*2)};
  }
})();

// ‚îÄ‚îÄ‚îÄ „Çπ„ÉÜ„Éº„Ç∏ s9-s1008 (1000„Çπ„ÉÜ„Éº„Ç∏) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
(function generateStages(){
  const WR=['SECTOR DELTA','SECTOR EPSILON','SECTOR ZETA','VOID SECTOR','DARK NEBULA',
    'CRYSTAL FIELD','STORM SECTOR','COSMIC RIFT','PHANTOM ZONE','EMBER REGION',
    'FROST SECTOR','SOLAR WIND','BINARY STAR','SUPERNOVA ZONE','BLACK HOLE RIM',
    'GALACTIC CORE','OMEGA SECTOR','NEBULA ZONE','CHAOS REALM','FINAL FRONTIER'];
  const BNA=['IRON','DARK','VOID','FLAME','FROST','STORM','THUNDER','SHADOW','CRYSTAL','PLASMA',
    'OMEGA','NEON','SOLAR','LUNAR','STAR','COSMIC','GALACTIC','EMBER','RUNE','SOUL',
    'ABYSS','PRISM','PHANTOM','CHAOS','WRAITH','BLAZE','SURGE','DREAD','CURSE','TITAN'];
  const BNB=['TITAN','LORD','EMPEROR','KING','OVERLORD','DESTROYER','DEVOURER','TYRANT',
    'WARDEN','SENTINEL','COLOSSUS','HARBINGER','RAVAGER','SCOURGE','NEMESIS',
    'BEHEMOTH','LEVIATHAN','JUGGERNAUT','ANNIHILATOR','APOCALYPSE',
    'SOVEREIGN','DOMINION','ARCHON','NEXUS','VANGUARD','ARBITER','ORACLE','HERALD','WARLORD','SPECTER'];
  const BI=['üëæ','üî•','üßä','üåë','üíÄ','üåå','‚ö°','üåä','üåã','‚ùÑÔ∏è',
    'üå™Ô∏è','üí´','üîÆ','‚öîÔ∏è','üõ°Ô∏è','üêâ','üëπ','üå†','‚õß','üî¥',
    'üü†','üü°','üü¢','üîµ','üü£','‚ö´','‚ö™','üî∂','üî∑','üí¢'];

  for(let i=0;i<1000;i++){
    const rng=seededRng(9000+i);
    const id='s'+(9+i);
    const world=WR[Math.floor(i/50)%WR.length];
    const tier=Math.min(Math.floor(i/100),9);
    const bossHp=Math.round((500+tier*900+Math.floor(rng()*500))/15);
    const coins=1+Math.floor(tier/2);
    const bossName=BNA[Math.floor(rng()*BNA.length)]+' '+BNB[Math.floor(rng()*BNB.length)];
    const bossIco=BI[Math.floor(rng()*BI.length)];
    const hue=Math.floor(rng()*360);
    const bossCol='hsl('+hue+',100%,65%)';
    STAGES.push({id,name:'STAGE '+(9+i),world,
      boss:{name:bossName,ico:bossIco,hp:bossHp,col:bossCol},
      eC:['hsl('+hue+',80%,55%)','hsl('+((hue+40)%360)+',80%,55%)'],
      bg:['hsl('+hue+',60%,4%)','hsl('+((hue+30)%360)+',60%,7%)'],
      coins});
  }
})();

// ‚îÄ‚îÄ‚îÄ „É¶„Éã„Éº„ÇØÂøÖÊÆ∫ÊäÄ (_spV ÂØæÂøú) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
(function patchTriggerSp(){
  const _orig=BAT.triggerSp.bind(BAT);
  BAT.triggerSp=function(){
    if(PL.sp<cSpCost)return;
    if(CH._spV===undefined){_orig();return;}
    PL.sp=0;BAT.updHud();
    const v=CH._spV,n=CH._spN||6,s=CH._spS||10,r2=CH._spR||4,d=CH._spD||6;
    const col=CH._spC||CH.col,a0=CH._spA||0;
    const B=(vx,vy,sz,c)=>({x:PL.x,y:PL.y,vx,vy,col:c||col,r:sz||r2,dm:d*cDmg});
    switch(v){
      case 0:// ÂâçÊñπÊâáÂΩ¢
        for(let i=0;i<n;i++){const a=-Math.PI/2+(i-(n-1)/2)*.2;bullets.push(B(Math.cos(a)*s,Math.sin(a)*s));}break;
      case 1:// ÂÖ®Êñπ‰Ωç
        for(let i=0;i<n;i++){const a=a0+i/n*Math.PI*2;bullets.push(B(Math.cos(a)*s,Math.sin(a)*s));}break;
      case 2:// Ëû∫Êóã
        for(let i=0;i<n*3;i++){const a=a0+i/(n)*Math.PI*4;const sp2=s*(0.4+i/(n*3)*.8);bullets.push(B(Math.cos(a)*sp2,Math.sin(a)*sp2,r2*.8));}break;
      case 3:// ËøΩÂ∞æ
        {const tgts=enemies.slice(0,Math.min(n,8));
        if(tgts.length===0){for(let i=0;i<n;i++){const a=-Math.PI/2+(i-(n-1)/2)*.2;bullets.push(B(Math.cos(a)*s,Math.sin(a)*s));}}
        else tgts.forEach(e=>{const a=Math.atan2(e.y-PL.y,e.x-PL.x);bullets.push(B(Math.cos(a)*s*1.2,Math.sin(a)*s*1.2,r2+2));});
        break;}
      case 4:// 2Èáç„É™„É≥„Ç∞
        for(let ring=0;ring<2;ring++)for(let i=0;i<n;i++){const a=a0+i/n*Math.PI*2+ring*.28;bullets.push(B(Math.cos(a)*s*(1+ring*.4),Math.sin(a)*s*(1+ring*.4),r2-ring));}break;
      case 5:// È´òÈÄü„É¨„Éº„Ç∂„Éº
        for(let i=0;i<n;i++)bullets.push(B(rnd(-.4,.4),-s*1.7,r2*.6,col));break;
      case 6:// Ê≥¢Áä∂
        for(let i=0;i<n;i++){const a=-Math.PI/2+Math.sin(i*.6)*.55;bullets.push(B(Math.cos(a)*s,Math.sin(a)*s));}break;
      case 7:// Ëôπ‰π±Â∞Ñ
        for(let i=0;i<n+4;i++)bullets.push(B(rnd(-s*.6,s*.6),-s*rnd(.7,1.2),r2,'hsl('+Math.floor(rnd(0,360))+',100%,65%)'));break;
    }
    BAT.showSpOv(CH.sp.name,CH.sp.rb,col);
    BAT.flash(hA(col,.38),50);
    BAT.pt(PL.x,PL.y,col,28,true);
    tSp=false;
  };
})();

// ‚îÄ‚îÄ‚îÄ GTABLEÊã°Âºµ (p200-p1199) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
(function(){
  for(let i=0;i<1000;i++){
    const id='p'+(200+i);
    const pl=PLANES[id];if(!pl)continue;
    const w=pl.r===1?2:pl.r===2?4:pl.r===3?7:pl.r===4?11:18;
    GTABLE.push({w,tp:'p',id});
  }
})();

// ‚îÄ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
resizeGame();
// Give browser time to compute layout
setTimeout(resizeGame, 50);
UI.updCoins();
UI.updRainbow();
UI.goMenu();
UI._bnSelect('bnBattle');
// Android hardware back button via popstate
try{window.addEventListener('popstate', (e)=>{
  try{
    const scr = e.state&&e.state.screen;
    if(!scr){UI.goMenu();return;}
    if(scr==='sMenu')UI.goMenu();
    else if(scr==='sStage')UI.goStage();
    else if(scr==='sGacha')UI.goGacha();
    else if(scr==='sChar')UI.show('sChar');
    else if(scr==='sBattle'){}
    else if(scr==='sTutorial')TUT.start();
    else UI.goMenu();
  }catch(e2){}
});}catch(e){}


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  TUTORIAL CONTROLLER (‰øÆË°å„É¢„Éº„Éâ)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const TUT = {
  step: 0,
  totalSteps: 10,
  plX: 180, plY: 400, plVx: 0, plVy: 0,
  tBullets: [], tEnemies: [], tParts: [],
  tFrame: 0, tKeys: {}, tShootHeld: false, tSpUsed: false,
  tSp: 0, tSpMax: 100, tCd: 0,
  raf: null, cvs: null, ctx: null,
  demoPlane: 'p0',

  STEPS: [
    // 0: „Çà„ÅÜ„Åì„Åù
    {
      top: 70, msg: '<div class="tmsg-head">ü•ã ‰øÆË°å„É¢„Éº„Éâ„Å∏„Çà„ÅÜ„Åì„Åù</div><div class="tmsg-body">SKY RAIDERS„ÅÆÊìç‰Ωú„Çí<b>ÂÆüÈöõ„Å´Âãï„Åã„Åó„Å™„Åå„Çâ</b>Â≠¶„Åº„ÅÜÔºÅ<br>ÂÖ®8„Çπ„ÉÜ„ÉÉ„Éó„ÅßÂÆåÂÖ®„Éû„Çπ„Çø„Éº„Åß„Åç„Çã„Åû„ÄÇ<br><br>„ÄåÊ¨°„Å∏„Äç„ÇíÊäº„Åó„Å¶Âßã„ÇÅ„Çà„ÅÜ„ÄÇ</div>',
      highlight: null, arrow: null, action: null
    },
    // 1: ÁßªÂãï
    {
      top: 70, msg: '<div class="tmsg-head">‚ë† ÁßªÂãï„Åô„Çã</div><div class="tmsg-body">Â∑¶„ÅÆ<b>ÊñπÂêë„Éú„Çø„É≥Ôºà‚Üë‚Üì‚Üê‚ÜíÔºâ</b>„ÅßÊ©ü‰Ωì„ÇíÂãï„Åã„Åõ„Çã„ÄÇ<br>„Çπ„Éû„Éõ„Å™„Çâ<b>„Ç≠„É£„É≥„Éê„Çπ„Çí„Éâ„É©„ÉÉ„Ç∞</b>„Åó„Å¶„ÇÇÂãï„ÅèÔºÅ<br><br><em>‚¨á ÂÆüÈöõ„Å´Âãï„Åã„Åó„Å¶„Åø„Çà„ÅÜÔºÅ</em></div>',
      highlight: 'dpad2', arrow: {x:100, y:270}, action: 'move',
      check: (t) => t._moved
    },
    // 2: Â∞ÑÊíÉ
    {
      top: 70, msg: '<div class="tmsg-head">‚ë° Â∞ÑÊíÉ„Åô„Çã</div><div class="tmsg-body">Âè≥„ÅÆ<b>üí• FIRE</b>„Éú„Çø„É≥„Çí<b>Èï∑Êäº„Åó</b>„ÅßÈÄ£Á∂öÂ∞ÑÊíÉÔºÅ<br>„Ç≠„Éº„Éú„Éº„Éâ„Å™„Çâ<b>„Çπ„Éö„Éº„Çπ„Ç≠„Éº</b>„Åß„ÇÇOK„ÄÇ<br><br><em>‚¨á ÁöÑ„Å´ÂΩì„Å¶„Çà„ÅÜÔºÅËµ§„ÅÑ‰∏∏„ÅåÁôªÂ†¥„Åô„Çã„Çà</em></div>',
      highlight: 'tFire', arrow: null, action: 'shoot',
      check: (t) => t._shot >= 3
    },
    // 3: ÊïµÂºæ„ÇíÈÅø„Åë„Çã
    {
      top: 70, msg: '<div class="tmsg-head">‚ë¢ Âºæ„ÇíÈÅø„Åë„Çã</div><div class="tmsg-body">Êïµ„ÅØ<b>„Ç´„É©„Éï„É´„Å™ÂºæÂπï</b>„ÇíÊíÉ„Å£„Å¶„Åè„Çã„ÄÇ<br>ÂΩì„Åü„Çã„Å®<b>HPÔºàËµ§„Éê„ÉºÔºâ</b>„ÅåÊ∏õ„ÇãÔºÅ<br><b>ÁÑ°ÊïµÊôÇÈñì</b>ÔºàÁÇπÊªÖ‰∏≠Ôºâ„ÅØÂΩì„Åü„Å£„Å¶„ÇÇÂ§ß‰∏àÂ§´„ÄÇ<br><br><em>‚¨á ÂºæÂπï„ÇíÈÅø„Åë„Å¶„Åø„Çà„ÅÜÔºÅ</em></div>',
      highlight: null, arrow: null, action: 'dodge',
      check: (t) => t._dodged
    },
    // 4: HP„Å®SP
    {
      top: 70, msg: '<div class="tmsg-head">‚ë£ HP „Å® SP „Éê„Éº</div><div class="tmsg-body"><b>HPÔºàÈùí‚Üí„Ç∑„Ç¢„É≥Ôºâ</b>ÔºöÊÆã„Çä‰ΩìÂäõ„ÄÇ0„Åß„Ç≤„Éº„É†„Ç™„Éº„Éê„Éº„ÄÇ<br><b>SPÔºàÈªÑ‚ÜíÊ©ôÔºâ</b>ÔºöÂøÖÊÆ∫ÊäÄ„Ç≤„Éº„Ç∏„ÄÇ<br>Â∞ÑÊíÉ„Åó„Åü„ÇäÊïµ„Å´ÂΩì„Å¶„Çã„Å®<b>SP</b>„ÅåÊ∫ú„Åæ„ÇãÔºÅ<br><br><em>‚¨á Â∞ÑÊíÉ„Åó„Å¶SP„ÇíÊ∫ú„ÇÅ„Çà„ÅÜ</em></div>',
      highlight: null, arrow: null, action: 'chargesp',
      check: (t) => t.tSp >= 40
    },
    // 5: ÂøÖÊÆ∫ÊäÄ
    {
      top: 70, msg: '<div class="tmsg-head">‚ë§ ÂøÖÊÆ∫ÊäÄÔºÅ</div><div class="tmsg-body">SP„ÅåÊ∫Ä„Çø„É≥„Å´„Å™„Å£„Åü„Çâ<b>‚ö° SPECIAL</b>„Éú„Çø„É≥ÔºÅ<br>„Ç≠„É£„É©„Åî„Å®„Å´<b>100Á®ÆÈ°û</b>„ÅÆÂÖ®„ÅèÈÅï„ÅÜÂøÖÊÆ∫ÊäÄ„ÅåÁô∫ÂãïÔºÅ<br>„Éú„ÇπÊà¶„Åß‰Ωø„ÅÜ„Å®Ë∂ÖÂº∑Âäõ„ÄÇ<br><br><em>‚¨á SPECIAL„Çí‰Ωø„Å£„Å¶„Åø„Çà„ÅÜÔºÅ</em></div>',
      highlight: 'tSp2', arrow: null, action: 'special',
      check: (t) => t._spUsed
    },
    // 6: „Éú„ÇπÂá∫Áèæ
    {
      top: 70, msg: '<div class="tmsg-head">‚ë• „Éú„ÇπÂá∫ÁèæÔºÅ</div><div class="tmsg-body">„Çπ„ÉÜ„Éº„Ç∏ÂÜÖ„ÅÆ<b>Êïµ„ÅÆ40%</b>„ÇíÂÄí„Åô„Å®<b>BOSS</b>„ÅåÂá∫ÁèæÔºÅ<br>„Éú„Çπ„ÅØ<b>ÊøÄÊÄí„É¢„Éº„Éâ</b>ÔºàHP40%‰ª•‰∏ãÔºâ„Å´„Å™„Çã„Å®<br>„Åï„Çâ„Å´ÊøÄ„Åó„ÅÑÂºæÂπï„Å´„Å™„ÇãÔºÅ<br><br>„Éú„Çπ„ÅÆHP„ÅØ‰∏äÈÉ®„ÅÆ<em>Ëµ§„ÅÑ„Éê„Éº</em>„ÅßÁ¢∫Ë™ç„Åß„Åç„Çã„ÄÇ</div>',
      highlight: null, arrow: null, action: 'info',
      check: null
    },
    // 7: „Ç¨„ÉÅ„É£„Éª„Çπ„ÉÜ„Éº„Ç∏
    {
      top: 70, msg: '<div class="tmsg-head">‚ë¶ „Ç¨„ÉÅ„É£ÔºÜ„Çπ„ÉÜ„Éº„Ç∏</div><div class="tmsg-body">üé∞ <b>„Ç¨„ÉÅ„É£</b>ÔºöÈâÑ„ÅÆÊ¨†Áâá1ÂÄã„Åß1ÂõûÂºï„Åë„Çã„ÄÇ<br>Êñ∞„Åó„ÅÑ„Ç≠„É£„É©„ÇØ„Çø„ÉºÔºà<b>100Á®ÆÔºÅ</b>Ôºâ„ÇÑ<br>Âº∑Âåñ„Ç¢„Ç§„ÉÜ„É†„ÅåÊâã„Å´ÂÖ•„Çã„ÄÇ<br><br>‚öî <b>Êà¶Èóò</b>ÔºöÂÖ®8„Çπ„ÉÜ„Éº„Ç∏„ÄÇ<br>Ââç„ÅÆ„Çπ„ÉÜ„Éº„Ç∏„Çí„ÇØ„É™„Ç¢„Åô„Çã„Å®Ê¨°„ÅåËß£ÊîæÔºÅ</div>',
      highlight: null, arrow: null, action: 'info',
      check: null
    },
    // 8: „Çπ„ÉÜ„Éº„Ç∏„Çí‰Ωú„Çã
    {
      top: 70,
      msg: '<div class="tmsg-head">‚ëß „Çπ„ÉÜ„Éº„Ç∏„Çí‰Ωú„Çã</div><div class="tmsg-body">„É°„Éã„É•„Éº„ÅÆ<b>üõ† ‰Ωú„Çã</b>„Éú„Çø„É≥„Åã„ÇâËá™ÂàÜ„Å†„Åë„ÅÆ<b>„Ç™„É™„Ç∏„Éä„É´„Çπ„ÉÜ„Éº„Ç∏</b>„Çí‰Ωú„Çã„Åì„Å®„Åå„Åß„Åç„Åæ„ÅôÔºÅ<br><br>„ÉªÊïµ„ÅÆÁ®ÆÈ°û„Å®Êï∞„ÇíË®≠ÂÆö<br>„Éª„Éú„Çπ„ÇíÈÅ∏Êäû<br>„ÉªÈõ£ÊòìÂ∫¶„ÉªËÉåÊôØ„ÇíÊ±∫„ÇÅ„Çã<br><br><b>ÂÖ¨Èñã„Éú„Çø„É≥</b>„ÇíÊäº„Åô„Å®‰∏ñÁïå‰∏≠„ÅÆ„Éó„É¨„Ç§„É§„Éº„Å´ÂÖ¨Èñã„Åï„Çå„Åæ„ÅôÔºÅ</div>',
      highlight: null, arrow: null, action: 'info', check: null
    },
    // 9: „Åø„Çì„Å™„ÅÆ„Ç≤„Éº„É†
    {
      top: 70,
      msg: '<div class="tmsg-head">‚ë® „Åø„Çì„Å™„ÅÆ„Ç≤„Éº„É†</div><div class="tmsg-body">„É°„Éã„É•„Éº„ÅÆ<b>üåç „Åø„Çì„Å™</b>„Åã„Çâ‰∏ñÁïå‰∏≠„ÅÆ„Éó„É¨„Ç§„É§„Éº„Åå‰Ωú„Å£„Åü„Çπ„ÉÜ„Éº„Ç∏„ÅßÈÅä„Åπ„Åæ„ÅôÔºÅ<br><br>„Éª‰ªñ„ÅÆ„Éó„É¨„Ç§„É§„Éº„ÅÆ„Çπ„ÉÜ„Éº„Ç∏„Çí<b>„Éó„É¨„Ç§</b>„Åß„Åç„Çã<br>„Éª<b>„Ç≥„É°„É≥„Éà</b>„ÇíÊõ∏„ÅÑ„Å¶ÊÑüÊÉ≥„Çí‰ºù„Åà„Çà„ÅÜ<br>„Éª„Çπ„ÉÜ„Éº„Ç∏„ÅØ<b>24ÊôÇÈñì</b>„ÅßËá™ÂãïÂâäÈô§„Åï„Çå„Åæ„Åô<br><br>„Å©„Çì„Å©„ÇìÈÅä„Çì„Åß<b>„Ç≥„É°„É≥„Éà</b>„Åó„Çà„ÅÜÔºÅ</div>',
      highlight: null, arrow: null, action: 'info', check: null
    },
    // 7: „Åæ„Å®„ÇÅ
    {
      top: 70, msg: '<div class="tmsg-head">‚ëß Ê∫ñÂÇôÂÆå‰∫ÜÔºÅ</div><div class="tmsg-body">Êìç‰Ωú„ÅØ„Éê„ÉÉ„ÉÅ„É™ÔºÅ<br>„Çπ„ÉÜ„Éº„Ç∏„Çí„ÇØ„É™„Ç¢„Åó„Å¶<b>ÈâÑ„ÅÆÊ¨†Áâá</b>„ÇíÈõÜ„ÇÅ<br>„Ç¨„ÉÅ„É£„ÅßÂº∑„ÅÑ„Ç≠„É£„É©„ÇíÂºï„ÅÑ„Å¶„Éú„Çπ„ÇíÂÄí„Åù„ÅÜÔºÅ<br><br><em>„Äå‰øÆË°åÂÆå‰∫ÜÔºÅ„Äç„ÇíÊäº„Åó„Å¶„Ç≤„Éº„É†„Å∏ÔºÅ</em></div>',
      highlight: null, arrow: null, action: 'finish',
      check: null
    },
  ],

  start() {
    UI.show('sTutorial');
    this.step = 0;
    this.tBullets = []; this.tEnemies = []; this.tParts = [];
    this.tFrame = 0; this._moved = false; this._shot = 0;
    this._dodged = false; this._spUsed = false; this.tSp = 0; this.tCd = 0;
    this.plX = W/2||180; this.plY = (H||620)*.62; this.plVx = 0; this.plVy = 0;
    this.cvs = document.getElementById('tutCvs');
    this.ctx = this.cvs.getContext('2d');
    this.bindTutControls();
    this.showStep(0);
    if(this.raf) cancelAnimationFrame(this.raf);
    this._loop();
  },

  showStep(n) {
    this.step = n;
    const s = this.STEPS[n];
    if(!s) { this.complete(); return; }

    // „Çπ„ÉÜ„ÉÉ„Éó„Ç§„É≥„Ç∏„Ç±„Éº„Çø„ÉºÊõ¥Êñ∞
    for(let i=0; i<this.totalSteps; i++){
      let el = document.getElementById('ts'+i);
      if(!el) continue;
      el.className = 'tst' + (i<n?' done':i===n?' cur':'');
    }

    // „É°„ÉÉ„Çª„Éº„Ç∏Ë°®Á§∫
    const msg = document.getElementById('tutMsg');
    msg.innerHTML = '<div class="tmsg-box">'+s.msg+'</div>';
    msg.style.top = s.top + 'px';

    // „Éè„Ç§„É©„Ç§„Éà
    const hl = document.getElementById('tutHighlight');
    if(s.highlight) {
      const el = document.getElementById(s.highlight);
      if(el) {
        const r = el.getBoundingClientRect();
        const gr = document.getElementById('G').getBoundingClientRect();
        hl.style.display = 'block';
        hl.style.left = (r.left - gr.left - 4) + 'px';
        hl.style.top = (r.top - gr.top - 4) + 'px';
        hl.style.width = (r.width + 8) + 'px';
        hl.style.height = (r.height + 8) + 'px';
      }
    } else {
      hl.style.display = 'none';
    }

    // Ê¨°„Å∏„Éú„Çø„É≥
    const nb = document.getElementById('tutNext');
    if(n === this.totalSteps - 1) {
      nb.textContent = 'ÂÆå‰∫Ü ‚úì';
    } else if(s.check) {
      nb.textContent = '„ÇÑ„Å£„Å¶„Åø„Çà„ÅÜ ‚Üì';
    } else {
      nb.textContent = 'Ê¨°„Å∏ ‚Üí';
    }

    // „Ç¢„ÇØ„Ç∑„Éß„É≥Âà•„ÅÆÂàùÊúüÂåñ
    this.tBullets = []; this.tEnemies = [];
    this._moved = false; this._shot = 0; this._dodged = false; this._spUsed = false;
    if(s.action === 'shoot' || s.action === 'dodge' || s.action === 'chargesp' || s.action === 'special') {
      this._spawnTutEnemy(s.action);
    }
    if(s.action === 'special') {
      this.tSp = this.tSpMax; // SP„ÇíÊ∫Ä„Çø„É≥„Å´„Åó„Å¶‰ΩìÈ®ì
    }
  },

  _spawnTutEnemy(action) {
    const C = ['#ff2244','#00f5ff','#ffcc00','#aa44ff','#44ff88','#ff8800'];
    if(action === 'shoot') {
      // ÁöÑÔºàÈùôÊ≠¢„Åó„ÅüÊïµÔºâ„ÇíÈÖçÁΩÆ
      for(let i=0;i<4;i++) {
        this.tEnemies.push({x:60+i*70, y:180, hp:3, mhp:3, r:16, col:C[i%C.length], vx:0, vy:0, sT:999, t:'target'});
      }
    } else if(action === 'dodge') {
      this.tEnemies.push({x:180, y:120, hp:10, mhp:10, r:18, col:'#ff2244', vx:1.2, vy:0, sT:40, t:'shooter'});
    } else if(action === 'chargesp') {
      for(let i=0;i<3;i++) {
        this.tEnemies.push({x:80+i*90, y:150+i*30, hp:5, mhp:5, r:14, col:C[i%C.length], vx:(i-.5)*.8, vy:.5, sT:80, t:'mover'});
      }
    } else if(action === 'special') {
      for(let i=0;i<6;i++) {
        this.tEnemies.push({x:40+i*48, y:100+Math.sin(i)*30, hp:8, mhp:8, r:14, col:C[i%C.length], vx:Math.cos(i)*.6, vy:.4, sT:60, t:'mover'});
      }
    }
  },

  next() {
    const s = this.STEPS[this.step];
    if(s && s.check && !s.check(this)) {
      // „Ç¢„ÇØ„Ç∑„Éß„É≥„ÅåÊú™ÂÆå‰∫Ü„ÅÆÂ†¥Âêà„ÅØ„Éí„É≥„Éà
      const nb = document.getElementById('tutNext');
      nb.textContent = '„ÇÇ„ÅÜÂ∞ë„ÅóÔºÅ';
      setTimeout(()=>{ nb.textContent = s.check(this)?'Ê¨°„Å∏ ‚Üí':'„ÇÑ„Å£„Å¶„Åø„Çà„ÅÜ ‚Üì'; },800);
      return;
    }
    if(this.step >= this.STEPS.length - 1) { this.complete(); return; }
    this.showStep(this.step + 1);
  },

  skip() { this.complete(); },

  complete() {
    document.getElementById('tutComplete').style.display = 'flex';
    if(this.raf) { cancelAnimationFrame(this.raf); this.raf = null; }
  },

  finish() {
    document.getElementById('tutComplete').style.display = 'none';
    UI.goMenu();
  },

  _loop() {
    if(UI.cur !== 'sTutorial') return;
    this.raf = requestAnimationFrame(() => this._loop());
    this._update();
    this._draw();
  },

  _update() {
    if(!this.cvs) return;
    this.tFrame++;
    const s = this.STEPS[this.step];
    if(!s) return;

    // „Éó„É¨„Ç§„É§„ÉºÁßªÂãï
    const AC=0.52, DC=0.78, SPD=3.0;
    let ix=0,iy=0;
    if(this.tKeys['_U']||this.tKeys['ArrowUp']){iy=-1;}
    if(this.tKeys['_D']||this.tKeys['ArrowDown']){iy=1;}
    if(this.tKeys['_L']||this.tKeys['ArrowLeft']){ix=-1;}
    if(this.tKeys['_R']||this.tKeys['ArrowRight']){ix=1;}
    if(this._tDrag){ix=clamp(this._tDragDx/40,-1,1);iy=clamp(this._tDragDy/40,-1,1);}
    if(ix||iy){this._moved=true;}
    if(ix&&iy){ix*=.707;iy*=.707;}
    if(ix)this.plVx=clamp(this.plVx+ix*AC,-SPD,SPD); else{this.plVx*=DC;if(Math.abs(this.plVx)<.05)this.plVx=0;}
    if(iy)this.plVy=clamp(this.plVy+iy*AC,-SPD,SPD); else{this.plVy*=DC;if(Math.abs(this.plVy)<.05)this.plVy=0;}
    this.plX=clamp(this.plX+this.plVx,12,(this.cvs?this.cvs.width:360)-12);
    this.plY=clamp(this.plY+this.plVy,12,450);

    // Â∞ÑÊíÉ
    this.tCd--;
    if((this.tKeys['_fire']||this.tKeys[' '])&&this.tCd<=0) {
      this._shot++;
      this.tCd=18;
      this.tBullets.push({x:this.plX,y:this.plY,vy:-10,col:'#00f5ff',r:4,dm:1});
      this.tSp=Math.min(this.tSpMax,this.tSp+3);
    }

    // ÂºæÁßªÂãï
    this.tBullets=this.tBullets.filter(b=>{b.y+=b.vy||0;b.x+=(b.vx||0);return b.y>-30&&b.y<640;});

    // ÊïµÁßªÂãï„ÉªÂ∞ÑÊíÉ
    this.tEnemies.forEach(e=>{
      e.x+=e.vx;e.y+=e.vy;
      if(e.x<20||e.x>340)e.vx=-e.vx;
      if(e.y<60)e.y=60;
      e.sT--;
      if(e.sT<=0&&e.t!=='target'){
        const a=Math.atan2(this.plY-e.y,this.plX-e.x);
        const spd=1.8;
        const C=['#ff2244','#ffcc00','#aa44ff','#00f5ff','#ff8800','#44ff88'];
        for(let i=0;i<3;i++){
          const da=(i-1)*.22;
          this.tBullets.push({x:e.x,y:e.y,vx:Math.cos(a+da)*spd,vy:Math.sin(a+da)*spd,col:C[Math.floor(Math.random()*C.length)],r:4,enemy:true});
        }
        e.sT=Math.max(40,80-this.tFrame*.02|0);
      }
    });

    // ÂºævsÊïµ
    this.tBullets.forEach(b=>{
      if(b.enemy)return;
      this.tEnemies.forEach(e=>{
        if(e.hp>0&&hit(b.x,b.y,b.r,e.x,e.y,e.r)){
          e.hp--;b.y=-9999;this.tSp=Math.min(this.tSpMax,this.tSp+6);
          this._shot=Math.max(this._shot,1);
          for(let i=0;i<6;i++){let aa=rnd(0,Math.PI*2),sp=rnd(1,4);this.tParts.push({x:e.x,y:e.y,vx:Math.cos(aa)*sp,vy:Math.sin(aa)*sp,life:1,dc:.06,r:rnd(1,3),col:e.col});}
        }
      });
    });
    this.tEnemies=this.tEnemies.filter(e=>e.hp>0);
    this.tBullets=this.tBullets.filter(b=>b.y>-9000);

    // Ë¢´ÂºæÂà§ÂÆöÔºàdodgeÁ∑¥ÁøíÊôÇÔºâ
    if(s.action==='dodge'&&!this._dodged) {
      let safe=true;
      this.tBullets.forEach(b=>{if(b.enemy&&hit(this.plX,this.plY,8,b.x,b.y,b.r)){safe=false;}});
      if(this.tFrame>120&&safe)this._dodged=true;
    }

    // Ëá™Âãï„É™„Çπ„Éù„Éº„É≥ÔºàÊïµ„ÅåÂÖ®ÊªÖ„Åó„Åü„ÇâÔºâ
    if(this.tEnemies.length===0&&(s.action==='shoot'||s.action==='dodge'||s.action==='chargesp'||s.action==='special')&&this.tFrame%120===0){
      this._spawnTutEnemy(s.action);
    }

    // „Éë„Éº„ÉÜ„Ç£„ÇØ„É´
    this.tParts.forEach(p=>{p.x+=p.vx;p.y+=p.vy;p.life-=p.dc;});
    this.tParts=this.tParts.filter(p=>p.life>0);

    // „ÄåÊ¨°„Å∏„Äç„Éú„Çø„É≥Êõ¥Êñ∞
    if(s.check&&s.check(this)){
      document.getElementById('tutNext').textContent='Ê¨°„Å∏ ‚Üí';
    }
  },

  _draw() {
    if(!this.ctx||!this.cvs) return;
    const c=this.ctx;
    const tw=this.cvs.width,th=this.cvs.height;
    c.clearRect(0,0,tw,th);

    // ËÉåÊôØ
    c.fillStyle='#02040c';c.fillRect(0,0,tw,th);
    // Êòü
    for(let i=0;i<50;i++){
      c.globalAlpha=.08+.08*Math.sin(this.tFrame*.02+i);
      c.fillStyle='#ffffff';c.fillRect((i*73)%tw,(i*47+this.tFrame*.3)%(th*.76),1.2,1.2);
    }
    c.globalAlpha=1;

    // HUDÔºà„ÉÅ„É•„Éº„Éà„É™„Ç¢„É´Áî®Ôºâ
    const hp=1.0,sp=Math.min(1,this.tSp/this.tSpMax);
    c.fillStyle='rgba(0,2,10,.85)';c.fillRect(0,0,tw,36);
    c.fillStyle='#080e18';c.fillRect(10,9,110,6);
    c.fillStyle='#00f5ff';c.fillRect(10,9,110*hp,6);
    c.fillStyle='#080e18';c.fillRect(10,20,72,5);
    c.fillStyle=sp>=1?'#ffc944':'#ff8800';c.fillRect(10,20,72*sp,5);
    c.font='7px Orbitron,monospace';c.fillStyle='#2a4060';
    c.fillText('HP',10,8);c.fillText('SP',10,19);
    c.fillStyle=sp>=1?'#ffc944':'#4a6080';
    c.font='bold 14px Orbitron,monospace';
    c.textAlign='right';c.fillText('SP '+(sp>=1?'READY!':Math.floor(sp*100)+'%'),tw-10,18);
    c.textAlign='left';

    // Êïµ
    this.tEnemies.forEach(e=>{
      c.save();c.shadowBlur=14;c.shadowColor=e.col;c.fillStyle=e.col;
      if(e.t==='target'){
        c.beginPath();c.arc(e.x,e.y,e.r,0,Math.PI*2);c.fill();
        c.fillStyle='rgba(0,0,0,.6)';c.beginPath();c.arc(e.x,e.y,e.r*.5,0,Math.PI*2);c.fill();
        // HP„Éê„Éº
        c.fillStyle='#080e18';c.fillRect(e.x-16,e.y-e.r-8,32,4);
        c.fillStyle=e.col;c.fillRect(e.x-16,e.y-e.r-8,32*e.hp/e.mhp,4);
      } else {
        c.beginPath();c.moveTo(e.x,e.y-e.r);c.lineTo(e.x-e.r,e.y+e.r);c.lineTo(e.x+e.r,e.y+e.r);c.closePath();c.fill();
      }
      c.restore();
    });

    // „Éó„É¨„Ç§„É§„ÉºÂºæ
    this.tBullets.forEach(b=>{
      c.save();c.shadowBlur=b.enemy?18:10;c.shadowColor=b.col;
      // Êù±Êñπ„Çπ„Çø„Ç§„É´ÔºöÊïµÂºæ„ÅØÂÖâËº™+„Ç≥„Ç¢
      if(b.enemy){
        c.globalAlpha=.3;c.fillStyle=b.col;c.beginPath();c.arc(b.x,b.y,b.r*1.8,0,Math.PI*2);c.fill();
        c.globalAlpha=.6;c.beginPath();c.arc(b.x,b.y,b.r*1.1,0,Math.PI*2);c.fill();
        c.globalAlpha=1;c.fillStyle='#fff';c.beginPath();c.arc(b.x,b.y,b.r*.4,0,Math.PI*2);c.fill();
      } else {
        c.globalAlpha=1;c.fillStyle=b.col;c.beginPath();c.arc(b.x,b.y,b.r,0,Math.PI*2);c.fill();
      }
      c.restore();
    });

    // „Éë„Éº„ÉÜ„Ç£„ÇØ„É´
    this.tParts.forEach(p=>{c.save();c.globalAlpha=p.life*.9;c.fillStyle=p.col;c.beginPath();c.arc(p.x,p.y,p.r*p.life,0,Math.PI*2);c.fill();c.restore();});

    // „Éó„É¨„Ç§„É§„ÉºÊ©ü‰Ωì
    const x=this.plX,y=this.plY;
    c.save();
    c.translate(x,y);c.rotate(this.plVx*-.02);c.translate(-x,-y);
    // „Çπ„É©„Çπ„Çø„Éº
    c.fillStyle=`rgba(0,100,255,${.4+.3*Math.sin(this.tFrame*.3)})`;
    c.beginPath();c.ellipse(x,y+16,7,18,0,0,Math.PI*2);c.fill();
    // Ê©ü‰Ωì
    c.shadowBlur=12;c.shadowColor='#00f5ff';c.fillStyle='#00f5ff';
    c.beginPath();c.moveTo(x,y-18);c.lineTo(x-11,y+13);c.lineTo(x-4,y+7);c.lineTo(x,y+11);c.lineTo(x+4,y+7);c.lineTo(x+11,y+13);c.closePath();c.fill();
    // „Ç≥„ÉÉ„ÇØ„Éî„ÉÉ„Éà
    c.fillStyle='rgba(0,10,24,.85)';c.beginPath();c.ellipse(x,y-4,3.5,5,0,0,Math.PI*2);c.fill();
    // „Éí„ÉÉ„Éà„Çµ„Éº„ÇØ„É´ÔºàÂ≠¶ÁøíÁî®„Å´Â∏∏ÊôÇË°®Á§∫Ôºâ
    c.strokeStyle='rgba(255,255,255,.55)';c.lineWidth=1;c.setLineDash([2,3]);
    c.beginPath();c.arc(x,y,8,0,Math.PI*2);c.stroke();c.setLineDash([]);
    c.restore();

    // SPÊ∫Ä„Çø„É≥ÊôÇ„ÅÆ„Éí„É≥„Éà
    if(this.tSp>=this.tSpMax&&this.STEPS[this.step].action==='special'||this.STEPS[this.step].action==='chargesp'&&this.tSp>=this.tSpMax){
      c.save();c.globalAlpha=.5+.5*Math.sin(this.tFrame*.15);
      c.font='bold 9px Orbitron,monospace';c.fillStyle='#ffc944';
      c.textAlign='center';c.shadowBlur=8;c.shadowColor='#ffc944';
      c.fillText('‚ö° SPECIAL „Åå‰Ωø„Åà„Çã„ÇàÔºÅ',tw/2,th*.76);
      c.textAlign='left';c.restore();
    }
  },

  bindTutControls(){
    // D„Éë„ÉÉ„Éâ„Éú„Çø„É≥
    [['dpU2','_U'],['dpD2','_D'],['dpL2','_L'],['dpR2','_R']].forEach(([id,k])=>{
      const el=document.getElementById(id);if(!el)return;
      const neo=el.cloneNode(true);el.parentNode.replaceChild(neo,el);
      neo.addEventListener('touchstart',e=>{e.preventDefault();this.tKeys[k]=true;},{passive:false});
      neo.addEventListener('touchend',()=>this.tKeys[k]=false);
      neo.addEventListener('mousedown',()=>this.tKeys[k]=true);
      neo.addEventListener('mouseup',()=>this.tKeys[k]=false);
      neo.addEventListener('mouseleave',()=>this.tKeys[k]=false);
    });
    // FIRE„Éú„Çø„É≥
    const fire=document.getElementById('tFire');if(fire){
      const nf=fire.cloneNode(true);fire.parentNode.replaceChild(nf,fire);
      nf.addEventListener('touchstart',e=>{e.preventDefault();this.tKeys['_fire']=true;},{passive:false});
      nf.addEventListener('touchend',()=>this.tKeys['_fire']=false);
      nf.addEventListener('mousedown',()=>this.tKeys['_fire']=true);
      nf.addEventListener('mouseup',()=>this.tKeys['_fire']=false);
      nf.addEventListener('mouseleave',()=>this.tKeys['_fire']=false);
    }
    // SPECIAL„Éú„Çø„É≥
    const spbtn=document.getElementById('tSp2');if(spbtn){
      const ns=spbtn.cloneNode(true);spbtn.parentNode.replaceChild(ns,spbtn);
      ns.addEventListener('click',()=>{
        if(this.tSp>=this.tSpMax){
          this.tSp=0;this._spUsed=true;
          for(let i=0;i<28;i++){let a=i/28*Math.PI*2;this.tBullets.push({x:this.plX,y:this.plY,vx:Math.cos(a)*9,vy:Math.sin(a)*9,col:`hsl(${i*13},100%,65%)`,r:4.5});}
          for(let i=0;i<40;i++){let aa=rnd(0,Math.PI*2),sp=rnd(1,7);this.tParts.push({x:this.plX,y:this.plY,vx:Math.cos(aa)*sp,vy:Math.sin(aa)*sp,life:1,dc:.025,r:rnd(1,5),col:rbC(this.tFrame+i*9)});}
          document.getElementById('tutNext').textContent='Ê¨°„Å∏ ‚Üí';
        }
      });
    }
    // „Ç≠„É£„É≥„Éê„Çπ„Éâ„É©„ÉÉ„Ç∞
    const tc=document.getElementById('tutCvs');if(tc){
      let tid=null,tsx=0,tsy=0;
      tc.addEventListener('touchstart',e=>{e.preventDefault();let t=e.changedTouches[0];tid=t.identifier;tsx=t.clientX;tsy=t.clientY;this._tDrag=true;this._tDragDx=0;this._tDragDy=0;},{passive:false});
      tc.addEventListener('touchmove',e=>{e.preventDefault();for(let t of e.changedTouches)if(t.identifier===tid){this._tDragDx=t.clientX-tsx;this._tDragDy=t.clientY-tsy;this._moved=true;}},{passive:false});
      tc.addEventListener('touchend',()=>{this._tDrag=false;this._tDragDx=0;this._tDragDy=0;tid=null;});
    }
    // „Ç≠„Éº„Éú„Éº„Éâ
    window.addEventListener('keydown',e=>{this.tKeys[e.key]=true;if(e.key===' ')e.preventDefault();});
    window.addEventListener('keyup',e=>{this.tKeys[e.key]=false;});
  },
};

</script>
</body>
</html>
